{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"2%20Solucion/","title":"2 Solucion","text":""},{"location":"2%20Solucion/#2-practica","title":"2 Pr\u00e1ctica","text":"<p>Esta pr\u00e1ctica guiada consiste en ejecutar distintos bloques de c\u00f3digo y responder a las preguntas que se plantean a lo largo del proceso. Para resolverlas, pod\u00e9is apoyaros en b\u00fasquedas en internet o en herramientas de IA. La idea es que os creeis un proyecto con informaci\u00f3n que os ir\u00e9 pasando en cada bloque de texto. Para ello, deber\u00e1s crear una carpeta y seguir las instrucciones aqu\u00ed especificadas.</p> <p>El objetivo es que, a trav\u00e9s de estas preguntas y de la ejecuci\u00f3n de ejemplos, entend\u00e1is mejor c\u00f3mo montar un servidor en PHP y, al mismo tiempo, adquir\u00e1is nociones b\u00e1sicas de Docker y Docker Compose: uso de vol\u00famenes, bind mounts y redes bridge.</p> <p>A nivel personal, el objetivo es que vay\u00e1is creando vuestro propio proyecto a la vez que le\u00e9is y comprend\u00e9is la siguiente documentaci\u00f3n t\u00e9cnica. Como avanz\u00e1bamos antes, la primera parte de Docker Compose trata sobre la instalaci\u00f3n. No ten\u00e9is que saber c\u00f3mo funciona docker-compose desde un punto de vista demasiado t\u00e9cnico pero s\u00ed deber\u00e9is saber que existe Docker Hub, de donde salen las im\u00e1genes y cu\u00e1les suelen ser las claves m\u00e1s comunes en los YAML que permiten la creaci\u00f3n de contenedores a partir de docker compose. En cuanto a Apache, veremos una configuraci\u00f3n b\u00e1sica con las opciones m\u00e1s usuales.</p>"},{"location":"2%20Solucion/#21-instlacion-de-apache-descentralizada-con-docker","title":"2.1 Instlacion de Apache descentralizada con Docker","text":"<p>En esta parte de la pr\u00e1ctica vais a montar un entorno similar a XAMPP pero usando Docker y Docker Compose. En lugar de instalar manualmente Apache, MySQL y PHP en vuestro ordenador (como hace XAMPP), levantar\u00e9is contenedores que se comunican entre s\u00ed para daros el mismo resultado. La estrcutura del proyecto que os debeis crear es la siguiente:</p> <pre><code>project/\n\u2502\u2500\u2500 docker-compose.yml\n\u2502\u2500\u2500 Dockerfile\n\u2502\u2500\u2500 www/\n\u2502   \u251c\u2500\u2500 index.php\n\u2502   \u2514\u2500\u2500 .htaccess\n\u2502   \u2514\u2500\u2500 productos.php\n\u2514\u2500\u2500 apache/\n    \u2514\u2500\u2500 000-default.conf\n</code></pre> <p>En los puntos que veremos a continuaci\u00f3n, os dar\u00e9 el c\u00f3digo necesario para la ejecuci\u00f3n.</p>"},{"location":"2%20Solucion/#-docker-composeyml","title":"- docker-compose.yml:","text":"<pre><code>version: \"3.8\"\n\nservices:\n  apache-php:\n    image: php:8.2-apache\n    container_name: apache-php\n    ports:\n      - \"8080:80\"\n    volumes:\n      - ./www:/var/www/html\n    depends_on:\n      - db\n    restart: always\n    # Instalamos extensiones de PHP necesarias para MySQL\n    build:\n      context: .\n      dockerfile: Dockerfile\n\n  db:\n    image: mysql:8.0\n    container_name: mysql-db\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpass\n      MYSQL_DATABASE: testdb\n      MYSQL_USER: testuser\n      MYSQL_PASSWORD: testpass\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - db_data:/var/lib/mysql\n\n  phpmyadmin:\n    image: phpmyadmin/phpmyadmin\n    container_name: phpmyadmin\n    restart: always\n    ports:\n      - \"8081:80\"\n    environment:\n      PMA_HOST: db\n      MYSQL_ROOT_PASSWORD: rootpass\n    depends_on:\n      - db\n\nvolumes:\n  db_data:\n</code></pre> <ol> <li> <p>apache-php: Imagen base: <code>php:8.2-apache</code>. Es el servicio que act\u00faa como servidor web y int\u00e9rprete de PHP. Sirve las p\u00e1ginas desde la carpeta <code>./www</code> (en tu m\u00e1quina) que se monta dentro del contenedor en <code>/var/www/html</code>. Tiene extensiones de PHP para conectarse a MySQL (<code>pdo_mysql</code>, <code>mysqli</code>).</p> </li> <li> <p>db: Imagen base: <code>mysql:8.0</code>. Contenedor que levanta una base de datos MySQL. Contiene algunas variables de entorno que s epueden ver en el repo de la imagen en dockerhub (tal y como hemos visto en clase s\u00f3lo utilzaremos las siguiente variables de entorno).</p> </li> <li> <p>Variables de entorno:</p> <ul> <li><code>MYSQL_ROOT_PASSWORD</code> \u2192 contrase\u00f1a del usuario administrador.</li> <li><code>MYSQL_DATABASE</code> \u2192 base creada autom\u00e1ticamente al iniciar.</li> <li><code>MYSQL_USER</code> y <code>MYSQL_PASSWORD</code> \u2192 usuario adicional para que se conecte tu aplicaci\u00f3n.</li> </ul> <p>Ojo, los datos de este servicio se guardan en un volumen (<code>db_data</code>), de manera que no se pierden al reiniciar o borrar el contenedor. Podeis investigar los comandos que tienen docker para ver qu\u00e9 vol\u00famenes ten\u00e9is en vuestro ordenador y c\u00f3mo visualizarlos y borrarlos, pero es opcional. Solo teneis que entender que en el momento que se asocia un volumen a una carpeta de un contenedor, los datos persisten.</p> </li> <li> <p>phpmyadmin</p> </li> <li>Imagen base: <code>phpmyadmin/phpmyadmin</code>.</li> <li>Es un servicio extra para tener una interfaz web de administraci\u00f3n de MySQL. En nuestro caso, se accede desde el navegador en <code>http://localhost:8081</code>. No lo veremos por ahora pero ofrece una interfaz grafica m\u00e1s o menos amigable.</li> </ol> <p>Esto funciona de la siguiente manera. Con el c\u00f3digo anterior:</p> <ul> <li> <p>Levantas 3 contenedores. Cada uno tiene el n\u00famero estandar de puertos y cada uno ejecuta el programa correspondiente en el puerto usualmente destinado a su ejecuci\u00f3n, por ejemplo, apache corre en el puerto 80 de su propio contenedor pero se mapea con el 8080 de mi host.</p> </li> <li> <p>De igual forma, el resto de contenedores correran los programas espec\u00edficos en los puertos correspondientes.</p> </li> </ul> <p>[PREGUNTA]: \u00bfEn qu\u00e9 puertos internos de los contenedores corren los programas anteriores y a qu\u00e9 puertos del host se mapean?    SOL: S\u00f3lo basta con mirar la configuraci\u00f3n de docker:</p> <p>Apache-PHP: corre en el puerto interno 80 del contenedor y se mapea al puerto 8080</p> <p>MySQL: corre en el puerto interno 3306 y se mapea al 3306</p> <p>phpMyAdmin: corre en el puerto interno 80 y se mapea al 8081</p> <p>Ahora bien, los programas se pueden comunicar entre s\u00ed gracias a que docker incluye a cada servicio en una interfaz red bridge que permite la comunicaci\u00f3n entre ellos. FIN SOL</p> <p>[PREGUNTA]: Imagina que yo instalase los programas independientemente cada uno en mi host, sin usar docker. \u00bfQu\u00e9 puertos de qu\u00e9 maquinas utilzar\u00edan por defecto? \u00bfMediante que interfaz de red se comunicar\u00eda unos con otros?</p> <p>SOL: Apache: usa por defecto el puerto 80 o 443 si lo configurasemos correctamente para https, esto se ve en el contenedor o haciendo una peque\u00f1a b\u00fasqueda por internet.</p> <p>MySQL: usa por defecto el puerto 3306, esto se ve igualmente en el contenedor o haciendo una peque\u00f1a b\u00fasqueda por internet</p> <p>phpMyAdmin: se ejecuta como aplicaci\u00f3n web servida por Apache en el 80 .</p> <p>Evidentemente si todos estuvieran bajo un mismo host, La comunicaci\u00f3n entre ellos ser\u00eda a trav\u00e9s de localhost. Esto causar\u00eda problemas ente phpMyAdmin y Apache, luego deber\u00edamos hacer que phpMyAdmin corra en otro puerto. FIN SOL</p> <p>[Pregunta]: Quiero que expliques que significa esto:</p> <p>SOL: Usamos dos serivicios apache-php y db. Uno es de apache, otro de la base de datos. EN el caso de apache, hacemos un enlace simb\u00f3lico (en docker llamado bind mount) entre mi carpeta www y la carpeta /var/www/html del contenedor donde est\u00e1 instalado apache, esto se hace para que cuando suba un script en mi proyecto a www se cree en el directorio correcto de apache en mi contendor donde apache sube los archivo est\u00e1ticos. FIN SOL</p> <pre><code>services:\n  apache-php:\n   image: php:8.2-apache\n   volumes:\n      - ./www:/var/www/html\n   build:\n      context: .\n      dockerfile: Dockerfile\n\n  db:      \n    volumes:\n      - db_data:/var/lib/mysql\n</code></pre> <p>Todo en docker funciona a trav\u00e9s de una \"imagen previa\".  Una imagen en Docker es como una plantilla o fotograf\u00eda inmutable que contiene todo lo necesario para ejecutar un programa, es decir, a partir de esa plantilla se puede ejecutar practicamente el servicio que quieras. </p> <p>Habitualmente, esa plantilla se suele crear a trav\u00e9s de un Dockerfile, que es un archivo que contiene las instrucciones de creaci\u00f3n de la plantilla. Aunque no es siempre as\u00ed, el caso m\u00e1s habitual es coger la imagen de Docker Hub, aplicacion web que funciona como repositorio de imagenes para los servicios m\u00e1s populares (como apache). De hecho, incluso en el archivo del Dockerfile, se suele empezar desde una imagen previa que se encontrar\u00e1 en DockerHub.</p> <p>[PREGUNTA]: M\u00e1s abajo, encontrar\u00e1s el Dockerfile que se usa en esta pr\u00e1ctica, \u00bfqu\u00e9 imagen de DockerHub est\u00e1 utilizando?</p> <p>SOL: Est\u00e1 usando una imagen descargada de dockerhub (php:8.2-apache) a la que mediante un Dockerfile, se le han a\u00f1adido dependencias necesarias para la configuraci\u00f3n de m\u00f3dulos en apache. Es decir, es una imagen de dockerhub un poco toqueteada. FIN SOL</p> <p>En ejemplo anterior es un caso muy raro, porque parece ser que el servicio se instala a partir de la imagen \"php:8.2-apache\". Esto no es cierto, porque abajo tenemos un \"build\", que nos indique que la imagen se construye a partir del docker file (llamado \"Dockerfile\"), que se encuentra en nuestro directorio actual. En el caso de que tanto image como build est\u00e9n sobre un mismo \"services\", image ser\u00e1 el nombre que asocia Docker internamente a la imagen.</p>"},{"location":"2%20Solucion/#-dockerfile","title":"- Dockerfile","text":"<p>Lo m\u00e1s importante es que cargamos m\u00f3dulos de apache con a2enmod, que utilziaremos m\u00e1s adelante:</p> <p></p> <pre><code>FROM php:8.2-apache\n\n# Instalamos extensiones de PHP para MySQL. docker-php-ext-install es un script que viene incluido en las im\u00e1genes oficiales de PHP (como php:8.2-apache).\nRUN docker-php-ext-install pdo pdo_mysql mysqli\n\n\n#Es un comando que activa m\u00f3dulos de Apache. rewrite Es un m\u00f3dulo de Apache que permite cambiar la forma en la que se interpretan las URLs. .htaccess es un archivo donde escribes las reglas que mod_rewrite ejecuta.\nRUN a2enmod rewrite headers expires\n</code></pre> <p>Antes hemos comentado que los Dockerfile pueden crear por si mismos una imagen que despu\u00e9s se ejecute como contenedor (gracias a los comandos FROM, LABEL, RUN, COPY, ADD, WORKDIR, EXPOSE, ENV, ARG, CMD, ENTRYPOINT, VOLUME) De hecho, si tenemos un Dockerfile con c\u00f3digo en nuestro ordenador, ejecutando la siguiente linea de c\u00f3digo, podr\u00edamos crear una imagen propia.</p> <pre><code>docker build -t nombre_imagen:tag -f Dockerfile .\n</code></pre> <ul> <li><code>docker build</code> : es el comando para construir una imagen.</li> <li><code>-t nombre_imagen:tag</code> : asigna un nombre y una etiqueta (tag) a la imagen.</li> <li><code>-f Dockerfile</code> : indica el archivo Dockerfile a usar. No es obligatorio si el archivo se llama exactamente <code>Dockerfile</code>.</li> <li><code>.</code> (punto final) : ruta del contexto de build, normalmente la carpeta actual donde est\u00e1 el Dockerfile y los archivos que quieres copiar dentro de la imagen.</li> </ul> <p>En el siguiente ejemplo, crear\u00edamos una imagen llamada miapp:1.0</p> <pre><code>docker build -t miapp:1.0 .\n</code></pre> <p>Volviendo al Dockerfile de nuestro proyecto, al principio tenemos: FROM php:8.2-apache. Si esta imagen la hubiera creado yo anteriormente a trav\u00e9s de un Dockerfile, docker la sacar\u00eda de mi host. En caso de no exister, la saca de Dockerhub. Ese es el flujo normal. En el Dockerfile anterior, utilizamos algunos m\u00f3dulos interesantes para nuestro archivo de configuraci\u00f3n (siguiente punto) que cargamos gracias a la funcionalidad docker-php-ext-install de apache. Os hago la siguiente pregunta de la que deber\u00e9is busca informaci\u00f3n.</p> <p>**[PREGUNTA]: **</p> <ul> <li>**\u00bfQu\u00e9 m\u00f3dulos cargamos? **</li> </ul> <p>SOL: <code>rewrite</code>, <code>expires</code>, <code>headers</code>. El resto son extensiones de PHP (ojo, no m\u00f3dulos) para conectarse a bases de datos MySQL. Realemente s\u00f3lo nos bastaba con <code>mysqli</code>. FIN SOL</p> <ul> <li>**\u00bfPara qu\u00e9 srive cada uno? **</li> </ul> <p>SOL:</p> <ul> <li> <p>rewrite: nos permite cambiar la forma en que apache responde a una petici\u00f3n a una URL. El ejemplo claro es que yo tengo un script llamado ejemplo.php. Para que el cliente lo ejecute deberia hacer algo parecido a:</p> <p>http://localhost:8080/ejemplo.php (ya que tenemos mapeados los puertos). Sin embargo, no te gusta que el cliente sepa que est\u00e1 ejecutando un script o simplemente quieres hacer que el flujo sea mas simple. De esta forma, se busca que cuando el cliente busque: http://localhost:8080/ejemplo en realidad ejecute: http://localhost:8080/ejemplo.php. Esto se har\u00eda con un htaccess sobre /var/www/html que ponga lo siguiente:</p> <p><code>RewriteRule ^ejemplo$ ejemplo.php [L]</code></p> </li> <li> <p>expires: Gestiona el control de cach\u00e9 de los recursos est\u00e1ticos. En nuestra configuraci\u00f3n de apache, se usa aqui:</p> <pre><code>&lt;FilesMatch \"\\.(jpg|jpeg|png|gif|css|js|ico|woff2?)$\"&gt;\n    ExpiresActive On\n    ExpiresDefault \"access plus 1 month\"\n&lt;/FilesMatch&gt;\n</code></pre> <p>Este bloque de configuraci\u00f3n lo explicamos m\u00e1s tarde</p> </li> <li> <p>headers: Permite modificar cabeceras HTTP de las respuestas. Esto se puede hacer directamente desde php en un script sin utilizar el modulo headers, por ejemplo, est\u00e1 en la pr\u00e1ctica 4 en el punto 8, en el que indicaremos la cabecera del content-type que daremos al cliente. Este mismo ejemplo en apache, ser\u00eda as\u00ed:</p> <pre><code>&lt;FilesMatch \"^a.*\\.php$\"&gt;\n    Header set Content-Type \"application/json\"\n&lt;/FilesMatch&gt;\n</code></pre> <p>M\u00e1s tarde veremos otras configuraciones de cabeceras puestas como estas:</p> <pre><code>Header always set X-Content-Type-Options \"nosniff\"\nHeader always set Referrer-Policy \"strict-origin-when-cross-origin\"\nHeader always set Content-Security-Policy \"default-src 'self'; object-src 'none'; base-uri 'self'\"\n</code></pre> <p>FIN SOL</p> </li> <li> <p>\u00bfQu\u00e9 m\u00f3dulo se utilizar\u00eda (no est\u00e1) para capturar y filtrar n\u00famero de peticiones? (rate limit). Si no sabes qu\u00e9 es el rate limit, deber\u00e1s indicarlo aqu\u00ed tambi\u00e9n</p> </li> </ul> <p>SOL: mod_ratelimit, y permite limitar el ancho de banda asignado a cada cliente o tipo de recurso. Vemos un ejemplo:   <pre><code>&lt;IfModule mod_ratelimit.c&gt;\n    &lt;FilesMatch \"\\.(mp4|zip|iso)$\"&gt;\n        SetOutputFilter RATE_LIMIT\n        SetEnv rate-limit 200\n    &lt;/FilesMatch&gt;\n&lt;/IfModule&gt;\n</code></pre></p> <p>SOL: Ojo, la sentencia  es una condicional espec\u00edfica de Apache. Sirve para: \u201cEjecuta este bloque solo si el m\u00f3dulo indicado est\u00e1 cargado\u201d. El \".c\" de  \"mod_ratelimit.c\" no es m\u00e1s que notaci\u00f3n para hacer referencia al m\u00f3dulo cargado en lenguaje c, pero se puede poner s\u00f3lo \"IfModule mod_ratelimit\". <p>La directiva \"SetOutputFilter RATE_LIMIT\" activa el filtro del m\u00f3dulo \"mod_ratelimit\", que controla la velocidad de env\u00edo de datos al cliente para evitar que una descarga o transmisi\u00f3n sature el ancho de banda. </p> <p>Esto se hace con \"SetEnv rate-limit 200 \"que crea una variable de entorno llamada \"rate-limit\" con  valor de \"200 KB/s\" por conexi\u00f3n. Estas variables de entorno consultarse desde scripts en lenguaje php en la carpeta www/var/html (pr\u00e1cticas 3 y 4) mediante $_SERVER['rate-limit']; FIN SOL.</p>"},{"location":"2%20Solucion/#-apache000-defaultconf-explicamos-cada-uno-de-ellos","title":"- apache/000-default.conf: (explicamos cada uno de ellos)","text":"<p>El objetivo de lo siguiente es hablar del archivo de configuraci\u00f3n inicial de apache y de cada una de sus peculiaridades. Al igual que con la parte anterior de la pr\u00e1ctica, os ir\u00e9 haciendo preguntas al respecto de lo que vaya saliendo, poco a poco.</p> <p></p> <pre><code>&lt;VirtualHost *:80&gt;\n    ServerAdmin webmaster@localhost\n    DocumentRoot /var/www/html\n\n    &lt;Directory /var/www/html&gt;\n        # Opciones de directorio\n        Options -Indexes +FollowSymLinks\n        AllowOverride All\n        Require all granted\n    &lt;/Directory&gt;\n\n    # Seguridad con cabeceras\n    Header always set X-Content-Type-Options \"nosniff\"\n    Header always set Referrer-Policy \"strict-origin-when-cross-origin\"\n    Header always set Content-Security-Policy \"default-src 'self'; object-src 'none'; base-uri 'self'\"\n\n\n    # Autenticaci\u00f3n para la carpeta /admin. Ahora mismo no tenemos ni siquiera la carpeta creada y menos el fichero con\n    #la contrase\u00f1a, ser\u00eda interesante (aunque no lo pido en la pr\u00e1ctica, que prob\u00e9is a hacerlo por vosotros mismos.)\n    &lt;Directory /var/www/html/admin&gt;\n        AuthType Basic\n        AuthName \"Zona restringida\"\n        AuthUserFile /etc/apache2/.htpasswd\n        Require valid-user\n    &lt;/Directory&gt;\n\n    # Control de cach\u00e9 para est\u00e1ticos (mejora rendimiento)\n    &lt;FilesMatch \"\\.(jpg|jpeg|png|gif|css|js|ico|woff2?)$\"&gt;\n        ExpiresActive On\n        ExpiresDefault \"access plus 1 month\"\n    &lt;/FilesMatch&gt;\n\n    # Restringir carpeta sensible solo a una IP (permite solo esa IP)\n    &lt;Directory /var/www/html/dev-tools&gt;\n        Require ip 192.168.1.100\n    &lt;/Directory&gt;\n\n    # Logs\n    ErrorLog ${APACHE_LOG_DIR}/app-error.log\n    CustomLog ${APACHE_LOG_DIR}/app-access.log combined\n&lt;/VirtualHost&gt;\n</code></pre> <ul> <li> <p>Empieza con la etiqueta <code>\\&lt;VirtualHost *:80&gt;</code> y termina con su cierre  <code>\\&lt;/VirtualHost&gt;</code>. Con eso Apache define un  \"bloque de sitio\u201d que escucha en el puerto 80 de todas las interfaces (<code>*</code>).  Dentro del contenedor, Apache escucha en el 80; fuera, t\u00fa lo ves en <code>http://localhost:8080</code> porque Docker hace el mapeo <code>8080:80</code>. Si alg\u00fan d\u00eda tienes m\u00e1s \"sitios\", puedes crear m\u00e1s bloques <code>VirtualHost</code> (incluso uno por dominio) y diferenciarlos con <code>ServerName</code>.</p> <p>[PREGUNTA]: \u00bfQu\u00e9 pasa si reutilizo la etiqueta VirtualHost? \u00bfPodr\u00eda servir \"dos sitios\" con reglas distintas?.</p> <p>SOL. S\u00ed, sin problema pero deben tener distintos puertos, no hay m\u00e1s. En cada dominio, puedes tener configuraciones distintas, como es l\u00f3gico. FIN SOL.</p> </li> <li> <p><code>ServerAdmin webmaster@localhost</code> es solo un correo de contacto que Apache muestra en algunas p\u00e1ginas de error y mete en los logs. No afecta al funcionamiento; puedes poner tu email real o ignorarlo.</p> </li> <li> <p><code>DocumentRoot /var/www/html</code> indica la carpeta p\u00fablica desde la que Apache sirve archivos. En tu setup, esa ruta est\u00e1 montada desde tu m\u00e1quina con <code>./www:/var/www/html</code>, as\u00ed que lo que guardes en <code>./www</code> es lo que ve Apache y lo que se sirve al navegador (Esto es justo lo que vimos ayer en clase meti\u00e9ndonos dentro del contenedor).  El bloque <code>\\&lt;Directory /var/www/html&gt;</code> aplica reglas espec\u00edficas a esa carpeta:</p> </li> <li> <p><code>Options -Indexes +FollowSymLinks</code> controla funcionalidades dentro del directorio.</p> </li> <li> <p><code>-Indexes</code> desactiva el listado de directorios. </p> <p>[PREGUNTA]: Esta explicaci\u00f3n puede que no quede muy clara, especifica qu\u00e9 significa con un ejemplo. Lanza tu servidor con esta opci\u00f3n y sin esta y comprueba por ti mismo (adjuntando captura de pantalla) que efectivamente sucede as\u00ed.</p> <p>Bastaba con investigar un poco. Si quito la opci\u00f3n, en el servidor me queda esto: </p> <p>Ahora hay que reiniciar el servidor. Para ello, pod\u00e9is hacer <code>systemctl restart apache</code> o si ten\u00e9is docker: <code>docker compose down</code> y <code>docker compose up --build</code></p> <p>Una vez esto, cre\u00e1is una carpeta en <code>var/www/html</code> yo le he puesto el nombre <code>otros</code>. En la carpeta, dej\u00e1is un script, por ejemplo <code>bucles.php</code>.</p> <p>Si en el navegador escrib\u00eds: <code>http://locahost/otros</code> (por favor, poned el puerto que utilic\u00e9is si est\u00e1is con docker) os aparecer\u00e1 algo as\u00ed:</p> <p></p> <p>Esto no es NUNCA conveniente en un servidor apache, es por eso que se pone la opci\u00f3n -Indexes (para que no de info de lo que hay en el servidor). Poner +Indexes es lo mismo que quitar directamente todo el texto \"- Indexes\", tal y como est\u00e1 en la captura de arriba.</p> <p>Si volv\u00e9is a poner -Indexes en la configuraci\u00f3n:</p> <p></p> <p>Entonces al visitar:  <code>http://locahost/otros</code> ver\u00e9is esto: </p> <p>que es justo lo que se espera de un servidor.</p> </li> <li> <p><code>+FollowSymLinks</code> permite a Apache seguir enlaces simb\u00f3licos. \u00datil si apuntas subcarpetas a otros lugares. Si quieres ser a\u00fan m\u00e1s estricto, existe <code>SymLinksIfOwnerMatch</code> (solo sigue el symlink si el propietario coincide), pero <code>FollowSymLinks</code> es lo habitual.</p> <p>[PREGUNTA]: Pon ejemplos de qu\u00e9 significa esto definiendo distintos propietarios: Para guiarte un poco, piensa que la carpeta /var/www/privado con propietario manolo  se crea un enlace con /var/www/html/privado. Si alguien accede por red, \u00bfpodr\u00eda ver el contenido de /var/www/html/privado? Para ello investiga con que usuario se indenficar\u00eda dicha persona al entrar a la web e intentar la redirecci\u00f3n.</p> <p>SOL. No os lo voy a preguntar. S\u00f3lo valorar\u00e9 que lo hay\u00e1is escrito correctamente y lo hay\u00e1is explicado y ejemplificado. FIN SOL.</p> </li> <li> <p><code>AllowOverride</code> es otra directiva de Apache que en este caso controla qu\u00e9 directivas est\u00e1n permitidas dentro de un <code>.htaccess</code> (archivo que veremos m\u00e1s tarde). Le est\u00e1s diciendo a Apache en este caso: \u201cDentro de esta carpeta, haz caso a los archivos <code>.htaccess</code> que haya\u201d. Significa que Apache permitir\u00e1 archivos <code>.htaccess</code> en esa carpeta (en este caso:<code>/var/www/html</code>) y en cualquiera de sus subcarpetas (ojo, lo de cualquiera de sus subcarpetas es importante y m\u00e1s tarde veremos porqu\u00e9, ya que afecta al funcionamiento de un servidor en producci\u00f3n y provoca que, habitualmente, no se cree el archivo .htacess. </p> <p>En conclusi\u00f3n: es muy com\u00fan dejarlo en \"All\" durante desarrollo y como hemos dicho, en producci\u00f3n, por rendimiento, muchos mueven esas reglas al propio VirtualHost y ponen <code>AllowOverride None</code>. Lo veremos m\u00e1s tarde.</p> </li> <li> <p><code>Require all granted</code> es la regla de acceso (desde Apache 2.4). Significa \u201cpermite acceso a cualquiera\u201d. Si no la pones (o niegas el acceso), podr\u00edas ver errores 403 (los c\u00f3digos de errores los he comentado ya mucho en clase pero los veremos cuando generemos nuestros propios endpoints). Ejemplo: solo permitir a la IP <code>192.168.1.100</code> ser\u00eda de la forma: <code>Require ip 192.168.1.100.</code></p> </li> <li> <p><code>/etc/apache2/envvars</code> lugar f\u00edsico donde se encuentran las ENV, pod\u00e9is echarle un vistazo, es interesante. Lo vimos en clase, simplemente, os met\u00e9is al contenedor y le hac\u00e9is un cat al fichero.</p> </li> </ul> <p>[PREGUNTA]: \u00bfC\u00f3mo se podr\u00eda negar el acceso a una sola IP a nuestro servidor Apache?</p> <pre><code>&lt;Directory /var/www/html&gt;\n    Require all granted\n    Require not ip 192.168.1.105\n&lt;/Directory&gt;\n</code></pre> <p>SOL. Esto lo hice en clase, desplegando el servidor con un balanceador de carga entre mi raspberry pi5 y mi portatil que estaban ambas bajo una misma interfaz de red y vimos c\u00f3mo se negaba el acceso a mi raspberry pi5 sin ning\u00fan tipo de problema. FIN SOL.</p> <ul> <li><code>ErrorLog ${APACHE_LOG_DIR}/app-error.log</code> </li> </ul> <p>[PREGUNTA]: \u00bfQu\u00e9 tipo de errores guarda el log app-error.log?</p> <p>SOL: Registra errores internos del servidor Apache como: Fallos esp\u00e9cificos de sintaxis en configuraciones y problemas de permisos a la hora de acceder a recursos. En clase vimos este ejemplo:</p> <p>[!IMPORTANT]</p> <p>Dentro del contenedor, esos archivos viven en <code>/var/log/apache2/</code>. Para verlos puedes hacer <code>docker exec -it apache-php bash</code> (esto entra en una terminal del contenedor donde est\u00e1 apache instalado) y luego <code>tail -f /var/log/apache2/app-error.log</code>. (sirve para ver el log de errores). En este caso se observana el error de la ip de mi raspberry intentando acceder a un recurso no v\u00e1lido.</p> <p>[PREGUNTA]: \u00bfQu\u00e9 significa ${APACHE_LOG_DIR} y donde se guardan dichas variables?</p> <p>SOL: ${APACHE_LOG_DIR} es una variable de entorno definida en <code>/etc/apache2/envvars</code>. De hecho, m\u00e1s arriba se comenta que este fichero posee las variables de entorno de apache. FIN SOL.</p> <ul> <li><code>CustomLog ${APACHE_LOG_DIR}/app-access.log combined</code> </li> </ul> <p>**[PREGUNTA]: Durante las pr\u00e1cticas anteriores, has hecho peticiones http a un servidor. \u00bfQu\u00e9 es lo que se ver\u00eda en este caso en app-access.log y que relacion tiene con la pr\u00e1ctica anterior? **</p> <p>SOL: En este log, se registran todas las peticiones HTTP que recibe Apache: m\u00e9todo, URL, c\u00f3digo de respuesta, tama\u00f1o...</p> <p>En clase, no llegamos a acceder a este log, pero se har\u00eda de igual forma que con el otro log al que yo s\u00ed os ense\u00f1e c\u00f3mo se acced\u00eda:</p> <p>[!IMPORTANT]</p> <p>Dentro del contenedor, esos archivos viven en <code>/var/log/apache2/</code>. Para verlos puedes hacer <code>docker exec -it apache-php bash</code> (esto entra en una terminal del contenedor donde est\u00e1 apache instalado) y luego <code>tail -f /var/log/apache2/app-access.log</code>. (sirve para ver el log de peticiones).</p> <p>El combined no es m\u00e1s que un formato que define la forma y el contenido de lo que se a\u00f1ade en el log.</p> <p>FIN SOL</p> <ul> <li><code>&lt;Directory /var/www/html/admin&gt;</code> Tenemos una regla de autenticaci\u00f3n sobre este directorio, aunque si os fij\u00e1is y tal y como pongo en el comentario encima de la regla, el directorio no existe, aunque no afecta a Apache.</li> </ul> <p>Lo que has visto en ese bloque de configuraci\u00f3n es un ejemplo de autenticaci\u00f3n HTTP b\u00e1sica en Apache. Sirve para proteger con usuario y contrase\u00f1a un directorio concreto, en este caso <code>/var/www/html/admin</code>.</p> <ul> <li> <p>La directiva <code>AuthType Basic</code> indica que se usar\u00e1 el m\u00e9todo de autenticaci\u00f3n m\u00e1s sencillo, llamado Basic. Este funciona enviando el usuario y la contrase\u00f1a codificados en base64 (debes saber qu\u00e9 es ya que muchas veces los servidores env\u00eda binarios en base64) en cada petici\u00f3n. Por eso, en la pr\u00e1ctica, siempre se recomienda usarlo junto con HTTPS para que las credenciales viajen cifradas. </p> <p>[PREGUNTA]  Auth Type sirve para proteger recursos. El estandar a d\u00eda de hoy ha cambiado a JWT. Busca informaci\u00f3n al respecto sobre qu\u00e9 es. \u00bfTodo el mundo debe tener derecho a acceder a cualquier endpont?</p> <p>JWT es un estandar para proteger recursos en programaci\u00f3n web, permite verificar la identidad del usuario creando un webtoken cada vez que el usuario inicia sesi\u00f3n en la p\u00e1gina. Este webtoken lo usaremos para (de alguna forma), proteger algunas zonas de nuestra aplicaci\u00f3n que no queremos que todo el mundo tenga acceso, por ejemplo, un script.php que solo debe ejecutar un admin, o un script.php que te mande los mensajes que te han mandado otros usuarios con los que has establecido una relaci\u00f3n de amistad dentro de la pagina web. Evidentemente, si no est\u00e1s registrado no debes poder ejecutar ese script.</p> </li> <li> <p><code>AuthName \"Zona restringida\"</code> define el texto que ver\u00e1 el usuario cuando el navegador muestre la ventana emergente pidi\u00e9ndole credenciales. No afecta a la seguridad, es simplemente informativo, pero ayuda a diferenciar distintas \u00e1reas protegidas de un mismo servidor.</p> </li> <li> <p>La l\u00ednea <code>AuthUserFile /etc/apache2/.htpasswd</code> indica d\u00f3nde est\u00e1 guardado el archivo que contiene los usuarios y contrase\u00f1as autorizados. E nuestro proyecto no lo tenemos definido porque, de hecho la carpeta /admin no existe. Ese archivo <code>.htpasswd</code> NO debe estar dentro de la carpeta p\u00fablica del servidor web, porque si no, cualquiera podr\u00eda descargarlo. En \u00e9l se almacenan las credenciales en formato cifrado (normalmente con algoritmos como MD5, SHA o bcrypt).</p> </li> <li> <p>Finalmente, <code>Require valid-user</code> define qui\u00e9n puede acceder. En este caso, \u201cvalid-user\u201d significa que cualquiera de los usuarios definidos en el archivo <code>.htpasswd</code> podr\u00e1 entrar. Pero hay otras variantes: se puede especificar <code>Require user juan</code> para permitir solo a un usuario concreto, o <code>Require user juan pedro</code> para permitir \u00fanicamente a esos dos. Tambi\u00e9n existe la posibilidad de trabajar con grupos de usuarios, usando <code>Require group admins</code>, donde los grupos se definen en un archivo adicional llamado <code>.htgroup</code>.</p> </li> <li> <p>Vamos con el siguiente cacho de c\u00f3digo, que es muy interesante y muy pr\u00e1ctico:</p> <p>```text          ExpiresActive On       ExpiresDefault \"access plus 1 month\"    <pre><code>Esto significa: \u201cAplica las siguientes reglas a todos los archivos cuyo nombre termine en `.jpg`, `.jpeg`, `.png`, `.gif`, `.css`, `.js`, `.ico` o `.woff/woff2` (fuentes web)\u201d. Es decir, cualquier recurso est\u00e1tico habitual de una web (con est\u00e1tico nos referimos a archivos que sualmente no van a cambiar y que se van a mandar tal cual). Dentro de ese bloque, `ExpiresActive On` activa el m\u00f3dulo de caducidad de cach\u00e9. Y `ExpiresDefault \"access plus 1 month\"` establece que el navegador puede mantener esos archivos en cach\u00e9 durante un mes a partir del momento en que los descarga. Ojo, el navegador del cliente ser\u00eda el que cachear\u00eda dicha informaci\u00f3n, evitando as\u00ed incluso que la petici\u00f3n llegue al servidor. La cuesti\u00f3n aqu\u00ed es saber c\u00f3mo se le dice al navegador que cachee dicha petici\u00f3n, eso lo veremos ahora y avanzo que ser\u00e1 gracias a las cabeceras http de la respuesta del servidor!\n\nCon todo esto, si un usuario entra varias veces a tu web, su navegador no volver\u00e1 a pedir al servidor la imagen del logo, los estilos CSS o el JavaScript en cada carga, sino que reutilizar\u00e1 los que ya descarg\u00f3 hasta que pase un mes. Como es l\u00f3gico, el resultado es que la web se siente mucho m\u00e1s r\u00e1pida y consumes menos ancho de banda en el servidor. Lo interesante es que puedes personalizar estas reglas para diferentes tipos de archivo. Por ejemplo:\n\n- Para **im\u00e1genes y v\u00eddeos grandes**, podr\u00edas poner m\u00e1s tiempo (Esto no viene en nuestro archivo de configuraci\u00f3n): Fijate que la directiva es ExpiresByType \n\n```text\nExpiresByType image/jpeg \"access plus 1 year\"\nExpiresByType image/png \"access plus 1 year\"\nExpiresByType video/mp4 \"access plus 1 year\"\n</code></pre></p> </li> <li> <p>Para archivos CSS y JS, quiz\u00e1 prefieras menos tiempo, como una semana, porque podr\u00edas actualizarlos con frecuencia durante el desarrollo (Esto no viene en nuestro archivo de configuraci\u00f3n):</p> </li> </ul> <pre><code>Para archivos CSS y JS, quiz\u00e1 prefieras menos tiempo, como una semana, porque podr\u00edas actualizarlos con frecuencia durante el desarrollo\n</code></pre> <ul> <li>Para documentos sensibles o que cambian mucho (como  un endpoint PHP), lo normal es directamente desactivar la cach\u00e9 (Esto no viene en nuestro archivo de configuraci\u00f3n): </li> </ul> <pre><code>&lt;FilesMatch \"\\.(php)$\"&gt;\n    ExpiresActive Off\n    Header set Cache-Control \"no-store, no-cache, must-revalidate\"\n&lt;/FilesMatch&gt;\n</code></pre> <p>Al final lo que hace todo esto visto en los ejemplos anteriores es insertar una cabecera http en la respuesta, algo como esto:</p> <pre><code>HTTP/1.1 200 OK\nContent-Type: image/png\nContent-Length: 10542\nExpires: Wed, 09 Nov 2025 10:49:27 GMT\nCache-Control: max-age=2592000\n</code></pre> <p>El navegador que recibe la respuesta ser\u00e1 capaz de cachearla seg\u00fan las opciones propuestas.</p> <p>[PREGUNTA] \u00bfCual es la diferencia entre Expires y Cache-Control? Busca las distintas opciones de Cache-Control y qu\u00e9 singifican.</p> <p>SOL: Expires: define la fecha en la que el recurso dejar\u00e1 de ser cacheado. Se utilizaba en HTTP 1.0 y suele estar en desuso en navegadores actuales. Se sigue poniendo autm\u00e1ticamente para compatibilidad.</p> <p>Cache-Control: es la versi\u00f3n actual del expires, con muchas m\u00e1s opciones y m\u00e1s versatil, dejo las opciones m\u00e1s comunes que trabajremos. Aqu\u00ed valorar\u00e9 que lo que hay\u00e1is puesto, sea correcto.</p> <ul> <li> <p><code>no-store</code>: no lo cachees bajo ninguna circunstancia</p> </li> <li> <p><code>max-age=3600</code>: v\u00e1lido en cache duante una hora (tiempo en segundos)</p> </li> <li> <p><code>must-revalidate</code>: Puedes usar el archivo desde la cach\u00e9 hasta que expire, pero cuando expire, debes verificar con el servidor si sigue siendo v\u00e1lido.</p> </li> <li> <p><code>no-cache</code>: Puedes guardar el archivo, pero no lo uses nunca directamente sin antes preguntarle al servidor si sigue siendo v\u00e1lido. veremos como hacer esto, cuando toque.</p> <p>FIN SOL.</p> </li> </ul> <p>[!IMPORTANT] Dentro del contenedor, esos archivos viven en <code>/var/log/apache2/</code>. Para verlos puedes hacer <code>docker exec -it apache-php bash</code> y luego <code>tail -f /var/log/apache2/app-error.log</code>. Si prefieres tenerlos en tu host, puedes montar un volumen para <code>logs/</code> y as\u00ed inspeccionarlos con tu editor. Otra opci\u00f3n avanzada es enviar logs a stdout/stderr para leerlos con <code>docker logs</code>, pero con ficheros sueles tener m\u00e1s control y lo recomiendo sobremanera. Los comandos mencionados a ejecutar dentro del contenedor son los siguientes:</p> <pre><code>docker exec -it apache-php bash\ncd /var/log/apache2\ntail -f app-access.log\n</code></pre> <p>[PREGUNTA]: Ya contesta que era lo que se guardaba en app-access.log, una vez visto esto, y realizado al menos una petici\u00f3n al servidor, metete al contenedor y comprueba qu\u00e9 es lo que se guarda mediante una captura de pantalla</p> <p></p> <p>Con una captura tal que as\u00ed, me bastaba. FIN SOL</p> <ul> <li>Sigamos viendo otras partes, como las cabeceras http, que ya hemos visto que pueden ser muy importantes en la interaccion del cliente con el servidor. Ya sabemos que cuando un navegador (cliente) habla con un servidor web, lo hace usando el protocolo HTTP. Cada petici\u00f3n y cada respuesta viaja en forma de texto, con varias l\u00edneas de informaci\u00f3n llamadas cabeceras (headers). </li> </ul> <p>Estas cabeceras son como metadatos: peque\u00f1os mensajes que acompa\u00f1an a la petici\u00f3n o a la respuesta para dar m\u00e1s contexto sobre qu\u00e9 se env\u00eda, c\u00f3mo debe interpretarse y c\u00f3mo debe comportarse el navegador o el servidor. En la pr\u00e1ctica anterior nos centramos much\u00edsimo en la cabecera \"Content-Type\", pero lo normal es que haya m\u00e1s cabeceras que se env\u00eden por defecto, por ejemplo, lo siguiente muestras las cabeceras http de una petici\u00f3n (REQUEST):</p> <pre><code>GET / HTTP/1.1\nHost: midominio.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: es-ES,es;q=0.9\nReferer: https://google.com\nCookie: sessionid=abc123 #Las trabajaremos mucho cuando llegue el momento. Es importante protejerlas\n</code></pre> <p>Lo siguiente muestras las cabeceras de la respuesta a la petici\u00f3n (RESPONSE)</p> <pre><code>HTTP/1.1 200 OK\nDate: Wed, 09 Oct 2025 18:30:00 GMT\nServer: Apache/2.4.54 (Debian)\nContent-Type: text/html; charset=UTF-8\nContent-Length: 4523\nX-Content-Type-Options: nosniff\nContent-Security-Policy: default-src 'self'; object-src 'none'; base-uri 'self'\n</code></pre> <p>En nuestro codigo de configuraci\u00f3n de Apache (en concreto la parte con el comentario # Seguridad con cabeceras) hemos colocado algunas lineas que mucho tienen que ver con las cabeceras.. Las l\u00edneas de nuestra configuraci\u00f3n de Apache a\u00f1aden cabeceras HTTP a las respuestas que el servidor env\u00eda al navegador. Estas, al igual que la parte del cach\u00e9 vista anteriormente, definir\u00e1n distintos casos de actuaci\u00f3n, aunque en vez de explicaroslas, quiero que busqu\u00e9is informaci\u00f3n al respecto y que pong\u00e1is ejemplos en la medida de lo posible.</p> <ul> <li> <p><code>X-Content-Type-Options \"nosniff\"</code> </p> <p>[PREGUNTA]: \u00bfPara qu\u00e9 sirve y qu\u00e9 tiene que ver con los Content-Type estudiados hasta ahora?</p> <p>SOL: Evita que el navegador \u201cinfiera\u201d el tipo de contenido si el servidor no se indica (en el apartado 8 de la pr\u00e1ctica 4, veremos como el servidor desde un script puede indicar el Content-Type) Con esta opci\u00f3n, el navegador solo acepta el tipo declarado en Content-Type. Ojo, esto no se suele poner, y no lo pondremos por defecto. En la pr\u00e1ctica 1 ya estudiamos los Content-Types y en este caso no es el Content-Type que se env\u00eda del cliente al servidor, si no al rev\u00e9s. FIN SOL.</p> </li> <li> <p>Content-Security-Policy: default-src 'self'; object-src 'none'; base-uri 'self'</p> <p>**[PREGUNTA]: Aqu\u00ed os ayudo un poco m\u00e1s ya que pienso que es m\u00e1s complejo: **</p> <p>La cabecera <code>Content-Security-Policy</code> (CSP) permite al servidor indicar al navegador desde qu\u00e9 or\u00edgenes puede cargar recursos como scripts, im\u00e1genes o estilos. De esta forma, si en el HTML hay etiquetas que intentan cargar contenido externo no permitido, el navegador lo bloquear\u00e1 autom\u00e1ticamente. ** Haciendo uso de la explicaci\u00f3n anterior, detalla c\u00f3mo funciona esta protecci\u00f3n con algunos ejemplos adem\u00e1s, responde a lo siguiente: qu\u00e9 significa que <code>default-src 'self'</code> solo deje cargar recursos del mismo dominio, qu\u00e9 consigue <code>object-src 'none'</code> al prohibir objetos embebidos, y c\u00f3mo <code>base-uri 'self'</code> limita el uso de la etiqueta <code>&lt;base&gt;</code> en el documento. Muestra ejemplos de c\u00f3digo HTML que ser\u00edan permitidos y otros que ser\u00edan bloqueados.**</p> <p>SOL:</p> <p><code>default-src 'self'</code> :Indica al navegador los or\u00edgenes permitidos para cargar recursos (scripts, hojas de estilo, im\u00e1genes fuentes...) en una web. Si en defacult-src ponemos 'self' indica que s\u00f3lo se pueden coger recursos del mismo servidor.  Por ejemplo, es normal que en el frontend de la aplicaci\u00f3n carguemos librer\u00eda de iconos para hacerla m\u00e1s bonita, pero con esta pol\u00edtica el navegador bloquear\u00e1 esos recursos externos y no se ver\u00e1n los iconos. Por ejemplo, en el html, en la etiqueta head cargamos los iconos as\u00ed, a partir del recursos web de iconos de un cdn:</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"es\"&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n  &lt;title&gt;Ejemplo bloqueado&lt;/title&gt;\n\n  &lt;!-- Librer\u00eda externa de iconos AQUI --&gt;\n  &lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css\"&gt;\n\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;h1&gt;&lt;i class=\"fa-solid fa-user\"&gt;&lt;/i&gt; Perfil de usuario&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>Esto no se podr\u00eda debido a la directiva actual: default-src 'self'. Deber\u00edamos descargar los iconos, ponerlos en nuestro servidor a mano y hacer algo as\u00ed:</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"es\"&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n  &lt;title&gt;Ejemplo permitido&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"/css/fontawesome.min.css\"&gt; //esto est\u00e1 descargado en local y esta en nuestro server\n  &lt;link rel=\"stylesheet\" href=\"/css/solid.min.css\"&gt;\n\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;h1&gt;&lt;i class=\"fa-solid fa-user\"&gt;&lt;/i&gt; Perfil de usuario&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p><code>object-src 'none'</code>: Controla qu\u00e9 or\u00edgenes pueden usarse para cargar contenido embebido mediante etiquetas como por ejemplo, las siguiente:</p> <ul> <li> <p><code>&lt;object&gt;</code>: sirve para inscrustar contenido binario, como un pdf en el html</p> </li> <li> <p><code>&lt;embed&gt;</code>: como object, pero obsoleto</p> </li> </ul> <p>En nuestro caso, al poner 'none' prohibimos cualquier contenido embebido, de cualquier origen, incluso PROPIO.</p> <p><code>base-uri 'self'</code>: La etiqueta  define la URL base para todas las rutas relativas de la p\u00e1gina en el head del html.</p> <pre><code>&lt;html lang=\"es\"&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n  &lt;title&gt;Ejemplo permitido&lt;/title&gt;\n  &lt;base href=\"https://midominio.com/\"&gt;\n</code></pre> <p>Con <code>base-uri 'self'</code>, solo se permiten  que apunten al mismo dominio.</p> </li> <li> <p><code>Referrer-Policy \"strict-origin-when-cross-origin\"</code></p> <p>[PREGUNTA]: \u00bfQu\u00e9 es referer en la cabecera y que hace este tipo de pol\u00edtica?</p> <p>Cada vez que un navegador (cliente) solicita un recurso al servidor, en la cabecera http se env\u00eda el siguiente contenido: <pre><code>Referer: https://iaw.com/perfil?usuario=manolo\n</code></pre></p> <p>En nuestro caso, tenemos la opcion: \"Referrer-Policy: strict-origin-when-cross-origin\" que hace lo siguiente:</p> <p>Si la solicitud es dentro del mismo dominio de tu web, se env\u00eda el referer completo como en el ejemplo anterior. Si la solicitud es a otro lado externo a mi dominio, se env\u00eda solo \"https://iaw.com/\"</p> <p>FIN SOL.</p> </li> </ul>"},{"location":"2%20Solucion/#-archivo-htaccess-uso-de-reglas-rewritecond-y-rewriterule","title":"- Archivo <code>.htaccess</code> (uso de reglas RewriteCond y RewriteRule)","text":"<p>El archivo <code>.htaccess</code> es un archivo de configuraci\u00f3n especial que Apache lee cada vez que recibe una petici\u00f3n dentro de una carpeta concreta (mirar AllowOverride explicado en el archivo de configuraci\u00f3n). Su nombre viene de hypertext access y fue creado originalmente para manejar reglas de acceso, aunque hoy en d\u00eda se usa para muchas otras cosas.  La idea es sencilla: si en tu servidor tienes definido un directorio ra\u00edz (por ejemplo <code>/var/www/html</code>), puedes colocar un <code>.htaccess</code> dentro de esa carpeta o en alguna subcarpeta. Como nuestro directorio ra\u00edz es <code>var/www/html</code> Apache, cuando sirve un archivo o procesa una URL, busca si en esa ruta de la siguiente forma :</p> <ul> <li>Imagina que la Carpeta ra\u00edz definida es, como en nuestro caso: <code>/var/www/html</code></li> <li>El cliente hace la petici\u00f3n: <code>http://localhost:8080/blog/posts/123</code></li> <li>En el servidor, la ruta real: <code>/var/www/html/blog/posts/123</code></li> </ul> <p>Si AllowOverride es \"ON\" como en nuestro caso, Apache revisa de la siguiente forma para ver:</p> <ol> <li><code>/var/www/html/blog/posts/.htaccess</code></li> <li><code>/var/www/html/blog/.htaccess</code></li> <li><code>/var/www/html/.htaccess</code></li> </ol> <p>No hace falta convercerse para darse cuenta de que ha nivel de rendimiento es una casta\u00f1a tremenda, por eso, para desarrollo, es coherente, pero no a nivel de producci\u00f3n, donde se pone <code>AllowOverride none</code>...</p> <p>Veamos ahora qu\u00e9 es lo que tenemos en este archivo <code>.htaccess</code></p> <pre><code>RewriteEngine On\n\n# Si la URL no apunta a un archivo real...\nRewriteCond %{REQUEST_FILENAME} !-f\n# ... y no apunta a un directorio real\nRewriteCond %{REQUEST_FILENAME} !-d\n# Redirigimos todo a index.php\nRewriteRule ^ index.php [L]\n</code></pre> <p>Vamos a estudiar las condiciones de este .htaccess, que como es dicho, podr\u00edan estar directamente sobre el archivo de configuraci\u00f3n de Apache y no necesariamente en el .htaccess</p>"},{"location":"2%20Solucion/#-la-primera-condicion","title":"- La primera condici\u00f3n","text":"<pre><code>RewriteCond %{REQUEST_FILENAME} !-f\n</code></pre> <p><code>%{REQUEST_FILENAME}</code>  es la ruta f\u00edsica del archivo que corresponde a la URL pedida.<code>! -f</code>  significa \"NO es un archivo normal existente\".</p> <p>solo se aplicar\u00e1 la regla si el archivo real no existe</p> <p>Ejemplo:</p> <ul> <li> <p>URL: <code>/style.css</code> , s\u00ed existe <code>/var/www/html/style.css</code> : la condici\u00f3n NO se cumple.</p> </li> <li> <p>URL: <code>/api/usuarios</code> , no existe <code>/var/www/html/api/usuarios</code> como archivo : la condici\u00f3n se cumple.</p> </li> </ul>"},{"location":"2%20Solucion/#-la-segunda-condicion","title":"- La segunda condici\u00f3n","text":"<pre><code>RewriteCond %{REQUEST_FILENAME} !-d\n</code></pre> <p>Solo se aplicar\u00e1 la regla si la ruta pedida no es un directorio real.</p> <p>Ejemplos:</p> <ul> <li>Se ejecuta la URL: <code>/uploads/</code> , s\u00ed existe <code>/var/www/html/uploads/</code> como carpeta: la condici\u00f3n NO se cumple.</li> <li>se ejecuta la URL: <code>/api/usuarios</code> , no existe <code>/var/www/html/api/usuarios</code> como carpeta : la condici\u00f3n se cumple.</li> </ul> <p>\u00bfPor qu\u00e9 se tienen que cumplir las dos? Porque si existe un archivo o un directorio real, nuestra configuraci\u00f3n decide que Apache debe servirlo directamente. Este tipo de configuraci\u00f3n suele ser com\u00fan y est\u00e1ndar y ten\u00e9is que saber c\u00f3mo funciona. En conclusi\u00f3n, no queremos que una petici\u00f3n de <code>style.css</code> acabe en <code>index.php</code> (en caso de que s\u00ed exista style.css) ni que la carpeta <code>uploads/</code> sea redirigida. Solo cuando:</p> <ul> <li>No existe dicho archivo,</li> <li>No existe dicha carpeta,    entonces aplicamos la regla final:</li> </ul> <p>Hemos visto dos ejemplos de <code>RewriteCond</code> pero, en general, las RewriteCond siguen la siguiente estructura. Estudiemos su estructura y veamos m\u00e1s ejemplos.</p>"},{"location":"2%20Solucion/#-estudio-de-las-condiciones-rewritecond-en-general-con-mas-ejemplos","title":"- Estudio de las Condiciones (<code>RewriteCond</code>) en general, con m\u00e1s ejemplos","text":"<p>Sintaxis general:</p> <pre><code>RewriteCond TESTSTRING CONDITION\n</code></pre> <ul> <li>TESTSTRING : es lo que se va a evaluar (ej: <code>%{REQUEST_FILENAME}</code>, <code>%{HTTP_HOST}</code>, <code>%{QUERY_STRING}</code>, etc.).</li> </ul> <p>[PREGUNTA] \u00bfQUE OTRAS VARIABLES DE ENTORNO SE GENERAN EN APACHE CUANDO SE RECIBE UNA PETICI\u00d3N HTTP?</p> <p>SOL: <code>REQUEST_METHOD</code> ,<code>REQUEST_URI</code> , <code>REMOTE_ADDR</code>,<code>HTTP_USER_AGENT</code> ,<code>HTTP_HOST</code> ,<code>QUERY_STRING</code>    FIN SOL.</p> <ul> <li>CONDITION : es la comparaci\u00f3n (ej: <code>!-f</code>, regex, strings, etc.). Al final de estos apuntes hay un anexo con regex.</li> </ul> <p>Veamos muchos ejemplo, no hace faltas que los sep\u00e1is de memoria pero s\u00ed que los entend\u00e1is.</p> <p>EJEMPLOS</p> <ul> <li> <p><code>RewriteCond %{REQUEST_FILENAME} !-f</code> : se cumple si no existe archivo.</p> </li> <li> <p><code>RewriteCond %{REQUEST_FILENAME} -d</code> :  se cumple si s\u00ed existe directorio.</p> </li> <li> <p><code>RewriteCond %{HTTP_HOST} ^www\\.midominio\\.com$</code> : se cumple si el host pedido es exactamente <code>www.midominio.com</code>.</p> </li> <li> <p><code>RewriteCond %{HTTP_HOST} !^www\\.</code>    Se cumple si el host no empieza con www.</p> </li> <li> <p><code>RewriteCond %{HTTPS} on</code>    Se cumple si la conexi\u00f3n es HTTPS.</p> </li> <li> <p><code>RewriteCond %{HTTPS} off</code>    Se cumple si la conexi\u00f3n es HTTP (no cifrada).</p> </li> <li> <p><code>RewriteCond %{QUERY_STRING} id=([0-9]+)</code>    Se cumple si la URL tiene <code>?id=algo</code> en la query string.</p> </li> <li> <p><code>RewriteCond %{QUERY_STRING} !id=</code>    Se cumple si la query string no contiene <code>id=</code>.</p> </li> </ul> <p>TODO DE QUERY_STRING ESTO OS DEBE SONAR: En la primera pr\u00e1ctica vimos que mi servidor montado con NodeJS no diferenciabala lo que hubiese en los queryparams, le daba exactamente igual que hubiera m\u00e1s o menos campos.</p> <ul> <li> <p><code>RewriteCond %{REMOTE_ADDR} ^192\\.168\\.1\\.100$</code>    Se cumple si el cliente viene de la IP <code>192.168.1.100</code>.</p> </li> <li> <p><code>RewriteCond %{REMOTE_ADDR} !^192\\.168\\.</code>    Se cumple si el cliente no est\u00e1 en la subred 192.168..`.</p> </li> </ul> <p>Ojo, Puedes poner varias <code>RewriteCond</code>: todas deben cumplirse para que se ejecute la regla que viene despu\u00e9s. Por \u00faltimo, nos queda desrbir la \u00faltima linea del htaccess.</p>"},{"location":"2%20Solucion/#-tercera-condicion","title":"-Tercera condici\u00f3n","text":"<pre><code>RewriteRule ^ index.php [L]\n</code></pre> <ul> <li> <p><code>^</code> en el patr\u00f3n: Como ya sab\u00e9is, en expresiones regulares, <code>^</code> significa \u201cinicio de la cadena\u201d. Aqu\u00ed el patr\u00f3n es <code>^</code>, lo que equivale a decir \u201ccualquier cosa que empiece en el principio\u201d, o sea, todas las URLs. Normalmente se combina con las condiciones de<code>RewriteCond</code> ya explicadas para filtrar casos, como ya haces con <code>!-f</code> y <code>!-d</code>.</p> </li> <li> <p><code>index.php</code> en el destino Significa: \u201creescribe la URL para que Apache sirva <code>index.php</code>\u201d. Esto no cambia lo que el usuario ve en el navegador, simplemente Apache decide que la petici\u00f3n <code>/productos/42</code> en realidad la atienda el archivo <code>index.php</code> y no por un archivo o carpeta que estuviera en <code>var/www/html</code>.</p> </li> <li> <p><code>[L]</code> (flag \u201cLast\u201d) Indica que esta debe ser la \u00faltima regla evaluada si se cumple. Una vez que Apache aplica esta regla, deja de mirar otras reglas de reescritura en ese contexto. Es como un <code>break</code> en un bucle de programaci\u00f3n.</p> </li> </ul> <p>Al igual que con las <code>RewriteCond</code> vemos la sint\u00e1xsis general de las <code>RewriteRule</code></p>"},{"location":"2%20Solucion/#-estudio-de-las-rewriterule-en-general","title":"- Estudio de las <code>RewriteRule</code> en general","text":"<pre><code>RewriteRule patr\u00f3n destino [flags]\n</code></pre> <ul> <li>patr\u00f3n : es una expresi\u00f3n regular (ver Anexo) que Apache aplica sobre la URL solicitada (normalmente sobre el <code>REQUEST_URI</code> sin el dominio inicial).</li> </ul> <p>[PREGUNTA] \u00bfQue es request_URI?</p> <p>SOL: <code>http://iaw/es/aburrida</code> : <code>REQUEST_URI = /es/aburrida</code> Es decir, parte de la url despu\u00e9s del dominio. FIN SOL.</p> <ul> <li> <p>destino : ad\u00f3nde se debe redirigir o reescribir la petici\u00f3n. Puede ser un archivo local (ej: <code>index.php</code>) o incluso una URL completa (<code>https://otro.com/</code>).</p> </li> <li> <p>[flags] : opciones que modifican el comportamiento (como <code>L</code>, <code>R</code>, etc.).</p> </li> </ul> <p>[PREGUNTA]: Busca informaci\u00f3n sobre otro flag que se pudiera a\u00f1adir e indica qu\u00e9 significar\u00eda.</p> <p>SOL. No os lo voy a preguntar. S\u00f3lo valorar\u00e9 que lo hay\u00e1is escrito correctamente y lo hay\u00e1is explicado y ejemplificado. FIN SOL.</p>"},{"location":"2%20Solucion/#-indexphp-con-conexion-a-mysql-y-dos-endpoints-simples","title":"- index.php con conexi\u00f3n a MySQL y dos endpoints simples","text":"<p>Ahora un ejemplo un poco m\u00e1s \u00fatil, que prueba la conexi\u00f3n a la base de datos con las credenciales que definiste en las variables de entorno de <code>docker-compose.yml</code> (No tienen porqu\u00e9 ser las mismas que yo puse).</p> <p>**[PREGUNTA] Esta pregunta es s\u00f3lo para ver si est\u00e1is siguiendo la lectura ya que lo que pregunto a continuaci\u00f3n ya ha sido explicado **</p> <ul> <li>\u00bfEn qu\u00e9 casos php y bajo qu\u00e9 peticiones del cliente ejecutar\u00e1 index.php APACHE?</li> </ul> <p>SOL: Cuando la URL solicitada no corresponde a un archivo o carpeta real. FIN SOL.</p> <pre><code>&lt;?php\nheader(\"Content-Type: application/json\");\n\n// Par\u00e1metros de conexi\u00f3n (los mismos que en docker-compose.yml)\n$host = \"db\";           // nombre del servicio de MySQL en docker-compose\n$user = \"testuser\";\n$pass = \"testpass\";\n$dbname = \"testdb\";\n\n// Conectar a MySQL\n$conn = new mysqli($host, $user, $pass, $dbname);\n\n// Verificar conexi\u00f3n\nif ($conn-&gt;connect_error) {\n    http_response_code(500);\n    echo json_encode([\"error\" =&gt; \"Error de conexi\u00f3n a la BD: \" . $conn-&gt;connect_error]);\n    exit();\n}\n\n// Obtener la ruta solicitada\n$uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);\n\n// ENDPOINT: /api/usuarios\nif ($uri === '/api/usuarios') {\n    $sql = \"CREATE TABLE IF NOT EXISTS usuarios (\n        id INT AUTO_INCREMENT PRIMARY KEY,\n        nombre VARCHAR(50) NOT NULL\n    )\";\n    $conn-&gt;query($sql);\n\n    // Insertar un usuario de prueba si la tabla est\u00e1 vac\u00eda\n    $conn-&gt;query(\"INSERT INTO usuarios (nombre)\n                  SELECT 'Ana'\n                  WHERE NOT EXISTS (SELECT 1 FROM usuarios)\");\n\n    $result = $conn-&gt;query(\"SELECT * FROM usuarios\");\n\n// Recorremos todos los resultados de la consulta SQL ($result)\n// fetch_assoc() devuelve cada fila como un array asociativo\n//   - Las claves son los nombres de las columnas de la tabla (ej: \"id\", \"nombre\")\n//   - Los valores son los datos de esa fila\n    $usuarios = [];\n    while ($row = $result-&gt;fetch_assoc()) {\n        $usuarios[] = $row;\n    }\n// Al final, $usuarios ser\u00e1 un array de arrays asociativos\n    echo json_encode($usuarios);\n}\n// ENDPOINT: /api/ping (solo prueba de vida)\nelseif ($uri === '/api/ping') {\n    echo json_encode([\"msg\" =&gt; \"pong\"]);\n}\nelse {\n    http_response_code(404);\n    echo json_encode([\"error\" =&gt; \"Endpoint no encontrado\"]);\n}\n\n$conn-&gt;close();\n</code></pre> <p>Adem\u00e1s, este archivo tiene dos endpoints definidos. Debes de contestar a las siguientes dos preguntas:</p> <p>**[PREGUNTA]: **</p> <p>SOL (valorar\u00e9 hasta donde hay\u00e1is ejemplificado):</p> <ul> <li>**\u00bfCu\u00e1les son esos dos endpoints? **</li> </ul> <p>Son dos recuros, index.php y productos.php, pero en total, definen 3 endpoints.   /api/usuarios; /api/ping; /productos.php</p> <ul> <li>\u00bfCu\u00e1l es el flujo que hace Apache desde la petici\u00f3n del cliente hasta que devuelve la respuesta del endpoint? (Mirar .htaccess)</li> </ul> <p>Despues de pasar las reglas de VirtualHost, pasa al .htaccess, donde el m\u00f3dulo <code>mod_rewrite</code> comprueba si el recurso solicitado existe f\u00edsicamente en el servidor. Si no existe, Apache redirige internamente la petici\u00f3n hacia <code>index.php</code></p> <ul> <li>**\u00bfTienen verbos http definidos estos endpoints? \u00bfResponder\u00edan ante cualquier tipo de verbo http? **</li> </ul> <p>En <code>/api/usuarios</code> y <code>/api/ping</code>, el c\u00f3digo no comprueba el m\u00e9todo as\u00ed que en la pr\u00e1ctica da igual  <code>GET</code>, <code>POST</code>, <code>PUT</code>.</p> <p>En<code>/productos.php</code> se Exige POST.</p> <ul> <li>**\u00bfQu\u00e9 tipo de \"Content-Type\" env\u00edan ambos al cliente? **</li> </ul> <p>header(\"Content-Type: application/json\");</p> <ul> <li>\u00bfSi tuvieras que darle un verbo http, que verbo le dar\u00edas a cada endpoint anterior? Justifica tu respuesta</li> </ul> <p>GET, GET y POST, respectivamente seg\u00fan el orden <code>/api/usuarios</code>, <code>/api/ping</code> y <code>/productos.php</code>:</p> <p>FIN SOL:</p>"},{"location":"2%20Solucion/#productosphp","title":"productos.php","text":"<pre><code>&lt;?php\nheader(\"Content-Type: application/json\");\n\n// Asegurar que sea POST\nif ($_SERVER['REQUEST_METHOD'] !== 'POST') {\n    http_response_code(405); // Method Not Allowed\n    echo json_encode([\"error\" =&gt; \"Solo se admite POST\"]);\n    exit();\n}\n\n// Asegurar que Content-Type sea application/json\nif (stripos($_SERVER[\"CONTENT_TYPE\"], \"application/json\") === false) {\n    http_response_code(400); // Bad Request\n    echo json_encode([\"error\" =&gt; \"Content-Type debe ser application/json\"]);\n    exit();\n}\n\n// Leer el cuerpo de la petici\u00f3n\n$input = file_get_contents(\"php://input\");\n$data = json_decode($input, true);\n\n// Validar JSON\nif (json_last_error() !== JSON_ERROR_NONE) {\n    http_response_code(400);\n    echo json_encode([\"error\" =&gt; \"JSON inv\u00e1lido\"]);\n    exit();\n}\n\n// Verificar que tenga el campo \"nombre\"\nif (empty($data['nombre'])) {\n    http_response_code(400);\n    echo json_encode([\"error\" =&gt; \"Falta el campo 'nombre'\"]);\n    exit();\n}\n\n// Conectar a la BD\n$host = \"db\";\n$user = \"testuser\";\n$pass = \"testpass\";\n$dbname = \"testdb\";\n\n$conn = new mysqli($host, $user, $pass, $dbname);\nif ($conn-&gt;connect_error) {\n    http_response_code(500);\n    echo json_encode([\"error\" =&gt; \"Error de conexi\u00f3n: \" . $conn-&gt;connect_error]);\n    exit();\n}\n\n// Crear tabla si no existe\n$conn-&gt;query(\"CREATE TABLE IF NOT EXISTS productos (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    nombre VARCHAR(100) NOT NULL\n)\");\n\n// Insertar el nuevo producto\n$nombre = $conn-&gt;real_escape_string($data['nombre']);\nif ($conn-&gt;query(\"INSERT INTO productos (nombre) VALUES ('$nombre')\")) {\n    http_response_code(201); // Created\n    echo json_encode([\n        \"success\" =&gt; true,\n        \"id\" =&gt; $conn-&gt;insert_id,\n        \"nombre\" =&gt; $data['nombre']\n    ]);\n} else {\n    http_response_code(500);\n    echo json_encode([\"error\" =&gt; \"Error al insertar producto\"]);\n}\n\n$conn-&gt;close();\n</code></pre> <p>**[PREGUNTA]: Tal y como esta configurado apache, el archivo php anterior representa un endpoint por si mismo. **</p> <ul> <li> <p>\u00bfC\u00f3mo se hace la petici\u00f3n a ese archivo? \u00bfQu\u00e9 tipo de verbo http ser\u00eda?    http://localhost/productos.php en el navegador es un error, ya que no puedo hacer un post y har\u00e1 por defecto un GET. la petici\u00f3n se hace con un fetch de javaScript, con Postman, con un curl o con un formulario HTML, eligiendo POST y en Content-Type correcto.</p> </li> <li> <p>\u00bfQu\u00e9 tipo de formato de datos accepta la petici\u00f3n? \u00bfQu\u00e9 tipo de formato devuelve?</p> </li> </ul> <p>POST. El cliente env\u00eda JSON y recibe JSON. Justificalo un poco m\u00e1s pero esa es la respuesta.</p> <ul> <li>Prueba a a hacer una petici\u00f3n con POSTMAN y otra con CURL y adjunta capturas de la respuesta.</li> </ul> <p>Os hab\u00e9is hartado de hacer esto en la pr\u00e1ctica 1. No tiene mucho misterio.</p> <p></p> <p>\u200b Con curl ser\u00eda as\u00ed:</p> <pre><code>curl -X POST http://localhost/productos.php -H \"Content-Type: application/json\" -d '{\"nombre\": \"Camiseta\"}'\n</code></pre> <p>[PREGUNTA] En esta pr\u00e1ctica hab\u00e9is configurado manualmente vuestro servidor Apache con <code>000-default.conf</code> y un <code>.htaccess</code> para redirigir (algunas) lURLs a <code>index.php</code>. Todo el control de rutas, autenticaci\u00f3n y cach\u00e9 lo hab\u00e9is hecho directamente en el servidor web.</p> <ul> <li>\u00bfQu\u00e9 cambia cuando usamos un framework como Laravel?</li> </ul> <p>Tendremos un script universal, el cual se suele llamar index.php que levantar\u00e1 el servidor recibir\u00e1 las peticiones, har\u00e1 una conexi\u00f3n persistente a la base de datos y definir\u00e1 endpoints (sin necesidad de que sean recursos del servidor), muy parecido a lo que ahcemos en esta pr\u00e1ctica con index.php.</p> <ul> <li>\u00bfD\u00f3nde se definen las rutas en ese caso: en el servidor Apache o dentro del framework?</li> </ul> <p>Las rutas o endpoints ya no son un script del servidor que se pide y se ejecuta, es decir, no son archivos php si no que son sentencias l\u00f3gicas dentro de otros scripts. En Laravel se definen en archivos como:</p> <ul> <li><code>routes/api.php</code> </li> </ul> <p>Por ejemplo, se puede definir la ruta <code>http://locahost/productos</code> escribiendo esta sentencia en el script de Laravel:</p> <pre><code>Route::get('/productos', [ProductoController::class, 'index']);\n</code></pre> <p>Donde definimos la ruta <code>/productos</code>, que ser\u00e1 de tipo <code>GET</code> y lo que har\u00e1 estar\u00e1 o proporcionar\u00e1 este endpoint al cliente estar\u00e1 definido en el m\u00e9todo <code>index</code> de la clase <code>ProductoController</code></p> <ul> <li>\u00bfQu\u00e9 ventajas y desventajas tiene cada enfoque (controlarlo en Apache vs. dejarlo al framework)?</li> </ul> <p>Cuando Apache gestiona las rutas mediante archivos como <code>.htaccess</code> o <code>000-default.conf</code>, es el servidor quien decide qu\u00e9 archivo PHP responder\u00e1 seg\u00fan la URL, pero a medida que el proyecto crece, mantener las rutas y configuraciones en el servidor se vuelve muy dificil ya que tienes que manejar al mismo tiempo la configuraci\u00f3n de Apache y la l\u00f3gica de PHP. Ahora bien, cuando usas un framework como por ejemplo: Laravel (uno de los m\u00e1s usados para PHP), los endpoints se definen directamente en el c\u00f3digo. Esto permite alejarnos un poco de la configuraci\u00f3n del servidor y aprovechar herramientas del framework como (controladores, middleware, validaci\u00f3n, autenticaci\u00f3n, cach\u00e9 o pol\u00edticas de acceso...), que podr\u00e1n tener muchas m\u00e1s versatilidad que muchas de las opciones que nos ofrece apache y en esencia, har\u00e1n lo mismo.</p> <ul> <li>\u00bfPor qu\u00e9 cre\u00e9is que en proyectos grandes se recomienda que Apache solo apunte a <code>public/</code> y que el framework gestione las rutas y la l\u00f3gica?</li> </ul> <p>Esta es la clave. No configuraremos nada en Apache, solamente, apuntar\u00e1 a public donde estar\u00e1 el script universal que hablamos en la pregunta 1, el famoso: <code>index.php</code> . De esta forma, delegamos todas las configuraciones en el framework para dejar las configuraciones de Apache de lado.</p> <p>**[PREGUNTA] A lo largo de la pr\u00e1ctica has visto que se ha utilizado la extensi\u00f3n mysqli para hacer querys. **</p> <ul> <li>\u00bfQu\u00e9 desventaja tiene esto en un servidor Web real?</li> </ul> <p>Son muchas las cosas que pod\u00e9is poner aqu\u00ed. Hago una lista de las que considero m\u00e1s importantes.</p> <p>-EL c\u00f3digo es confuso. Cada vez que el cliente hace una petici\u00f3n hay que conectarse a la BDD lo que es repetitivo y a la hora de escalar en aplicaciones m\u00e1s grandes, complejo.</p> <p>-La conexi\u00f3n a la BDD no es persistente, cada vez que se levanta el servidor y el cliente env\u00eda una petici\u00f3n a Apache, se abre una conexi\u00f3n y al terminar la respuesta del servidor, se cierra.</p> <p>-El lenguaje SQL se escribe directamente (raw). Si no eres experto en bases de datos, es f\u00e1cil cometer errores: no solo puedes escribir consultas vulnerables a inyecciones SQL, sino que muchas pueden no estar muy optimizadas y por tanto consumir demasiados recursos del servidor.</p> <ul> <li>\u00bfQu\u00e9 es un ORM y que relaci\u00f3n tiene con lo anterior?</li> </ul> <p>Un ORM (Object-Relational Mapping) permite trabajar con la base de datos usando objetos prefedinifidos por una librer\u00eda en espec\u00edfico (por ejemplo, Mongoose para MongoDB) y clases, en lugar de escribir directamente SQL. Esto ahce que el c\u00f3digo sea mucho m\u00e1s seguro ya que est\u00e1 preparado para afrontar vulnerabilidades que un usuario no experimentado no llegue a comprender.</p> <ul> <li>\u00bfQu\u00e9 ventajas ofrecen los ORM que nos proporcionan algunos frameworks como Larabel?</li> </ul> <p>En mi opini\u00f3n personal, la ventaja principal es la siguiente (aunque si me pon\u00e9is cualquier otra cosa que tenga sentido, la aceptar\u00e9): la base de datos se gestiona de forma m\u00e1s eficiente con los ORM que nos proporciona Larabel, porque se reutiliza la conexi\u00f3n a la BDD en lugar de abrirla y cerrarla en cada consulta (esto es justo lo que pasa con mysqli). Gracias a esto la misma conexi\u00f3n se mantiene activa durante la petici\u00f3n y puede volver a usarse sin que se cierre al terminar la ejecuci\u00f3n de c\u00f3digo que el server hace al cliente. Esto reduce el consumo de recursos y evita posibles errores.</p>"},{"location":"2%20Solucion/#anexo-cosas-basis-de-regexp-con-algunos-ejemplos","title":"Anexo (Cosas b\u00e1sis de regexp con algunos ejemplos)","text":"<ul> <li>Caracteres literales : Un string  tal cual. Ej: <code>hola</code> encuentra \u201chola\u201d.</li> <li>Metacaracteres:</li> <li><code>.</code> : cualquier car\u00e1cter.</li> <li><code>^</code> : inicio de la cadena.</li> <li><code>$</code> : fin de la cadena.</li> <li><code>*</code> : cero o m\u00e1s repeticiones.</li> <li><code>+</code> : una o m\u00e1s repeticiones.</li> <li><code>?</code> : opcional (cero o una).</li> <li><code>[]</code> : conjunto de caracteres. Ej: <code>[0-9]</code> = cualquier d\u00edgito.</li> <li><code>|</code> : alternancia (OR). Ej: <code>perro|gato</code>.</li> <li><code>()</code> : agrupar.</li> <li><code>{n}</code> : exactamente n veces.</li> <li><code>{n,}</code> : al menos n veces (sin l\u00edmite superior).</li> <li> <p><code>{n,m}</code> : entre n y m veces.</p> </li> <li> <p>Ejemplos t\u00edpicos (si entiendes estos ejemplos, vas bien con las regexp, si no, rep\u00e1satelas por favor)</p> </li> <li> <p><code>^[0-9]+$</code> : solo n\u00fameros enteros.</p> </li> <li> <p><code>^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$</code> : email b\u00e1sico.</p> </li> <li> <p><code>\\.(jpg|jpeg|png)$</code> : archivos que terminan en <code>.jpg</code>, <code>.jpeg</code> o <code>.png</code>.</p> </li> <li> <p><code>^https?://</code>: URLs que empiezan por <code>http://</code> o <code>https://</code>. (piensa que hace)</p> </li> <li> <p><code>^[0-9]+([.,][0-9]+)?$</code>: (piensa que hace)</p> </li> <li> <p><code>^(0[1-9]|[12][0-9]|3[01])/(0[1-9]|1[0-2])/[0-9]{4}$</code>: (piensa que hace)</p> </li> </ul>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/","title":"Introduccion a APACHE e instalacion. Practica 2","text":""},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#practica","title":"Pr\u00e1ctica","text":"<p>Esta pr\u00e1ctica guiada consiste en ejecutar distintos bloques de c\u00f3digo y responder a las preguntas que se plantean a lo largo del proceso. Para resolverlas, pod\u00e9is apoyaros en b\u00fasquedas en internet o en herramientas de IA. La idea es que os creeis un proyecto con informaci\u00f3n que os ir\u00e9 pasando en cada bloque de texto. Para ello, deber\u00e1s crear una carpeta y seguir las instrucciones aqu\u00ed especificadas.</p> <p>El objetivo es que, a trav\u00e9s de estas preguntas y de la ejecuci\u00f3n de ejemplos, entend\u00e1is mejor c\u00f3mo montar un servidor en PHP y, al mismo tiempo, adquir\u00e1is nociones b\u00e1sicas de Docker y Docker Compose: uso de vol\u00famenes, bind mounts y redes bridge.</p> <p>A nivel personal, el objetivo es que vay\u00e1is creando vuestro propio proyecto a la vez que le\u00e9is y comprend\u00e9is la siguiente documentaci\u00f3n t\u00e9cnica. Como avanz\u00e1bamos antes, la primera parte de Docker Compose trata sobre la instalaci\u00f3n. No ten\u00e9is que saber c\u00f3mo funciona docker-compose desde un punto de vista demasiado t\u00e9cnico pero s\u00ed deber\u00e9is saber que existe Docker Hub, de donde salen las im\u00e1genes y cu\u00e1les suelen ser las claves m\u00e1s comunes en los YAML que permiten la creaci\u00f3n de contenedores a partir de docker compose. En cuanto a Apache, veremos una configuraci\u00f3n b\u00e1sica con las opciones m\u00e1s usuales.</p>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#1-instlacion-de-apache-descentralizada-con-docker","title":"1 Instlacion de Apache descentralizada con Docker","text":"<p>En esta parte de la pr\u00e1ctica vais a montar un entorno similar a XAMPP pero usando Docker y Docker Compose. En lugar de instalar manualmente Apache, MySQL y PHP en vuestro ordenador (como hace XAMPP), levantar\u00e9is contenedores que se comunican entre s\u00ed para daros el mismo resultado. La estrcutura del proyecto que os debeis crear es la siguiente:</p> <pre><code>project/\n\u2502\u2500\u2500 docker-compose.yml\n\u2502\u2500\u2500 Dockerfile\n\u2502\u2500\u2500 www/\n\u2502   \u251c\u2500\u2500 index.php\n\u2502   \u2514\u2500\u2500 .htaccess\n\u2502   \u2514\u2500\u2500 productos.php\n\u2514\u2500\u2500 apache/\n    \u2514\u2500\u2500 000-default.conf\n</code></pre> <p>En los puntos que veremos a continuaci\u00f3n, os dar\u00e9 el c\u00f3digo necesario para la ejecuci\u00f3n.</p>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#-11-docker-composeyml","title":"-1.1 docker-compose.yml:","text":"<pre><code>services:\n  apache-php:\n    image: php:8.2-apache\n    container_name: apache-php\n    ports:\n      - \"8080:80\"\n    volumes:\n      - ./www:/var/www/html\n    depends_on:\n      - db\n    restart: always\n    build:\n      context: .\n      dockerfile: Dockerfile\n\n  db:\n    image: mysql:8.0\n    container_name: mysql-db\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD: rootpass\n      MYSQL_DATABASE: testdb\n      MYSQL_USER: testuser\n      MYSQL_PASSWORD: testpass\n    ports:\n      - \"3306:3306\"\n    volumes:\n      - db_data:/var/lib/mysql\n\n  phpmyadmin:\n    image: phpmyadmin/phpmyadmin\n    container_name: phpmyadmin\n    restart: always\n    ports:\n      - \"8081:80\"\n    environment:\n      PMA_HOST: db\n      MYSQL_ROOT_PASSWORD: rootpass\n    depends_on:\n      - db\n\nvolumes:\n  db_data:\n</code></pre> <ol> <li> <p>apache-php: Imagen base: <code>php:8.2-apache</code>. Es el servicio que act\u00faa como servidor web y int\u00e9rprete de PHP. Sirve las p\u00e1ginas desde la carpeta <code>./www</code> (en tu m\u00e1quina) que se monta dentro del contenedor en <code>/var/www/html</code>. Tiene extensiones de PHP para conectarse a MySQL (<code>pdo_mysql</code>, <code>mysqli</code>).</p> </li> <li> <p>db: Imagen base: <code>mysql:8.0</code>. Contenedor que levanta una base de datos MySQL. Contiene algunas variables de entorno que s epueden ver en el repo de la imagen en dockerhub (tal y como hemos visto en clase s\u00f3lo utilzaremos las siguiente variables de entorno).</p> </li> <li> <p>Variables de entorno:</p> <ul> <li><code>MYSQL_ROOT_PASSWORD</code> : contrase\u00f1a del usuario administrador.</li> <li><code>MYSQL_DATABASE</code> : base creada autom\u00e1ticamente al iniciar.</li> <li><code>MYSQL_USER</code> y <code>MYSQL_PASSWORD</code>: usuario adicional para que se conecte tu aplicaci\u00f3n.</li> </ul> <p>Ojo, los datos de este servicio se guardan en un volumen (<code>db_data</code>), de manera que no se pierden al reiniciar o borrar el contenedor. Podeis investigar los comandos que tienen docker para ver qu\u00e9 vol\u00famenes ten\u00e9is en vuestro ordenador y c\u00f3mo visualizarlos y borrarlos, pero es opcional. Solo teneis que entender que en el momento que se asocia un volumen a una carpeta de un contenedor, los datos persisten.</p> </li> <li> <p>phpmyadmin</p> </li> <li>Imagen base: <code>phpmyadmin/phpmyadmin</code>.</li> <li>Es un servicio extra para tener una interfaz web de administraci\u00f3n de MySQL. En nuestro caso, se accede desde el navegador en <code>http://localhost:8081</code>. No lo veremos por ahora pero ofrece una interfaz grafica m\u00e1s o menos amigable.</li> </ol> <p>Explicados los tres servicios, la instalaci\u00f3n funciona de la siguiente manera. Con el c\u00f3digo anterior:</p> <ul> <li> <p>Levantas 3 contenedores. Cada uno tiene el n\u00famero estandar de puertos y cada uno ejecuta el programa correspondiente en el puerto usualmente destinado a su ejecuci\u00f3n, por ejemplo, apache corre en el puerto 80 de su propio contenedor pero se mapea con el 8080 de mi host.</p> </li> <li> <p>De igual forma, el resto de contenedores correran los programas espec\u00edficos en los puertos correspondientes.</p> </li> </ul> <p>[PREGUNTA]: \u00bfEn qu\u00e9 puertos internos de los contenedores corren los programas anteriores y a qu\u00e9 puertos del host se mapean?</p> <ul> <li>Ahora bien, los programas se pueden comunicar entre s\u00ed gracias a que docker incluye a cada servicio en una interfaz red bridge que permite la comunicaci\u00f3n entre ellos.</li> </ul> <p>[PREGUNTA]: Imagina que yo instalase los programas independientemente cada uno en mi host, sin usar docker. \u00bfQu\u00e9 puertos de qu\u00e9 maquinas utilzar\u00edan por defecto? \u00bfMediante que interfaz de red se comunicar\u00eda unos con otros?</p> <p>[Pregunta]: Quiero que expliques que significa esto:</p> <pre><code>services:\n  apache-php:\n   image: php:8.2-apache\n   volumes:\n      - ./www:/var/www/html\n   build:\n      context: .\n      dockerfile: Dockerfile\n\n  db:      \n    volumes:\n      - db_data:/var/lib/mysql\n</code></pre> <p>Todo en docker funciona a trav\u00e9s de una \"imagen previa\".  Una imagen en Docker es como una plantilla o fotograf\u00eda inmutable que contiene todo lo necesario para ejecutar un programa, es decir, a partir de esa plantilla se puede ejecutar practicamente el servicio que quieras.  Habitualmente, esa plantilla se suele crear a trav\u00e9s de un Dockerfile, que es un archivo que contiene las instrucciones de creaci\u00f3n de la plantilla. Aunque no es siempre as\u00ed, el caso m\u00e1s habitual es coger la imagen de Docker Hub, aplicacion web que funciona como repositorio de imagenes para los servicios m\u00e1s populares (como apache). De hecho, incluso en el archivo del Dockerfile, se suele empezar desde una imagen previa que se encontrar\u00e1 en DockerHub.</p> <p>[PREGUNTA]: M\u00e1s abajo, encontrar\u00e1s el Dockerfile que se usa en esta pr\u00e1ctica, \u00bfqu\u00e9 imagen de DockerHub est\u00e1 utilizando?</p> <p>En ejemplo anterior es un caso muy raro, porque parece ser que el servicio se instala a partir de la imagen \"php:8.2-apache\". Esto no es cierto, porque abajo tenemos un \"build\", que nos indique que la imagen se construye a partir del docker file (llamado \"Dockerfile\"), que se encuentra en nuestro directorio actual. En el caso de que tanto image como build est\u00e9n sobre un mismo \"services\", image ser\u00e1 el nombre que asocia Docker internamente a la imagen.</p>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#2-el-dockerfile","title":"2 El Dockerfile","text":"<p>Lo m\u00e1s importante es que, desde el Dockerfile, cargamos m\u00f3dulos de apache con a2enmod, que utilziaremos m\u00e1s adelante:</p> <p></p> <p>En particular, el dockerfile usado en la instalaci\u00f3n es el siguiente.</p> <pre><code>FROM php:8.2-apache\n\n# Instalamos extensiones de PHP para MySQL. docker-php-ext-install es un script que viene incluido en las im\u00e1genes oficiales de PHP (como php:8.2-apache).\nRUN docker-php-ext-install pdo pdo_mysql mysqli\n\n\n#Es un comando que activa m\u00f3dulos de Apache. rewrite Es un m\u00f3dulo de Apache que permite cambiar la forma en la que se interpretan las URLs. .htaccess es un archivo donde escribes las reglas que mod_rewrite ejecuta.\nRUN a2enmod rewrite headers expires\n</code></pre> <p>Antes hemos comentado que los Dockerfile pueden crear por si mismos una imagen que despu\u00e9s se ejecute como contenedor (gracias a los comandos FROM, LABEL, RUN, COPY, ADD, WORKDIR, EXPOSE, ENV, ARG, CMD, ENTRYPOINT, VOLUME) De hecho, si tenemos un Dockerfile con c\u00f3digo en nuestro ordenador, ejecutando la siguiente linea de c\u00f3digo, podr\u00edamos crear una imagen propia.</p> <pre><code>docker build -t nombre_imagen:tag -f Dockerfile .\n</code></pre> <ul> <li><code>docker build</code> : es el comando para construir una imagen.</li> <li><code>-t nombre_imagen:tag</code> : asigna un nombre y una etiqueta (tag) a la imagen.</li> <li><code>-f Dockerfile</code> : indica el archivo Dockerfile a usar. No es obligatorio si el archivo se llama exactamente <code>Dockerfile</code>.</li> <li><code>.</code> (punto final) : ruta del contexto de build, normalmente la carpeta actual donde est\u00e1 el Dockerfile y los archivos que quieres copiar dentro de la imagen.</li> </ul> <p>En el siguiente ejemplo, crear\u00edamos una imagen llamada miapp:1.0</p> <pre><code>docker build -t miapp:1.0 .\n</code></pre> <p>Volviendo al Dockerfile de nuestro proyecto, al principio tenemos: FROM php:8.2-apache. Si esta imagen la hubiera creado yo anteriormente a trav\u00e9s de un Dockerfile, docker la sacar\u00eda de mi host. En caso de no exister, la saca de Dockerhub. Ese es el flujo normal. En el Dockerfile anterior, utilizamos algunos m\u00f3dulos interesantes para nuestro archivo de configuraci\u00f3n (siguiente punto) que cargamos gracias a la funcionalidad docker-php-ext-install de apache. Os hago la siguiente pregunta de la que deber\u00e9is busca informaci\u00f3n.</p> <p>[PREGUNTA]:</p> <ul> <li>\u00bfQu\u00e9 m\u00f3dulos cargamos?</li> <li>\u00bfPara qu\u00e9 srive cada uno?</li> <li>\u00bfQu\u00e9 m\u00f3dulo se utilizar\u00eda (no est\u00e1) para capturar y filtrar n\u00famero de peticiones? (rate limit). Si no sabes qu\u00e9 es el rate limit, deber\u00e1s indicarlo aqu\u00ed tambi\u00e9n</li> </ul>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#3-apache000-defaultconf-explicamos-cada-uno-de-ellos","title":"3 apache/000-default.conf: (explicamos cada uno de ellos)","text":"<p>El objetivo de lo siguiente es hablar del archivo de configuraci\u00f3n inicial de apache y de cada una de sus peculiaridades. Al igual que con la parte anterior de la pr\u00e1ctica, os ir\u00e9 haciendo preguntas al respecto de lo que vaya saliendo, poco a poco.</p> <p></p>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#31-el-codigo-del-000-defaultconf","title":"3.1 El c\u00f3digo del 000-default.conf","text":"<pre><code>&lt;VirtualHost *:80&gt;\n    ServerAdmin webmaster@localhost\n    DocumentRoot /var/www/html\n\n    &lt;Directory /var/www/html&gt;\n        # Opciones de directorio\n        Options -Indexes +FollowSymLinks\n        AllowOverride All\n        Require all granted\n    &lt;/Directory&gt;\n\n    # Seguridad con cabeceras\n    Header always set X-Content-Type-Options \"nosniff\"\n    Header always set Referrer-Policy \"strict-origin-when-cross-origin\"\n    Header always set Content-Security-Policy \"default-src 'self'; object-src 'none'; base-uri 'self'\"\n\n\n    # Autenticaci\u00f3n para la carpeta /admin. Ahora mismo no tenemos ni siquiera la carpeta creada y menos el fichero con\n    #la contrase\u00f1a, ser\u00eda interesante (aunque no lo pido en la pr\u00e1ctica, que prob\u00e9is a hacerlo por vosotros mismos.)\n    &lt;Directory /var/www/html/admin&gt;\n        AuthType Basic\n        AuthName \"Zona restringida\"\n        AuthUserFile /etc/apache2/.htpasswd\n        Require valid-user\n    &lt;/Directory&gt;\n\n    # Control de cach\u00e9 para est\u00e1ticos (mejora rendimiento)\n    &lt;FilesMatch \"\\.(jpg|jpeg|png|gif|css|js|ico|woff2?)$\"&gt;\n        ExpiresActive On\n        ExpiresDefault \"access plus 1 month\"\n    &lt;/FilesMatch&gt;\n\n    # Restringir carpeta sensible solo a una IP (permite solo esa IP)\n    &lt;Directory /var/www/html/dev-tools&gt;\n        Require ip 192.168.1.100\n    &lt;/Directory&gt;\n\n    # Logs\n    ErrorLog ${APACHE_LOG_DIR}/app-error.log\n    CustomLog ${APACHE_LOG_DIR}/app-access.log combined\n&lt;/VirtualHost&gt;\n</code></pre>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#32-analizando-el-000-defaultconf","title":"3.2 Analizando el 000-default.conf","text":"<ul> <li> <p>Empieza con la etiqueta <code>\\&lt;VirtualHost *:80&gt;</code> y termina con su cierre  <code>\\&lt;/VirtualHost&gt;</code>. Con eso Apache define un  \"bloque de sitio\u201d que escucha en el puerto 80 de todas las interfaces (<code>*</code>).  Dentro del contenedor, Apache escucha en el 80; fuera, t\u00fa lo ves en <code>http://localhost:8080</code> porque Docker hace el mapeo <code>8080:80</code>. Si alg\u00fan d\u00eda tienes m\u00e1s \"sitios\", puedes crear m\u00e1s bloques <code>VirtualHost</code> (incluso uno por dominio) y diferenciarlos con <code>ServerName</code>.</p> <p>[PREGUNTA]: \u00bfQu\u00e9 pasa si reutilizo la etiqueta VirtualHost? \u00bfPodr\u00eda servir \"dos sitios\" con reglas distintas?.</p> </li> <li> <p><code>ServerAdmin webmaster@localhost</code> es solo un correo de contacto que Apache muestra en algunas p\u00e1ginas de error y mete en los logs. No afecta al funcionamiento; puedes poner tu email real o ignorarlo.</p> </li> <li> <p><code>DocumentRoot /var/www/html</code> indica la carpeta p\u00fablica desde la que Apache sirve archivos. En tu setup, esa ruta est\u00e1 montada desde tu m\u00e1quina con <code>./www:/var/www/html</code>, as\u00ed que lo que guardes en <code>./www</code> es lo que ve Apache y lo que se sirve al navegador (Esto es justo lo que vimos ayer en clase meti\u00e9ndonos dentro del contenedor).  El bloque <code>\\&lt;Directory /var/www/html&gt;</code> aplica reglas espec\u00edficas a esa carpeta:</p> </li> <li> <p><code>Options -Indexes +FollowSymLinks</code> controla funcionalidades dentro del directorio.</p> </li> <li> <p><code>-Indexes</code> desactiva el listado de directorios. Es m\u00e1s seguro y profesional.</p> <p>[PREGUNTA]: Esta explicaci\u00f3n puede que no quede muy clara, especifica qu\u00e9 significa con un ejemplo. Lanza tu servidor con esta opci\u00f3n y sin esta y comprueba por ti mismo (adjuntando captura de pantalla) que efectivamente sucede as\u00ed.</p> </li> <li> <p><code>+FollowSymLinks</code> permite a Apache seguir enlaces simb\u00f3licos. \u00datil si apuntas subcarpetas a otros lugares. Si quieres ser a\u00fan m\u00e1s estricto, existe <code>SymLinksIfOwnerMatch</code> (solo sigue el symlink si el propietario coincide), pero <code>FollowSymLinks</code> es lo habitual.</p> <p>[PREGUNTA]: Pon ejemplos de qu\u00e9 significa esto definiendo distintos propietarios: Para guiarte un poco, piensa que la carpeta /var/www/privado con propietario manolo  se crea un enlace con /var/www/html/privado. Si alguien accede por red, \u00bfpodr\u00eda ver el contenido de /var/www/html/privado? Para ello investiga con que usuario se indenficar\u00eda dicha persona al entrar a la web e intentar la redirecci\u00f3n.</p> </li> <li> <p><code>AllowOverride</code> es otra directiva de Apache que en este caso controla qu\u00e9 directivas est\u00e1n permitidas dentro de un <code>.htaccess</code> (archivo que veremos m\u00e1s tarde). Le est\u00e1s diciendo a Apache en este caso: \u201cDentro de esta carpeta, haz caso a los archivos <code>.htaccess</code> que haya\u201d. Significa que Apache permitir\u00e1 archivos <code>.htaccess</code> en esa carpeta (en este caso:<code>/var/www/html</code>) y en cualquiera de sus subcarpetas (ojo, lo de cualquiera de sus subcarpetas es importante y m\u00e1s tarde veremos porqu\u00e9, ya que afecta al funcionamiento de un servidor en producci\u00f3n y provoca que, habitualmente, no se cree el archivo .htacess. </p> <p>En conclusi\u00f3n: es muy com\u00fan dejarlo en \"All\" durante desarrollo y como hemos dicho, en producci\u00f3n, por rendimiento, muchos mueven esas reglas al propio VirtualHost y ponen <code>AllowOverride None</code>. Lo veremos m\u00e1s tarde.</p> </li> <li> <p><code>Require all granted</code> es la regla de acceso (desde Apache 2.4). Significa \u201cpermite acceso a cualquiera\u201d. Si no la pones (o niegas el acceso), podr\u00edas ver errores 403 (los c\u00f3digos de errores los he comentado ya mucho en clase pero los veremos cuando generemos nuestros propios endpoints). Es la forma moderna de los antiguos <code>Allow from all</code>. Ejemplo: solo permitir a la IP <code>192.168.1.100</code> ser\u00eda de la forma: Require ip 192.168.1.100.</p> </li> </ul> <p>[PREGUNTA]: \u00bfC\u00f3mo se podr\u00eda negar el acceso a una sola IP a nuestro servidor Apache?</p> <p><code>/etc/apache2/envvars</code> lugar f\u00edsico donde se encuentran las ENV</p> <ul> <li><code>ErrorLog ${APACHE_LOG_DIR}/app-error.log</code> </li> </ul> <p>[PREGUNTA]: \u00bfQu\u00e9 tipo de errores guarda el log app-error.log?</p> <p>[PREGUNTA]: \u00bfQu\u00e9 significa ${APACHE_LOG_DIR} y donde se guardan dichas variables?</p> <ul> <li><code>CustomLog ${APACHE_LOG_DIR}/app-access.log combined</code> </li> </ul> <p>[PREGUNTA]: Durante las pr\u00e1cticas anteriores, has hecho peticiones http a un servidor. \u00bfQu\u00e9 es lo que se ver\u00eda en este caso en app-access.log y que relacion tiene con la pr\u00e1ctica anterior?</p> <ul> <li><code>&lt;Directory /var/www/html/admin&gt;</code> Tenemos una regla de autenticaci\u00f3n sobre este directorio, aunque si os fij\u00e1is y tal y como pongo en el comentario encima de la regla, el directorio no existe, aunque no afecta a Apache.</li> </ul> <p>Lo que has visto en ese bloque de configuraci\u00f3n es un ejemplo de autenticaci\u00f3n HTTP b\u00e1sica en Apache. Sirve para proteger con usuario y contrase\u00f1a un directorio concreto, en este caso <code>/var/www/html/admin</code>.</p> <ul> <li> <p>La directiva <code>AuthType Basic</code> indica que se usar\u00e1 el m\u00e9todo de autenticaci\u00f3n m\u00e1s sencillo, llamado Basic. Este funciona enviando el usuario y la contrase\u00f1a codificados en base64 (debes saber qu\u00e9 es ya que muchas veces los servidores env\u00eda binarios en base64) en cada petici\u00f3n. Por eso, en la pr\u00e1ctica, siempre se recomienda usarlo junto con HTTPS para que las credenciales viajen cifradas. </p> <p>[PREGUNTA]  Auth Type sirve para proteger recursos. El estandar a d\u00eda de hoy ha cambiado a JWT. Busca informaci\u00f3n al respecto sobre qu\u00e9 es. \u00bfTodo el mundo debe tener derecho a acceder a cualquier endpont?</p> </li> <li> <p><code>AuthName \"Zona restringida\"</code> define el texto que ver\u00e1 el usuario cuando el navegador muestre la ventana emergente pidi\u00e9ndole credenciales. No afecta a la seguridad, es simplemente informativo, pero ayuda a diferenciar distintas \u00e1reas protegidas de un mismo servidor.</p> </li> <li> <p>La l\u00ednea <code>AuthUserFile /etc/apache2/.htpasswd</code> indica d\u00f3nde est\u00e1 guardado el archivo que contiene los usuarios y contrase\u00f1as autorizados. E nuestro proyecto no lo tenemos definido porque, de hecho la carpeta /admin no existe. Ese archivo <code>.htpasswd</code> NO debe estar dentro de la carpeta p\u00fablica del servidor web, porque si no, cualquiera podr\u00eda descargarlo. En \u00e9l se almacenan las credenciales en formato cifrado (normalmente con algoritmos como MD5, SHA o bcrypt).</p> </li> <li> <p>Finalmente, <code>Require valid-user</code> define qui\u00e9n puede acceder. En este caso, \u201cvalid-user\u201d significa que cualquiera de los usuarios definidos en el archivo <code>.htpasswd</code> podr\u00e1 entrar. Pero hay otras variantes: se puede especificar <code>Require user juan</code> para permitir solo a un usuario concreto, o <code>Require user juan pedro</code> para permitir \u00fanicamente a esos dos. Tambi\u00e9n existe la posibilidad de trabajar con grupos de usuarios, usando <code>Require group admins</code>, donde los grupos se definen en un archivo adicional llamado <code>.htgroup</code>.</p> </li> <li> <p>Vamos con el siguiente cacho de c\u00f3digo, que es muy interesante y muy pr\u00e1ctico:</p> </li> </ul> <pre><code>&lt;FilesMatch \"\\.(jpg|jpeg|png|gif|css|js|ico|woff2?)$\"&gt;\n    ExpiresActive On\n    ExpiresDefault \"access plus 1 month\"\n&lt;/FilesMatch&gt;\n</code></pre> <p>Esto significa: \u201cAplica las siguientes reglas a todos los archivos cuyo nombre termine en <code>.jpg</code>, <code>.jpeg</code>, <code>.png</code>, <code>.gif</code>, <code>.css</code>, <code>.js</code>, <code>.ico</code> o <code>.woff/woff2</code> (fuentes web)\u201d. Es decir, cualquier recurso est\u00e1tico habitual de una web (con est\u00e1tico nos referimos a archivos que sualmente no van a cambiar y que se van a mandar tal cual). Dentro de ese bloque, <code>ExpiresActive On</code> activa el m\u00f3dulo de caducidad de cach\u00e9. Y <code>ExpiresDefault \"access plus 1 month\"</code> establece que el navegador puede mantener esos archivos en cach\u00e9 durante un mes a partir del momento en que los descarga. Ojo, el navegador del cliente ser\u00eda el que cachear\u00eda dicha informaci\u00f3n, evitando as\u00ed incluso que la petici\u00f3n llegue al servidor. La cuesti\u00f3n aqu\u00ed es saber c\u00f3mo se le dice al navegador que cachee dicha petici\u00f3n, eso lo veremos ahora y avanzo que ser\u00e1 gracias a las cabeceras http de la respuesta del servidor!</p> <p>Con todo esto, si un usuario entra varias veces a tu web, su navegador no volver\u00e1 a pedir al servidor la imagen del logo, los estilos CSS o el JavaScript en cada carga, sino que reutilizar\u00e1 los que ya descarg\u00f3 hasta que pase un mes. Como es l\u00f3gico, el resultado es que la web se siente mucho m\u00e1s r\u00e1pida y consumes menos ancho de banda en el servidor. Lo interesante es que puedes personalizar estas reglas para diferentes tipos de archivo. Por ejemplo:</p> <ul> <li>Para im\u00e1genes y v\u00eddeos grandes, podr\u00edas poner m\u00e1s tiempo (Esto no viene en nuestro archivo de configuraci\u00f3n): Fijate que la directiva es ExpiresByType </li> </ul> <pre><code>ExpiresByType image/jpeg \"access plus 1 year\"\nExpiresByType image/png \"access plus 1 year\"\nExpiresByType video/mp4 \"access plus 1 year\"\n</code></pre> <ul> <li>Para archivos CSS y JS, quiz\u00e1 prefieras menos tiempo, como una semana, porque podr\u00edas actualizarlos con frecuencia durante el desarrollo (Esto no viene en nuestro archivo de configuraci\u00f3n):</li> </ul> <pre><code>Para archivos CSS y JS, quiz\u00e1 prefieras menos tiempo, como una semana, porque podr\u00edas actualizarlos con frecuencia durante el desarrollo\n</code></pre> <ul> <li>Para documentos sensibles o que cambian mucho (como  un endpoint PHP), lo normal es directamente desactivar la cach\u00e9 (Esto no viene en nuestro archivo de configuraci\u00f3n): </li> </ul> <pre><code>&lt;FilesMatch \"\\.(php)$\"&gt;\n    ExpiresActive Off\n    Header set Cache-Control \"no-store, no-cache, must-revalidate\"\n&lt;/FilesMatch&gt;\n</code></pre> <p>Al final lo que hace todo esto visto en los ejemplos anteriores es insertar una cabecera http en la respuesta, algo como esto:</p> <pre><code>HTTP/1.1 200 OK\nContent-Type: image/png\nContent-Length: 10542\nExpires: Wed, 09 Nov 2025 10:49:27 GMT\nCache-Control: max-age=2592000\n</code></pre> <p>El navegador que recibe la respuesta ser\u00e1 capaz de cachearla seg\u00fan las opciones propuestas.</p> <p>[PREGUNTA] \u00bfCual es la diferencia entre Expires y Cache-Control? Busca las distintas opciones de Cache-Control y qu\u00e9 singifican.</p> <p>Importantante:</p> <p>Dentro del contenedor, esos archivos viven en <code>/var/log/apache2/</code>. Para verlos puedes hacer <code>docker exec -it apache-php bash</code> y luego <code>tail -f /var/log/apache2/app-error.log</code>. Si prefieres tenerlos en tu host, puedes montar un volumen para <code>logs/</code> y as\u00ed inspeccionarlos con tu editor. Otra opci\u00f3n avanzada es enviar logs a stdout/stderr para leerlos con <code>docker logs</code>, pero con ficheros sueles tener m\u00e1s control y lo recomiendo sobremanera. Los comandos mencionados a ejecutar dentro del contenedor son los siguientes:</p> <pre><code>docker exec -it apache-php bash\ncd /var/log/apache2\ntail -f app-access.log\n</code></pre> <p>[PREGUNTA]: Ya contesta que era lo que se guardaba en app-access.log, una vez visto esto, y realizado al menos una petici\u00f3n al servidor, metete al contenedor y comprueba qu\u00e9 es lo que se guarda mediante una captura de pantalla</p> <ul> <li>Sigamos viendo otras partes, como las cabeceras http, que ya hemos visto que pueden ser muy importantes en la interaccion del cliente con el servidor. Ya sabemos que cuando un navegador (cliente) habla con un servidor web, lo hace usando el protocolo HTTP. Cada petici\u00f3n y cada respuesta viaja en forma de texto, con varias l\u00edneas de informaci\u00f3n llamadas cabeceras (headers). </li> </ul> <p>Estas cabeceras son como metadatos: peque\u00f1os mensajes que acompa\u00f1an a la petici\u00f3n o a la respuesta para dar m\u00e1s contexto sobre qu\u00e9 se env\u00eda, c\u00f3mo debe interpretarse y c\u00f3mo debe comportarse el navegador o el servidor. En la pr\u00e1ctica anterior nos centramos much\u00edsimo en la cabecera \"Content-Type\", pero lo normal es que haya m\u00e1s cabeceras que se env\u00eden por defecto, por ejemplo, lo siguiente muestras las cabeceras http de una petici\u00f3n (REQUEST):</p> <pre><code>GET / HTTP/1.1\nHost: midominio.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: es-ES,es;q=0.9\nReferer: https://google.com\nCookie: sessionid=abc123 #Las trabajaremos mucho cuando llegue el momento. Es importante protejerlas\n</code></pre> <p>Lo siguiente muestras las cabeceras de la respuesta a la petici\u00f3n (RESPONSE)</p> <pre><code>HTTP/1.1 200 OK\nDate: Wed, 09 Oct 2025 18:30:00 GMT\nServer: Apache/2.4.54 (Debian)\nContent-Type: text/html; charset=UTF-8\nContent-Length: 4523\nX-Content-Type-Options: nosniff\nContent-Security-Policy: default-src 'self'; object-src 'none'; base-uri 'self'\n</code></pre> <p>En nuestro codigo de configuraci\u00f3n de Apache (en concreto la parte con el comentario # Seguridad con cabeceras) hemos colocado algunas lineas que mucho tienen que ver con las cabeceras.. Las l\u00edneas de nuestra configuraci\u00f3n de Apache a\u00f1aden cabeceras HTTP a las respuestas que el servidor env\u00eda al navegador. Estas, al igual que la parte del cach\u00e9 vista anteriormente, definir\u00e1n distintos casos de actuaci\u00f3n, aunque en vez de explicaroslas, quiero que busqu\u00e9is informaci\u00f3n al respecto y que pong\u00e1is ejemplos en la medida de lo posible.</p> <ul> <li> <p><code>X-Content-Type-Options \"nosniff\"</code> </p> <p>[PREGUNTA]: \u00bfPara qu\u00e9 sirve y qu\u00e9 tiene que ver con los Content-Type estudiados hasta ahora?</p> </li> <li> <p>Content-Security-Policy: default-src 'self'; object-src 'none'; base-uri 'self'</p> <p>[PREGUNTA]: Aqu\u00ed os ayudo un poco m\u00e1s ya que pienso que es m\u00e1s complejo:</p> <p>La cabecera <code>Content-Security-Policy</code> (CSP) permite al servidor indicar al navegador desde qu\u00e9 or\u00edgenes puede cargar recursos como scripts, im\u00e1genes o estilos. De esta forma, si en el HTML hay etiquetas que intentan cargar contenido externo no permitido, el navegador lo bloquear\u00e1 autom\u00e1ticamente. Haciendo uso de la explicaci\u00f3n anterior, detalla c\u00f3mo funciona esta protecci\u00f3n con algunos ejemplos adem\u00e1s, responde a lo siguiente: qu\u00e9 significa que <code>default-src 'self'</code> solo deje cargar recursos del mismo dominio, qu\u00e9 consigue <code>object-src 'none'</code> al prohibir objetos embebidos, y c\u00f3mo <code>base-uri 'self'</code> limita el uso de la etiqueta <code>&lt;base&gt;</code> en el documento. Muestra ejemplos de c\u00f3digo HTML que ser\u00edan permitidos y otros que ser\u00edan bloqueados.</p> </li> <li> <p><code>Referrer-Policy \"strict-origin-when-cross-origin\"</code></p> <p>[PREGUNTA]: \u00bfQu\u00e9 es referer en la cabecera y que hace este tipo de pol\u00edtica?</p> </li> </ul>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#4-archivo-htaccess-uso-de-reglas-rewritecond-y-rewriterule","title":"4 Archivo <code>.htaccess</code> (uso de reglas RewriteCond y RewriteRule)","text":"<p>El archivo <code>.htaccess</code> es un archivo de configuraci\u00f3n especial que Apache lee cada vez que recibe una petici\u00f3n dentro de una carpeta concreta (mirar AllowOverride explicado en el archivo de configuraci\u00f3n). Su nombre viene de hypertext access y fue creado originalmente para manejar reglas de acceso, aunque hoy en d\u00eda se usa para muchas otras cosas.  La idea es sencilla: si en tu servidor tienes definido un directorio ra\u00edz (por ejemplo <code>/var/www/html</code>), puedes colocar un <code>.htaccess</code> dentro de esa carpeta o en alguna subcarpeta. Como nuestro directorio ra\u00edz es <code>var/www/html</code> Apache, cuando sirve un archivo o procesa una URL, busca si en esa ruta de la siguiente forma :</p> <ul> <li>Imagina que la Carpeta ra\u00edz definida es, como en nuestro caso: <code>/var/www/html</code></li> <li>El cliente hace la petici\u00f3n: <code>http://localhost:8080/blog/posts/123</code></li> <li>En el servidor, la ruta real: <code>/var/www/html/blog/posts/123</code></li> </ul> <p>Si AllowOverride es \"ON\" como en nuestro caso, Apache revisa de la siguiente forma para ver:</p> <ol> <li><code>/var/www/html/blog/posts/.htaccess</code></li> <li><code>/var/www/html/blog/.htaccess</code></li> <li><code>/var/www/html/.htaccess</code></li> </ol> <p>No hace falta convercerse para darse cuenta de que ha nivel de rendimiento es una casta\u00f1a tremenda, por eso, para desarrollo, es coherente, pero no a nivel de producci\u00f3n, donde se pone <code>AllowOverride none</code>...</p> <p>Veamos ahora qu\u00e9 es lo que tenemos en este archivo <code>.htaccess</code></p> <pre><code>RewriteEngine On\n\n# Si la URL no apunta a un archivo real...\nRewriteCond %{REQUEST_FILENAME} !-f\n# ... y no apunta a un directorio real\nRewriteCond %{REQUEST_FILENAME} !-d\n# Redirigimos todo a index.php\nRewriteRule ^ index.php [L]\n</code></pre> <p>Vamos a estudiar las condiciones de este .htaccess, que como es dicho, podr\u00edan estar directamente sobre el archivo de configuraci\u00f3n de Apache y no necesariamente en el .htaccess</p>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#41-la-primera-condicion","title":"4.1 La primera condici\u00f3n","text":"<pre><code>RewriteCond %{REQUEST_FILENAME} !-f\n</code></pre> <p><code>%{REQUEST_FILENAME}</code>  es la ruta f\u00edsica del archivo que corresponde a la URL pedida.<code>! -f</code>  significa \"NO es un archivo normal existente\".</p> <p>solo se aplicar\u00e1 la regla si el archivo real no existe</p> <p>Ejemplo:</p> <ul> <li> <p>URL: <code>/style.css</code> , s\u00ed existe <code>/var/www/html/style.css</code> : la condici\u00f3n NO se cumple.</p> </li> <li> <p>URL: <code>/api/usuarios</code> , no existe <code>/var/www/html/api/usuarios</code> como archivo : la condici\u00f3n se cumple.</p> </li> </ul>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#42-la-segunda-condicion","title":"4.2 La segunda condici\u00f3n","text":"<pre><code>RewriteCond %{REQUEST_FILENAME} !-d\n</code></pre> <p>Solo se aplicar\u00e1 la regla si la ruta pedida no es un directorio real.</p> <p>Ejemplos:</p> <ul> <li>Se ejecuta la URL: <code>/uploads/</code> , s\u00ed existe <code>/var/www/html/uploads/</code> como carpeta: la condici\u00f3n NO se cumple.</li> <li>se ejecuta la URL: <code>/api/usuarios</code> , no existe <code>/var/www/html/api/usuarios</code> como carpeta : la condici\u00f3n se cumple.</li> </ul> <p>\u00bfPor qu\u00e9 se tienen que cumplir las dos? Porque si existe un archivo o un directorio real, nuestra configuraci\u00f3n decide que Apache debe servirlo directamente. Este tipo de configuraci\u00f3n suele ser com\u00fan y est\u00e1ndar y ten\u00e9is que saber c\u00f3mo funciona. En conclusi\u00f3n, no queremos que una petici\u00f3n de <code>style.css</code> acabe en <code>index.php</code> (en caso de que s\u00ed exista style.css) ni que la carpeta <code>uploads/</code> sea redirigida. Solo cuando:</p> <ul> <li>No existe dicho archivo,</li> <li>No existe dicha carpeta,    entonces aplicamos la regla final:</li> </ul> <p>Hemos visto dos ejemplos de <code>RewriteCond</code> pero, en general, las RewriteCond siguen la siguiente estructura. Estudiemos su estructura y veamos m\u00e1s ejemplos.</p>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#estudio-de-las-condiciones-rewritecond-en-general-con-mas-ejemplos","title":"Estudio de las Condiciones (<code>RewriteCond</code>) en general, con m\u00e1s ejemplos","text":"<p>Sintaxis general:</p> <pre><code>RewriteCond TESTSTRING CONDITION\n</code></pre> <ul> <li>TESTSTRING : es lo que se va a evaluar (ej: <code>%{REQUEST_FILENAME}</code>, <code>%{HTTP_HOST}</code>, <code>%{QUERY_STRING}</code>, etc.).</li> </ul> <p>[PREGUNTA] \u00bfQUE OTRAS VARIABLES DE ENTORNO SE GENERAN EN APACHE CUANDO SE RECIBE UNA PETICI\u00d3N HTTP?</p> <ul> <li>CONDITION : es la comparaci\u00f3n (ej: <code>!-f</code>, regex, strings, etc.). Al final de estos apuntes hay un anexo con regex.</li> </ul> <p>Veamos muchos ejemplo, no hace faltas que los sep\u00e1is de memoria pero s\u00ed que los entend\u00e1is.</p> <p>EJEMPLOS</p> <ul> <li> <p><code>RewriteCond %{REQUEST_FILENAME} !-f</code> : se cumple si no existe archivo.</p> </li> <li> <p><code>RewriteCond %{REQUEST_FILENAME} -d</code> :  se cumple si s\u00ed existe directorio.</p> </li> <li> <p><code>RewriteCond %{HTTP_HOST} ^www\\.midominio\\.com$</code> : se cumple si el host pedido es exactamente <code>www.midominio.com</code>.</p> </li> <li> <p><code>RewriteCond %{HTTP_HOST} !^www\\.</code>    Se cumple si el host no empieza con www.</p> </li> <li> <p><code>RewriteCond %{HTTPS} on</code>    Se cumple si la conexi\u00f3n es HTTPS.</p> </li> <li> <p><code>RewriteCond %{HTTPS} off</code>    Se cumple si la conexi\u00f3n es HTTP (no cifrada).</p> </li> <li> <p><code>RewriteCond %{QUERY_STRING} id=([0-9]+)</code>    Se cumple si la URL tiene <code>?id=algo</code> en la query string.</p> </li> <li> <p><code>RewriteCond %{QUERY_STRING} !id=</code>    Se cumple si la query string no contiene <code>id=</code>.</p> </li> </ul> <p>TODO DE QUERY_STRING ESTO OS DEBE SONAR: En la primera pr\u00e1ctica vimos que mi servidor montado con NodeJS no diferenciabala lo que hubiese en los queryparams, le daba exactamente igual que hubiera m\u00e1s o menos campos.</p> <ul> <li> <p><code>RewriteCond %{REMOTE_ADDR} ^192\\.168\\.1\\.100$</code>    Se cumple si el cliente viene de la IP <code>192.168.1.100</code>.</p> </li> <li> <p><code>RewriteCond %{REMOTE_ADDR} !^192\\.168\\.</code>    Se cumple si el cliente no est\u00e1 en la subred 192.168..`.</p> </li> </ul> <p>Ojo, Puedes poner varias <code>RewriteCond</code>: todas deben cumplirse para que se ejecute la regla que viene despu\u00e9s. Por \u00faltimo, nos queda desrbir la \u00faltima linea del htaccess.</p>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#43-tercera-condicion","title":"4.3 Tercera condici\u00f3n","text":"<pre><code>RewriteRule ^ index.php [L]\n</code></pre> <ul> <li> <p><code>^</code> en el patr\u00f3n: Como ya sab\u00e9is, en expresiones regulares, <code>^</code> significa \u201cinicio de la cadena\u201d. Aqu\u00ed el patr\u00f3n es <code>^</code>, lo que equivale a decir \u201ccualquier cosa que empiece en el principio\u201d, o sea, todas las URLs. Normalmente se combina con las condiciones de<code>RewriteCond</code> ya explicadas para filtrar casos, como ya haces con <code>!-f</code> y <code>!-d</code>.</p> </li> <li> <p><code>index.php</code> en el destino Significa: \u201creescribe la URL para que Apache sirva <code>index.php</code>\u201d. Esto no cambia lo que el usuario ve en el navegador, simplemente Apache decide que la petici\u00f3n <code>/productos/42</code> en realidad la atienda el archivo <code>index.php</code> y no por un archivo o carpeta que estuviera en <code>var/www/html</code>.</p> </li> <li> <p><code>[L]</code> (flag \u201cLast\u201d) Indica que esta debe ser la \u00faltima regla evaluada si se cumple. Una vez que Apache aplica esta regla, deja de mirar otras reglas de reescritura en ese contexto. Es como un <code>break</code> en un bucle de programaci\u00f3n.</p> </li> </ul> <p>Al igual que con las <code>RewriteCond</code> vemos la sint\u00e1xsis general de las <code>RewriteRule</code></p>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#estudio-de-las-rewriterule-en-general","title":"Estudio de las <code>RewriteRule</code> en general","text":"<pre><code>RewriteRule patr\u00f3n destino [flags]\n</code></pre> <ul> <li>patr\u00f3n : es una expresi\u00f3n regular (ver Anexo) que Apache aplica sobre la URL solicitada (normalmente sobre el <code>REQUEST_URI</code> sin el dominio inicial).</li> </ul> <p>[PREGUNTA] \u00bfQue es request_URI?</p> <ul> <li> <p>destino : ad\u00f3nde se debe redirigir o reescribir la petici\u00f3n. Puede ser un archivo local (ej: <code>index.php</code>) o incluso una URL completa (<code>https://otro.com/</code>).</p> </li> <li> <p>[flags] : opciones que modifican el comportamiento (como <code>L</code>, <code>R</code>, etc.).</p> </li> </ul> <p>[PREGUNTA]: Busca informaci\u00f3n sobre otro flag que se pudiera a\u00f1adir e indica qu\u00e9 significar\u00eda.</p>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#5-algunos-scripts-en-apache-y-su-ejecucion","title":"5. Algunos Scripts en apache y su ejecuci\u00f3n","text":"<p>Veamos algunos scripts, que podemos colocar el la carpeta www para que se puedan ejecutar</p>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#51-indexphp-con-conexion-a-mysql-y-dos-endpoints-simples","title":"5.1 index.php con conexi\u00f3n a MySQL y dos endpoints simples","text":"<p>Ahora un ejemplo un poco m\u00e1s \u00fatil, que prueba la conexi\u00f3n a la base de datos con las credenciales que definiste en las variables de entorno de <code>docker-compose.yml</code> (No tienen porqu\u00e9 ser las mismas que yo puse).</p> <p>[PREGUNTA] Esta pregunta es s\u00f3lo para ver si est\u00e1is siguiendo la lectura ya que lo que pregunto a continuaci\u00f3n ya ha sido explicado</p> <ul> <li>\u00bfEn qu\u00e9 casos php y bajo qu\u00e9 peticiones del cliente ejecutar\u00e1 index.php APACHE?</li> </ul> <pre><code>&lt;?php\nheader(\"Content-Type: application/json\");\n\n// Par\u00e1metros de conexi\u00f3n (los mismos que en docker-compose.yml)\n$host = \"db\";           // nombre del servicio de MySQL en docker-compose\n$user = \"testuser\";\n$pass = \"testpass\";\n$dbname = \"testdb\";\n\n// Conectar a MySQL\n$conn = new mysqli($host, $user, $pass, $dbname);\n\n// Verificar conexi\u00f3n\nif ($conn-&gt;connect_error) {\n    http_response_code(500);\n    echo json_encode([\"error\" =&gt; \"Error de conexi\u00f3n a la BD: \" . $conn-&gt;connect_error]);\n    exit();\n}\n\n// Obtener la ruta solicitada\n$uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);\n\n// ENDPOINT: /api/usuarios\nif ($uri === '/api/usuarios') {\n    $sql = \"CREATE TABLE IF NOT EXISTS usuarios (\n        id INT AUTO_INCREMENT PRIMARY KEY,\n        nombre VARCHAR(50) NOT NULL\n    )\";\n    $conn-&gt;query($sql);\n\n    // Insertar un usuario de prueba si la tabla est\u00e1 vac\u00eda\n    $conn-&gt;query(\"INSERT INTO usuarios (nombre)\n                  SELECT 'Ana'\n                  WHERE NOT EXISTS (SELECT 1 FROM usuarios)\");\n\n    $result = $conn-&gt;query(\"SELECT * FROM usuarios\");\n\n// Recorremos todos los resultados de la consulta SQL ($result)\n// fetch_assoc() devuelve cada fila como un array asociativo\n//   - Las claves son los nombres de las columnas de la tabla (ej: \"id\", \"nombre\")\n//   - Los valores son los datos de esa fila\n    $usuarios = [];\n    while ($row = $result-&gt;fetch_assoc()) {\n        $usuarios[] = $row;\n    }\n// Al final, $usuarios ser\u00e1 un array de arrays asociativos\n    echo json_encode($usuarios);\n}\n// ENDPOINT: /api/ping (solo prueba de vida)\nelseif ($uri === '/api/ping') {\n    echo json_encode([\"msg\" =&gt; \"pong\"]);\n}\nelse {\n    http_response_code(404);\n    echo json_encode([\"error\" =&gt; \"Endpoint no encontrado\"]);\n}\n\n$conn-&gt;close();\n</code></pre> <p>Adem\u00e1s, este archivo tiene dos endpoints definidos. Debes de contestar a las siguientes dos preguntas:</p> <p>[PREGUNTA]:</p> <ul> <li>\u00bfCu\u00e1les son esos dos endpoints?</li> <li>\u00bfCu\u00e1l es el flujo que hace Apache desde la petici\u00f3n del cliente hasta que devuelve la respuesta del endpoint? (Mirar .htaccess)</li> <li>\u00bfTienen verbos http definidos estos endpoints? \u00bfResponder\u00edan ante cualquier tipo de verbo http?</li> <li>\u00bfQu\u00e9 tipo de \"Content-Type\" env\u00edan ambos al cliente?</li> <li>\u00bfSi tuvieras que darle un verbo http, que verbo le dar\u00edas a cada endpoint anterior? Justifica tu respuesta</li> </ul>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#52-productosphp","title":"5.2 productos.php","text":"<pre><code>&lt;?php\nheader(\"Content-Type: application/json\");\n\n// Asegurar que sea POST\nif ($_SERVER['REQUEST_METHOD'] !== 'POST') {\n    http_response_code(405); // Method Not Allowed\n    echo json_encode([\"error\" =&gt; \"Solo se admite POST\"]);\n    exit();\n}\n\n// Asegurar que Content-Type sea application/json\nif (stripos($_SERVER[\"CONTENT_TYPE\"], \"application/json\") === false) {\n    http_response_code(400); // Bad Request\n    echo json_encode([\"error\" =&gt; \"Content-Type debe ser application/json\"]);\n    exit();\n}\n\n// Leer el cuerpo de la petici\u00f3n\n$input = file_get_contents(\"php://input\");\n$data = json_decode($input, true);\n\n// Validar JSON\nif (json_last_error() !== JSON_ERROR_NONE) {\n    http_response_code(400);\n    echo json_encode([\"error\" =&gt; \"JSON inv\u00e1lido\"]);\n    exit();\n}\n\n// Verificar que tenga el campo \"nombre\"\nif (empty($data['nombre'])) {\n    http_response_code(400);\n    echo json_encode([\"error\" =&gt; \"Falta el campo 'nombre'\"]);\n    exit();\n}\n\n// Conectar a la BD\n$host = \"db\";\n$user = \"testuser\";\n$pass = \"testpass\";\n$dbname = \"testdb\";\n\n$conn = new mysqli($host, $user, $pass, $dbname);\nif ($conn-&gt;connect_error) {\n    http_response_code(500);\n    echo json_encode([\"error\" =&gt; \"Error de conexi\u00f3n: \" . $conn-&gt;connect_error]);\n    exit();\n}\n\n// Crear tabla si no existe\n$conn-&gt;query(\"CREATE TABLE IF NOT EXISTS productos (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    nombre VARCHAR(100) NOT NULL\n)\");\n\n// Insertar el nuevo producto\n$nombre = $conn-&gt;real_escape_string($data['nombre']);\nif ($conn-&gt;query(\"INSERT INTO productos (nombre) VALUES ('$nombre')\")) {\n    http_response_code(201); // Created\n    echo json_encode([\n        \"success\" =&gt; true,\n        \"id\" =&gt; $conn-&gt;insert_id,\n        \"nombre\" =&gt; $data['nombre']\n    ]);\n} else {\n    http_response_code(500);\n    echo json_encode([\"error\" =&gt; \"Error al insertar producto\"]);\n}\n\n$conn-&gt;close();\n</code></pre> <p>[PREGUNTA]: Tal y como esta configurado apache, el archivo php anterior representa un endpoint por si mismo.</p> <ul> <li> <p>\u00bfC\u00f3mo se hace la petici\u00f3n a ese archivo? \u00bfQu\u00e9 tipo de verbo http ser\u00eda? </p> </li> <li> <p>\u00bfQu\u00e9 tipo de formato de datos accepta la petici\u00f3n? \u00bfQu\u00e9 tipo de formato devuelve?</p> </li> <li> <p>Prueba a a hacer una petici\u00f3n con POSTMAN y otra con CURL y adjunta capturas de la respuesta.</p> </li> </ul> <p>[PREGUNTA] En esta pr\u00e1ctica hab\u00e9is configurado manualmente vuestro servidor Apache con <code>000-default.conf</code> y un <code>.htaccess</code> para redirigir (algunas) lURLs a <code>index.php</code>. Todo el control de rutas, autenticaci\u00f3n y cach\u00e9 lo hab\u00e9is hecho directamente en el servidor web.</p> <ul> <li> <p>\u00bfQu\u00e9 cambia cuando usamos un framework como Laravel?</p> </li> <li> <p>\u00bfD\u00f3nde se definen las rutas en ese caso: en el servidor Apache o dentro del framework?</p> </li> <li> <p>\u00bfQu\u00e9 ventajas y desventajas tiene cada enfoque (controlarlo en Apache vs. dejarlo al framework)?</p> </li> <li> <p>\u00bfPor qu\u00e9 cre\u00e9is que en proyectos grandes se recomienda que Apache solo apunte a <code>public/</code> y que el framework gestione las rutas y la l\u00f3gica?</p> </li> </ul> <p>[PREGUNTA] A lo largo de la pr\u00e1ctica has visto que se ha utilizado la extensi\u00f3n mysqli para hacer querys.</p> <ul> <li>\u00bfQu\u00e9 desventaja tiene esto en un servidor Web real?</li> <li>\u00bfQu\u00e9 es un ORM y que relaci\u00f3n tiene con lo anterior?</li> <li>\u00bfQu\u00e9 ventajas ofrecen los ORM que nos proporcionan algunos frameworks como Larabel?</li> </ul>"},{"location":"2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/#6-anexo-cosas-basis-de-regexp-con-algunos-ejemplos","title":"6. Anexo (Cosas b\u00e1sis de regexp con algunos ejemplos)","text":"<ul> <li>Caracteres literales : Un string  tal cual. Ej: <code>hola</code> encuentra \u201chola\u201d.</li> <li>Metacaracteres:</li> <li><code>.</code> : cualquier car\u00e1cter.</li> <li><code>^</code> : inicio de la cadena.</li> <li><code>$</code> : fin de la cadena.</li> <li><code>*</code> : cero o m\u00e1s repeticiones.</li> <li><code>+</code> : una o m\u00e1s repeticiones.</li> <li><code>?</code> : opcional (cero o una).</li> <li><code>[]</code> : conjunto de caracteres. Ej: <code>[0-9]</code> = cualquier d\u00edgito.</li> <li><code>|</code> : alternancia (OR). Ej: <code>perro|gato</code>.</li> <li><code>()</code> : agrupar.</li> <li><code>{n}</code> : exactamente n veces.</li> <li><code>{n,}</code> : al menos n veces (sin l\u00edmite superior).</li> <li> <p><code>{n,m}</code> : entre n y m veces.</p> </li> <li> <p>Ejemplos t\u00edpicos (si entiendes estos ejemplos, vas bien con las regexp, si no, rep\u00e1satelas por favor)</p> </li> <li> <p><code>^[0-9]+$</code> : solo n\u00fameros enteros.</p> </li> <li> <p><code>^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$</code> : email b\u00e1sico.</p> </li> <li> <p><code>\\.(jpg|jpeg|png)$</code> : archivos que terminan en <code>.jpg</code>, <code>.jpeg</code> o <code>.png</code>.</p> </li> <li> <p><code>^https?://</code>: URLs que empiezan por <code>http://</code> o <code>https://</code>. (piensa que hace)</p> </li> <li> <p><code>^[0-9]+([.,][0-9]+)?$</code>: (piensa que hace)</p> </li> <li> <p><code>^(0[1-9]|[12][0-9]|3[01])/(0[1-9]|1[0-2])/[0-9]{4}$</code>: (piensa que hace)</p> </li> </ul>"},{"location":"3%20primera_practica_PHP/","title":"Programaci\u00f3n en PHP Usando Apache (Primera pr\u00e1ctica)","text":"<p>Este documento est\u00e1 pensado para que avanc\u00e9is con calma, son cosas muy sencillas y explciadas muy paso a paso. Cada bloque introduce una idea, muestra un ejemplo breve y termina con pr\u00e1ctica guiada. No hay prerequisitos.</p> <p>Aunque cre\u00e1is que no, soy razonable :) y entiendo que docker os puede dar problemas, la pr\u00e1ctica, est\u00e1 pensada para hacerla en tiempo de clase y si docker os da problema, llamadme sin miedo, por favor. En principio, los siguientes comandos de docker os deben solventar cualquier tipo de situaci\u00f3n, los dejo por aqu\u00ed y los explico.</p>"},{"location":"3%20primera_practica_PHP/#preambulo-1-como-ejecutar-el-codigo-php-con-docker","title":"Pre\u00e1mbulo 1. C\u00f3mo ejecutar el c\u00f3digo php con docker","text":"<p>OPCI\u00d3N 1 (DOCKER) Cada vez que abr\u00e1is vuestro proyecto, os recomiendo ejecutar:</p> <pre><code>sudo docker compose down\nsudo docker compose up --build\n</code></pre> <p>De esta forma, evitar\u00e9is problemas.</p> <p>Si hab\u00e9is elegido docker, vamos ahora con los errores m\u00e1s comunes que os pod\u00e9is encontrar. Uno de los errores m\u00e1s comunes es el siguiente</p> <pre><code>Error response from daemon: Conflict. The container name \"/&lt;nombre_del_contenedor&gt;\" is already in use by container \"&lt;id_del_contenedor&gt;\". You have to remove (or rename) that container to be able to reuse that name.\n</code></pre> <p>Cuando ejecut\u00e1is el docker compose up, se creen tantos contenedores como servicios ten\u00e9is definidos sobre dicho archivo. En nuestro caso, se crean tres contenedores, uno de mysql, otro de apache y otro de phpmyadmin. Si alguna vez os sale ese error, ten\u00e9is dos opciones:</p> <p>1- Matar ese contenedor: primero lo paras (por nombre o por id) y despu\u00e9s lo matas:</p> <pre><code>sudo docker stop container_name|container_id #lo paro\nsudo docker rm container_name|container_id #lo paro\n</code></pre> <p>2- Si est\u00e1s en el mismo proyecto desde el cual creaste los contenedores que quieres matar, bastar\u00eda con:</p> <pre><code>sudo docker compose down -v\n</code></pre> <p>Esto cierra todos los contenedores creados en el docker-compose, ojo, debes tener definido un docker compose, si no, no ir\u00e1</p> <p>3- Por \u00faltimo, para ver todos los contenedores que est\u00e1 corriendo en tu sistema, podr\u00edas hacer:</p> <pre><code>sudo docker ps\n</code></pre> <p>Esto s\u00f3lo lo comento porque puede ser \u00fatil, no porque os vaya a solucionar nada.</p>"},{"location":"3%20primera_practica_PHP/#resumen-ejecutar-el-codigo-php-con-docker","title":"Resumen ejecutar el c\u00f3digo php con docker","text":"<ol> <li>Inicia tu servidor local de Docker (Apache seg\u00fan pr\u00e1ctica 2).</li> <li>Coloca tu scripts en una carpeta publica que pueda ser consumible (www) de la pr\u00e1ctica anterior.</li> <li>Es decir, no toques nada de lo que ya hay. cada vez, que hagas un cambio, NO HACE FALTA ejecutar: <code>docker compose up --build</code>  solamente guarda los cambios en el script y despu\u00e9s accede a `http://localhost:8080/archivo.php\" o al script que quieras ejecutar-</li> </ol>"},{"location":"3%20primera_practica_PHP/#preambulo-2como-ejecutar-el-codigo-php-instalando-apache","title":"Pre\u00e1mbulo 2.C\u00f3mo ejecutar el c\u00f3digo php instalando apache","text":"<p>Si no quer\u00e9is usar docker, pod\u00e9is instalar apache en ubuntu 24.04, para ello, ejecutad lo siguiente:</p> <pre><code>sudo apt update\nsudo apt install -y apache2 php8.3 php8.3-mysql #instalamos 3 paquetes, apache y lo necesario para correr php junto con mysql (por ahora no usaremos mysql)\nsudo a2enmod rewrite headers expires #Activamos los m\u00f3dulos de apache, al igual que con docker, para que puedan usarse en nuestro archivo de configuraci\u00f3n.\nsudo systemctl restart apache2 #reiniciamos el servicio\n</code></pre> <p>Una vez hecho esto ejecutad los siguientes comando des copiado (Ojo con las ruta relativas y absolutas): En vuestro proyecto, ten\u00e9is el archivo apache/000-default.conf, de configuraci\u00f3n de apache, pegadlo en:</p> <pre><code>sudo cp \"/home/manolo/Escritorio/PHP inicio/apache/000-default.conf\" /etc/apache2/sites-available/000-default.conf\n</code></pre> <p>Recordad tambi\u00e9n pegar el .htacces en la carpeta '/var/www/html'.</p> <p>Una vez hab\u00e9is copiado la config, dad permisos de lectura escritura y ejecuci\u00f3n a '/var/www/html' y abrid dicha carpeta en vscode. Con esto ya pod\u00e9is desarrollar los scripts de esta pr\u00e1ctica</p>"},{"location":"3%20primera_practica_PHP/#resumen-ejecutar-el-codigo-php-con-apache-en-ubuntu","title":"Resumen ejecutar el c\u00f3digo php con apache en ubuntu","text":"<ol> <li>Inicia tu servidor local de Apache (systemctl start apache2).</li> <li>Visita el script que quieras ejecutar:`http://localhost:8080/archivo.php\" </li> </ol>"},{"location":"3%20primera_practica_PHP/#opcional","title":"Opcional","text":"<p>Si no quer\u00e9is trabajar directamente sobre dicha carpeta, pod\u00e9is realizar enlaces simb\u00f3licos. Los siguientes comandos cumplen el cometido que se quiere.</p> <ul> <li>Pegad vuestra carpeta www dentro de /var/www/html, para ello:</li> </ul> <pre><code>sudo cp -r \"/home/manolo/Escritorio/PHP inicio/www\"/. /var/www/html/\n</code></pre> <ul> <li>Ya ten\u00e9is apache corriendo en el puerto 80!. si acced\u00e9is a http://localhost ejecutar\u00e9is directamente el index.php. Por comodidad, os recomiendo hacer enlaces simb\u00f3licos para desarrollar mas r\u00e1pdido desde vscode:</li> </ul> <pre><code>sudo rm -rf /var/www/html #recursive y force\nsudo ln -sf \"/home/manolo/Escritorio/PHP inicio/www\" /var/www/html #simbolic y force, la opci\u00f3n -f (force) borra el destino si ya existe (sea un archivo o un enlace, esdecir, sea lo que sea),y lo reemplaza por el nuevo enlace simb\u00f3lico.\nsudo ln -sf \"/home/manolo/Escritorio/PHP inicio/apache/000-default.conf\" /etc/apache2/sites-available/000-default.conf\n</code></pre> <p>Error com\u00fan. Si ten\u00e9is enlaces simb\u00f3lico pod\u00e9is tener problemas con los permisos, recomiendo cambiarlos de la siguiente forma</p> <pre><code>sudo chown -R $USER:www-data \"/home/manolo/Escritorio/PHP inicio/www\"\nsudo chmod -R 775 \"/home/manolo/Escritorio/PHP inicio/www\"\n\nsudo systemctl reload apache2 \n</code></pre>"},{"location":"3%20primera_practica_PHP/#preambulo-3como-ejecutar-el-codigo-php-desde-interprete","title":"Pre\u00e1mbulo 3.C\u00f3mo ejecutar el c\u00f3digo php desde int\u00e9rprete","text":"<p>Esto s\u00f3lo os servir\u00e1 en algunos puntos de la pr\u00e1ctica y no lo recomiendo, pero es conveniente que lo sep\u00e1is.</p> <pre><code>sudo apt update\nsudo apt install php\n</code></pre> <p>y posteriormente, ejecuta tu script:</p> <pre><code>php script.php\n</code></pre> <p>As\u00ed pruebas la ejecuci\u00f3n.</p>"},{"location":"3%20primera_practica_PHP/#1-hola-mundo","title":"1. \u201cHola, mundo\u201d","text":"<p><pre><code>&lt;?php\necho \"Hola, mundo desde PHP\";\n</code></pre> Guarda esto en el archivo como <code>hola_mundo.php</code> seg\u00fan lo comentado antes</p>"},{"location":"3%20primera_practica_PHP/#practica-haz-captura-de-lo-siguiente-y-visitalo-para-ver-que-funciona-archivo-hola_mundophp","title":"Pr\u00e1ctica (haz captura de lo siguiente y vis\u00edtalo para ver que funciona) Archivo: hola_mundo.php","text":"<ol> <li> <p>Cambia el mensaje por tu nombre.</p> </li> <li> <p>Agrega una segunda l\u00ednea adicional con <code>echo</code> que muestre la fecha actual con el comando de abajo y a\u00f1ade \"\\n\" al final de \"Hola, mundo desde PHP\", de la siguiente forma (\u00bfPasa algo si no pones el punto y coma?)</p> </li> </ol> <pre><code>echo date(\"Y-m-d\");\n</code></pre> <p>Nota: <code>date</code> es una estructura ya integrada en php que veremos m\u00e1s tarde, en este caso devuelve la fecha actual seg\u00fan el formato especificado. Recarga en el navegador y verifica los cambios o ejecuta con el interprete de php.</p> <ol> <li>Haz lo mismo pero al final de \"Hola, mundo desde PHP\", a\u00f1ade <code>&lt;br&gt;</code>, qu\u00e9 pasa?</li> </ol>"},{"location":"3%20primera_practica_PHP/#2-php-html-en-el-mismo-archivo","title":"2. PHP + HTML en el mismo archivo","text":"<p>Puedes mezclar HTML con PHP para generar p\u00e1ginas din\u00e1micas.</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"utf-8\"&gt;\n  &lt;title&gt;Mi primera p\u00e1gina PHP&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;h1&gt;Bienvenido&lt;/h1&gt;\n  &lt;p&gt;\n    &lt;?php\n    echo \"Hoy es \" . date(\"d/m/Y\"); #El punto sirve para concatenar cadenas\n    ?&gt;\n  &lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"3%20primera_practica_PHP/#practica-archivo-first_htmlphp","title":"Pr\u00e1ctica. Archivo: first_html.php","text":"<p>Cambia el <code>&lt;h1&gt;</code> por tu nombre. A\u00f1ade un p\u00e1rrafo donde pone php que diga: \u201cEsta p\u00e1gina fue generada por PHP\u201d. Fijate como se inserta el c\u00f3digo php dentro del html</p>"},{"location":"3%20primera_practica_PHP/#3-comentarios","title":"3. Comentarios","text":"<pre><code>&lt;?php\n// Comentario de una l\u00ednea\n# Otra forma de comentar\n/*\n Comentario de varias l\u00edneas\n*/\necho \"lo anteror eran comentarios de tres tipos distnitos\"; // fin de l\u00ednea\n</code></pre>"},{"location":"3%20primera_practica_PHP/#practica-firstcommentphp","title":"Pr\u00e1ctica. firstcomment.php","text":"<p>Crea <code>sintaxis.php</code> y escribe tres l\u00edneas <code>echo</code> con distintos comentarios.</p>"},{"location":"3%20primera_practica_PHP/#4-variables-y-tipos-basicos","title":"4. Variables y tipos b\u00e1sicos","text":"<p>Las variables empiezan con <code>$</code>. PHP infiere el tipo seg\u00fan el valor.</p> <p><pre><code>&lt;?php\n$nombre = \"Luc\u00eda\";   // string\n$edad   = 21;        // integer\n$altura = 1.65;      // float\n$activo = true;      // boolean\n$colores = [\"rojo\", \"verde\", \"azul\"];\n$variable = null;\n\necho gettype($nombre);\necho \"&lt;br&gt;\";\necho gettype($edad);  \necho \"&lt;br&gt;\";\necho gettype($altura); \necho \"&lt;br&gt;\";\necho gettype($activo); \necho \"&lt;br&gt;\";\necho gettype($colores); \necho \"&lt;br&gt;\";\necho gettype($variable);\n\necho \"Me llamo $nombre y tengo $edad a\u00f1os.\"; //interpolaci\u00f3n de variables en PHP,\n</code></pre> Nota: las variables distinguen may\u00fasculas y min\u00fasculas (<code>$edad</code> \u2260 <code>$Edad</code>).</p>"},{"location":"3%20primera_practica_PHP/#practica-variablesphp","title":"Pr\u00e1ctica. variables.php","text":"<p>Crea <code>variables.php</code> y declara: <code>$nombre</code>, <code>$ciudad</code>, <code>$anioNacimiento</code>. Muestra una frase completa usando las tres variables, en vez de concatenar como en el ejemplo anterior, vas a hacer concatenaci\u00f3n con <code>.</code> Ejemplo:</p> <pre><code>echo \"Soy \" . $profesion . \" desde \" . $anio . \".\";\n</code></pre> <p>En PHP, el operador <code>.</code> une (concatena) dos o m\u00e1s textos o variables en una sola cadena. En python, por ejemplo, es el \"+\"</p>"},{"location":"3%20primera_practica_PHP/#5-entrada-y-salida-sencillas","title":"5. Entrada y salida sencillas","text":"<p>En p\u00e1ginas web, la \u201centrada\u201d suele venir de formularios ejecutados en el cliente. Por ahora, haremos una entrada m\u00ednima con query string (<code>GET</code>). Aqu\u00ed usamos el operador: <code>??</code> que solo comprueba si existe y no es null.</p> <p><pre><code>&lt;?php\n$nombre = $_GET[\"nombre\"] ?? \"invitado\";\necho \"Hola, \" . htmlspecialchars($nombre);\n</code></pre> Visita: <code>http://localhost/mi-primer-proyecto/saludo.php?nombre=Ana</code></p> <p><code>htmlspecialchars</code> evita que se ejecute HTML que el usuario pueda enviar. Es una estructura de control que conviene implementar para prevenoir ataques.</p>"},{"location":"3%20primera_practica_PHP/#practica-saludophp","title":"Pr\u00e1ctica (saludo.php)","text":"<p>Agrega un segundo par\u00e1metro <code>?ciudad=Madrid</code> y mu\u00e9stralo. Si <code>ciudad</code> no est\u00e1, muestra \u201c(ciudad no especificada)\u201d. </p> <p>Adem\u00e1s prueba a mandar por el query-param <code>&lt;h1&gt;PACO&lt;/h1&gt;</code>, \u00bfse ejecuta el html?</p>"},{"location":"3%20primera_practica_PHP/#6-operadores-basicos","title":"6. Operadores b\u00e1sicos","text":"<p>Operadores aritm\u00e9ticos, comparaci\u00f3n estricta y l\u00f3gicos.</p> <p><pre><code>&lt;?php\n$a = 10;\n$b = 3;\n\necho $a + $b . \"&lt;br&gt;\";\necho $a - $b . \"&lt;br&gt;\";\necho $a * $b . \"&lt;br&gt;\";\necho $a / $b . \"&lt;br&gt;\";\necho $a % $b . \"&lt;br&gt;\";\n\n//-------una comparaci\u00f3n estricta\n$unoComoTexto = \"1\";\nvar_dump(1 === $unoComoTexto); // avanzo false\necho \"&lt;br&gt;\";\nvar_dump(1 == $unoComoTexto); //((\u00bfque ser\u00e1))\n\n//------ operadores l\u00f3gicos\n$edad = 20;\n$permisoPadres = false;\necho \"&lt;br&gt;\";\nvar_dump($edad &gt;= 18 || $permisoPadres); //Operador OR en AND es &amp;&amp;\n</code></pre> <code>var_dump</code> se usa para inspeccionar valores y tipos.  Sirve para mostrar el tipo de dato y su valor exacto. No hace falta que lo pongas echo delante.</p>"},{"location":"3%20primera_practica_PHP/#practica-operadoresphp","title":"Pr\u00e1ctica. (operadores.php)","text":"<p>Crea <code>operadores.php</code>: pide <code>a</code> y <code>b</code> por <code>GET</code> param, para ello, cuando los recibas los params, ser\u00e1n string, para ello, p\u00e1salos a float:</p> <pre><code>$a = (float)$a;\n$b = (float)$b;\n</code></pre> <p>y muestra todas las operaciones al igual que en el ejemplo. </p> <p>A\u00f1ade una l\u00ednea que diga si <code>a</code> es mayor o divisible entre <code>b</code> usando var_dump por delante.</p> <p>A\u00f1ade otra que diga si <code>a</code> es menor que <code>b</code> o es divisible entre <code>b</code> tambi\u00e9n usando var_dump por delante de la comparativa.</p>"},{"location":"3%20primera_practica_PHP/#7-condicionales","title":"7. Condicionales","text":"<p><pre><code>&lt;?php\n\n\n$nota = $_GET[\"nota\"];\n\n//-----Ejemplo de negaci\u00f3n !, la funci\u00f3n is_numeric es importante\nif (!is_numeric($nota)) {\n    echo \"&lt;p&gt;Error: el valor proporcionado no es un n\u00famero v\u00e1lido.&lt;/p&gt;\";\n    echo \"&lt;p&gt;Ejemplo correcto:nota=7&lt;/p&gt;\";\n    exit;\n}\n\nelse {\n    $nota = (int) ($_GET[\"nota\"] ?? 0); //LO paso a INT antes\n}\n//-----Aqu\u00ed vemos por primera vez un &amp;&amp;\nif ($nota &gt;= 9 &amp;&amp; $nota &lt;= 10) {\n  echo \"Sobresaliente\";\n} elseif ($nota &gt;= 5 &amp;&amp; $nota &lt;= 10) {\n  echo \"Aprobado\";\n} else {\n  echo \"Insuficiente\";\n}\n</code></pre> Prueba con: <code>?nota=4</code>, <code>?nota=7</code>, <code>?nota=10</code> (querystrings)</p> <p>Arregla el c\u00f3digo para que cuando sea &gt;10 no ponga insuficiente.</p>"},{"location":"3%20primera_practica_PHP/#practica-condicionalesphp","title":"Pr\u00e1ctica. (Condicionales.php)","text":"<p>Crea <code>Condicionales.php</code> que reciba <code>n</code> por querystring y diga si es positivo, negativo o cero. A\u00f1ade un mensaje extra si <code>n</code> es par o impar y otro mensaje que diga si es mayor que 5 y menor que 10. Para ello, usa el resto del punto anterior.</p>"},{"location":"3%20primera_practica_PHP/#8-bucles-while-for-foreach","title":"8. Bucles (while, for, foreach)","text":"<pre><code>&lt;?php\n//---------while\n$i = 1;\nwhile ($i &lt;= 3) {\n  echo \"while: $i&lt;br&gt;\";\n  $i++;\n}\n\n//----------for\nfor ($j = 1; $j &lt;= 3; $j++) {\n  echo \"for: $j&lt;br&gt;\";\n}\n\n//----------- foreach\n$frutas = [\"manzana\", \"pera\", \"uva\"];\nforeach ($frutas as $fruta) {\n  echo \"fruta: $fruta&lt;br&gt;\";\n}\n\n//------------Array asociativo\n$persona = [\n    \"nombre\" =&gt; \"Luc\u00eda\",\n    \"edad\" =&gt; 21,\n    \"ciudad\" =&gt; \"Madrid\"\n];\n\necho $persona[\"nombre\"]; // Luc\u00eda\n\nforeach ($persona as $clave =&gt; $valor) {\n    echo \"$clave: $valor&lt;br&gt;\";\n}\n</code></pre>"},{"location":"3%20primera_practica_PHP/#practica-bluchesphp","title":"Pr\u00e1ctica (bluches.php)","text":"<ul> <li>Crea que muestre la tabla de multiplicar de <code>n</code> (por <code>GET</code>).</li> <li>Crea que recorra un array de 5 libros y los imprima usando etiquetas <code>&lt;li&gt;</code> de html.</li> <li>Busca o prueba si los arrays pueden tener mas de un tipo distintos dentro</li> </ul>"},{"location":"3%20primera_practica_PHP/#9-metodos-de-arrays-y-arrays-asociativos","title":"9. M\u00e9todos de arrays y arrays asociativos","text":"<pre><code>//------------Crear y acceder\n&lt;?php\n$frutas = [\"manzana\", \"pera\", \"uva\"];\necho $frutas[0]; // manzana\n\n$persona = [\n  \"nombre\" =&gt; \"Luc\u00eda\",\n  \"edad\" =&gt; 21,\n  \"ciudad\" =&gt; \"Madrid\"\n];\necho $persona[\"edad\"]; // 21\n\n\n//--------A\u00f1adir\n$frutas[] = \"naranja\"; // a\u00f1ade al final naranja\n$persona[\"profesion\"] = \"Estudiante\"; // a\u00f1ade nueva clave\n\n//-----------eliminar\nunset($frutas[1]);      // elimina el segundo elemento, los indices empiezan por 0\n$ultima = array_pop($frutas); //printea lo que devuelve\nunset($persona[\"edad\"]); // elimina una clave del array asociativo\n\n//--------contar\necho count($frutas);  // n\u00famero total de elementos\necho count($persona);  // n\u00famero total de elementos\n\n//---------array de keys y valores\n$claves = array_keys($persona);\n$valores = array_values($persona);\n//------------Ojo usamos print_r para estructuras mas complejas no echo\nprint_r($claves);  // [\"nombre\", \"ciudad\", \"profesion\"]\nprint_r($valores); // [\"Luc\u00eda\", \"Madrid\", \"Estudiante\"]\n</code></pre>"},{"location":"3%20primera_practica_PHP/#practica-metodosphp","title":"Pr\u00e1ctica (metodos.php)","text":"<ol> <li> <p>Crea un array <code>$colores = [\"rojo\", \"verde\", \"azul\"];</code></p> </li> <li> <p>A\u00f1ade <code>\"amarillo\"</code> al final</p> </li> <li> <p>Elimina <code>\"verde\"</code> usando <code>unset()</code>.</p> </li> <li> <p>Elimina azul con un pop y guardalo en la variable color</p> </li> <li> <p>A\u00f1ade al final `rojo``</p> </li> <li> <p>Recorre el array con <code>foreach</code> e imprime cada color en una lista HTML de <code>li</code></p> </li> </ol> <ol> <li>Crea un array <code>$coche</code> con las claves: <code>\"marca\"</code>, <code>\"modelo\"</code>, <code>\"a\u00f1o\"</code>, <code>\"color\"</code>.</li> </ol> <p>y a\u00f1ade lkos valores que quieras</p> <ol> <li> <p>A\u00f1ade una nueva clave <code>\"precio\"</code>.</p> </li> <li> <p>Muestra las claves con <code>array_keys()</code> y los valores con <code>array_values()</code>.</p> </li> <li> <p>Recorre el array original con <code>foreach</code> mostrando <code>\"clave: valor\"</code>.</p> </li> </ol>"},{"location":"3%20primera_practica_PHP/#10-funciones","title":"10. Funciones","text":"<pre><code>&lt;?php\n//-----------------funci\u00f3n tipada\nfunction saludar(string $nombre): string {\n  return \"Hola, $nombre\";\n}\n\nfunction multiplicar_2($n) {\n    return 2 * $n;\n}\n\necho saludar(\"Marcos\") . \"&lt;br&gt;\";\n\n//--------------Funciones flecha\n// Versi\u00f3n corta (arrow function)\n$doble = fn($n) =&gt; $n * 2; // asignada correctamente\n\necho $doble(3) . \"&lt;br&gt;\"; // imprime 6\n\n//--------------maps y filters con funciones flecha\n$numeros = [1, 2, 3, 4, 5];\n\n$dobles = array_map(fn($n) =&gt; $n * 2, $numeros);\n$pares = array_filter($numeros, fn($n) =&gt; $n % 2 == 0);\n\nprint_r($dobles); // [2, 4, 6, 8, 10]\nprint_r($pares);  // [2, 4]\n\n//--------------maps y filters sin funciones flecha\n$dobles = array_map(\"multiplicar_2\", $numeros);\n\n$pares = array_filter($numeros, function($n) {\n    return $n % 2 == 0;\n});\n\nprint_r($dobles);\nprint_r($pares);\n</code></pre>"},{"location":"3%20primera_practica_PHP/#practica-funcionesphp","title":"Pr\u00e1ctica (funciones.php)","text":"<ul> <li>Escribe una funci\u00f3n <code>esPar(int $n): bool</code> y pru\u00e9bala con varios valores.</li> <li>crea una funcion que tome dos int y los sume, pruebala introducciendo dos float: \u00bfqu\u00e9 sucede?</li> <li>\u00bfEs obligatorio tipar las funciones? </li> <li>Escribe <code>areaTriangulo(float $base, float $altura): float</code> que devuelva el \u00e1rea.</li> <li>Crea un array <code>$edades = [15, 22, 30, 17, 19, 45];</code></li> </ul> <p>Usa <code>array_filter()</code> con una funci\u00f3n flecha para obtener solo las mayores o iguales de 18.</p> <p>Muestra el resultado con <code>print_r($mayores);</code></p>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/","title":"Setters y Getters. Conexion a BBDD y manejo de peticiones en entorno servidor. Practica 5","text":""},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#practica-guiada-5-conexiones-a-bd","title":"Pr\u00e1ctica Guiada 5. Conexiones a BD","text":""},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#1-breve-introduccion-a-la-programacion-orientada-a-objetos-en-php","title":"1-Breve introducci\u00f3n a la programaci\u00f3n orientada a objetos en PHP","text":"<p>La Programaci\u00f3n Orientada a Objetos (POO) es un paradigma de programaci\u00f3n , es decir, una forma de organizar y estructurar el c\u00f3digo, que se basa en el uso de objetos. Un objeto es una entidad que agrupa datos (propiedades o atributos) y comportamientos (m\u00e9todos o funciones) que pertenecen a esa entidad. La idea principal es modelar partes del mundo real usando estructuras de c\u00f3digo m\u00e1s cercanas a c\u00f3mo pensamos las cosas.</p> <p>Por ejemplo:</p> <ul> <li>Una persona tiene nombre, edad, DNI : son propiedades.</li> <li>Una persona camina(), habla(), saluda() : son m\u00e9todos.</li> </ul> <p>En POO combinamos ambas cosas dentro de una estructura llamada clase. A continuaci\u00f3n vemos las definciones m\u00e1s b\u00e1sicar de la POO que veramos a lo largo de esta pr\u00e1ctica.</p> <p>- Clase  Una clase es una plantilla que define c\u00f3mo ser\u00e1n los objetos creados a partir de ella. Ejemplo: La clase Coche describe qu\u00e9 datos tiene un coche (propiedades) como la marca, el modelo o el a\u00f1o, y qu\u00e9 puede hacer (m\u00e9todos) como arrancar y frenar.</p> <p>- Objeto  Un objeto es una instancia real creada a partir de una clase. Ejemplo: Un coche concreto, como un Seat Ibiza de 2018, es un objeto creado a partir de la clase Coche, es decir, una instancia.</p> <p></p> <p>- Propiedades  Son variables que representan la informaci\u00f3n que guarda un objeto. Ejemplo: Un coche tiene propiedades como color='rojo' o kil\u00f3metros=120000 o velocidad=40km/h.</p> <p>- M\u00e9todos  Son funciones que representan acciones que un objeto puede realizar.  Ejemplo: Un coche puede ejecutar acciones (m\u00e9todos) como arrancar() o acelerar(), que afectar\u00e1n a propiedades como la velocidad o los kil\u00f3metros.</p> <p>- Propiedades est\u00e1ticas  Son propiedades que pertenecen a la clase en general, no a cada objeto. Ejemplo (programado en lo siguiente): La clase Persona podr\u00eda tener un contador de cu\u00e1ntas personas se han creado en total, independientemente de qui\u00e9nes sean esas personas.</p>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#11-primer-ejemplo-de-poo-en-php","title":"1.1-Primer ejemplo de POO en PHP.","text":"<p>Nombre del script: primera_clase.php</p> <p>En este script, vemos el concepto de: Clase, Objeto (Instancia de la clase), Propiedades de un objeto y propiedades est\u00e1ticas de una clase. </p> <ul> <li>La pantilla ser\u00e1n las personas. Cada persona tendr\u00e1 dos propiedades, nombre y edad.</li> <li>Los objetos ser\u00e1n las personas que se crean a partir de la plantilla clase. Al crear una persona deberemos asignar un valor a las propiedades nombre y edad</li> <li>Adem\u00e1s, la plantilla (la clase) tendr\u00e1 una propiedad com\u00fan a todas las personas, que ser\u00e1 el n\u00famero de personas creadas.</li> </ul> <p>Os recomiendo ejecutar el siguiente c\u00f3digo en el int\u00e9rprete de php.</p> <pre><code>&lt;?php\nclass Persona\n{\n    // propiedades de la clase, que se definiran cuando la instanciemos\n    public string $nombre;\n    public int $edad;\n\n    // Contador de instancias de objeto, cada vez que creeemos a una persona subiremos en 1\n    public static int $contador = 0;\n\n    public function __construct(string $nombre, int $edad)\n    {\n        $this-&gt;nombre = $nombre;\n        $this-&gt;edad = $edad;\n        self::$contador++;\n    }\n}\n\n$persona1 = new Persona(\"Carlos\", 30);\n$persona2 = new Persona(\"Ana\", 25);\n$persona3 = new Persona(\"Luis\", 40);\n\necho $persona1-&gt;nombre . \", \" . $persona1-&gt;edad . \"\\n\"; // Carlos, 30\necho $persona2-&gt;nombre . \", \" . $persona2-&gt;edad . \"\\n\"; // Ana, 25\necho $persona3-&gt;nombre . \", \" . $persona3-&gt;edad . \"\\n\"; // Luis, 40\n\necho Persona::$contador  . \"\\n\"; // 3 \u2192 se crearon tres objetos\n\n//Por desgracia, podemos cambiar el nombre a Paco, cosa que no deber\u00edamos poder hacer.\n$persona1-&gt;nombre=\"Paco\";\necho $persona1-&gt;nombre . \", \" . $persona1-&gt;edad . \"\\n\"; // Carlos, 30\n\n//Por desgracia, podemos cambiar el numero de personas, cosa que no deber\u00edamos poder hacer porque tampoco tiene ningun sentido\n\nPersona::$contador=28;\necho Persona::$contador .  \"\\n\"; // 28 -&gt; No tiene sentido porque tenemos s\u00f3lo 3 personas`\n</code></pre> <p>Como podemos observar el c\u00f3digo anterior tiene ciertos problemas</p> <p>Se puede instanciar un objeto y posteriormente cambiar las propiedades del objeto sin piedad (como el nombre y la edad), incluso tambi\u00e9n podr\u00eda cambiar la propiedad est\u00e1tica de la clase,  propiedad que como hemos comentado antes,  es compartida entre todos los objetos instanciados.</p>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#12-segundo-ejemplo-de-poo-en-php-uso-de-propiedades-privadas","title":"1.2-Segundo ejemplo de POO en PHP. Uso de propiedades privadas.","text":"<p>En la segunda versi\u00f3n del c\u00f3digo (ver m\u00e1s abajo), haremos que nadie pueda cambiar el valor de la propiedad est\u00e1tica (el n\u00famero de personas), pas\u00e1ndola a privada. Adem\u00e1s, al ser privada, ya nadie podr\u00e1 acceder a ella haciendo:</p> <pre><code>Persona::$contador\n</code></pre> <p>y por tanto, la \u00fanica forma que tendr\u00e1 un usuario de ver el valor de esta propiedad est\u00e1tica ser\u00e1 definiendo una funci\u00f3n dentro de la clase que nos otorgue su valor, que se denominar\u00e1 <code>getter</code>, ya que nos da el valor de una propiedad (est\u00e1tica en este caso):</p> <pre><code>&lt;?php\nclass Persona\n{\n    public string $nombre;\n    public int $edad;\n    // Ponemos la propiedad como est\u00e1tica.\n    private static int $contador = 0;\n\n    public function __construct(string $nombre, int $edad)\n    {\n        $this-&gt;nombre = $nombre;\n        $this-&gt;edad = $edad;\n        self::$contador++;\n    }\n\n    // Getter de contador\n    public static function getContador(): int\n    {\n        return self::$contador;\n    }\n}\n\n\n$persona1 = new Persona(\"Carlos\", 30);\n$persona2 = new Persona(\"Ana\", 25);\n$persona3 = new Persona(\"Luis\", 40);\n\necho $persona1-&gt;nombre . \", \" . $persona1-&gt;edad . \"\\n\"; //La salida ser\u00e1: Carlos, 30\necho $persona2-&gt;nombre . \", \" . $persona2-&gt;edad . \"\\n\"; //La salida ser\u00e1: Ana, 25\necho $persona3-&gt;nombre . \", \" . $persona3-&gt;edad . \"\\n\"; //La salida ser\u00e1: Luis, 40\n\ntry {echo Persona::$contador . \"\\n\";} //ya no podemos acceder ni editar as\u00ed, hay que utilizar el getter\ncatch (Throwable $e) {echo $e-&gt;getMessage() . \"\\n\";}\necho Persona::getContador() . \"\\n\"; //Forma correcta de usar el getter\n\n//Por desgracia, podemos cambiar el nombre a Paco, cosa que no deber\u00edamos poder hacer.\n$persona1-&gt;nombre=\"Paco\";\necho $persona1-&gt;nombre . \", \" . $persona1-&gt;edad . \"\\n\"; // Carlos, 30\n</code></pre> <p>Como vemos al final del script siguen habiendo inconsistencias, como que se pueda cambiar el nombre de la persona (o incluso la edad). Esto se debe a que son propiedades p\u00fablicas.</p>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#13-tercer-ejemplo-de-poo-en-php-getters-y-setters-encapsulamiento","title":"1.3-Tercer ejemplo de POO en PHP. Getters y Setters. Encapsulamiento","text":"<p>En este \u00faltimo ejemplo, rizamos un poco m\u00e1s el rizo, lo que vemos ahora es encapsulaci\u00f3n. Es decir, vamos a arreglar lo anterior. Para ello, no expondremos directamente al p\u00fablico las propiedades \"edad\" y \"nombre\" si no que estas se podr\u00e1n editar u obtener \u00fanicamente a trav\u00e9s de getters y setters.</p> <p>- Getters y Setters  Son m\u00e9todos que permiten leer o modificar propiedades privadas de forma controlada. Ejemplo: Para saber la edad de una persona usamos getEdad(), y para cambiarla usamos setEdad(), que comprueba que sea un n\u00famero v\u00e1lido.</p> <pre><code>&lt;?php\nclass Persona\n{\n    // Todas las propiedades son privadas\n    private string $nombre;\n    private int $edad;\n\n    // Contador de instancias (est\u00e1tico y privado)\n    private static int $contador = 0;\n\n    public function __construct(string $nombre, int $edad)\n    {\n        $this-&gt;setNombre($nombre);\n        $this-&gt;setEdad($edad);\n        self::$contador++;\n    }\n\n    // Getter y setter de nombre\n    public function getNombre(): string\n    {\n        return $this-&gt;nombre;\n    }\n\n    public function setNombre(string $nombre): void\n    {\n        if (empty($nombre)) {\n            throw new Exception(\"El nombre no puede estar vac\u00edo.\");\n        }\n        $this-&gt;nombre = $nombre;\n    }\n\n    // Getter y setter de edad\n    public function getEdad(): int\n    {\n        return $this-&gt;edad;\n    }\n\n    public function setEdad(int $edad): void\n    {\n        if ($edad &lt; 0) {\n            throw new Exception(\"La edad no puede ser negativa.\");\n        }\n        $this-&gt;edad = $edad;\n    }\n\n    // M\u00e9todo est\u00e1tico\n\n    public static function getContador(): int\n    {\n        return self::$contador;\n    }\n}\n\n$persona1 = new Persona(\"Carlos\", 30);\n$persona2 = new Persona(\"Ana\", 25);\n$persona3 = new Persona(\"Luis\", 40);\n\n// Mostrar datos usando saltos de l\u00ednea (\\n)\necho $persona1-&gt;getNombre() . \", \" . $persona1-&gt;getEdad() . \"\\n\";\n</code></pre>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#practica-pt1-clase-basica-con-propiedades-publicas","title":"Pr\u00e1ctica PT1. Clase b\u00e1sica con propiedades p\u00fablicas","text":"<p>Crea un archivo llamado coches_1.php. En este archivo define una clase Coche con:</p> <ul> <li>Propiedades p\u00fablicas:</li> <li>marca (string)</li> <li>modelo (string)</li> <li>velocidad (int)</li> <li>Una propiedad est\u00e1tica p\u00fablica llamada contador, que registre cu\u00e1ntos coches se han creado.</li> <li>Un constructor que reciba los valores de marca, modelo y velocidad inicial.</li> </ul> <p>Se pide:</p> <ul> <li>Crear tres objetos tipo Coche, mostrar sus propiedades, mostrar el contador de coches, modificar \u201ca mano\u201d alguna propiedad p\u00fablica (por ejemplo cambiar la marca o la velocidad) y modificar \u201ca mano\u201d la propiedad est\u00e1tica.</li> </ul>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#practica-pt2-clase-basica-con-propiedades-publicas","title":"Pr\u00e1ctica PT2. Clase b\u00e1sica con propiedades p\u00fablicas","text":"<p>Crea un archivo coches_3.php. En este archivo define una clase Coche con:</p> <ul> <li>Todas las propiedades ser\u00e1n privadas:</li> <li>marca (string)</li> <li>modelo (string)</li> <li> <p>velocidad(int)</p> </li> <li> <p>La propiedad est\u00e1tica contador ser\u00e1 privada y tendr\u00e1 un getter (getContador) para ver su valor.</p> </li> <li>En el constructor, asigna marca y modelo usando setters (definidos m\u00e1s abajo) y no directamente en el constructor.</li> <li>La velocidad inicial debe ser siempre 0, independientemente de lo que se pase y se pondr\u00e1 as\u00ed en el constructor.</li> <li>Crea getters para ver los valores de las tres propiedades mencionadas</li> </ul> <p>Reglas del setter de marca y modelo (setModelo, setMarca):</p> <ul> <li>No pueden estar vac\u00edos y deben ser cadenas de texto.</li> <li>Adem\u00e1s, un coche no puede cambair de marca y modelo luego deben ser setter privados y no se pueden acceder desde fuera.</li> </ul> <p>Crear el metodo velocidad (addVelocidad) que suma o resta velocidad a un coche:</p> <ul> <li>La velocidad resultante no puede ser negativa y no puede superar los 250 km/h</li> </ul> <p>Se pide:</p> <ul> <li>Crear tres objetos tipo Coche, mostrar sus propiedades con los getters, mostrar el contador de coches con su getter.</li> </ul> <p>Intenta modificar \u201ca mano\u201d alguna propiedad p\u00fablica (por ejemplo cambiar la marca o la velocidad) \u00bfQu\u00e9 pasa?</p> <p>Usar el m\u00e9otodo addVelocidad para a\u00f1adir 10km/h de velocidad.</p>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#2-instalacion-de-mysql-creacion-de-usuarios-y-privilegios","title":"2-Instalaci\u00f3n de mySQL, creaci\u00f3n de usuarios y privilegios","text":"<p>En este apartado vamos a ver c\u00f3mo podemos conectarnos a bases de datos desde nuestra aplicaci\u00f3n.</p> <p>En primer lugas, instalamos mysqlserver</p> <pre><code>sudo apt update\nsudo apt install mysql-server\n</code></pre> <p>Una vez instalado, abrelo como root:</p> <pre><code>sudo mysql -u root\n</code></pre> <p>Crea una BD</p> <pre><code>CREATE DATABASE testdb;\n</code></pre> <p>y \u00fasala:</p> <pre><code>USE testdb;\n</code></pre> <p>Crea la tabla usuarios</p> <pre><code>CREATE TABLE usuarios (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    nombre VARCHAR(100) NOT NULL,\n    email VARCHAR(150) UNIQUE NOT NULL,\n    password VARCHAR(255) NOT NULL,\n    creado_en TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n</code></pre> <p>Despu\u00e9s, vamos a crear un usuario con privilegios m\u00ednimos, ya que cuando el cliente se conecte a la BD no lo har\u00e1 desde root. Adem\u00e1s, este usuario s\u00f3lo se podr\u00e1 conectar desde localhost y nunca de forma remota, es decir, s\u00f3lo s epodr\u00e1 conectar desde el servidor, al servidor, lo que significa que s\u00f3lo lo har\u00e1 desde los scripts de php (en nuestro caso). Esto depender\u00e1 en gran medida de la configuraci\u00f3n de nuestro servidor, en este caso, al ser nuestra aplicaci\u00f3n monol\u00edtica, nos vale.</p> <pre><code>CREATE USER 'www-data'@'localhost' IDENTIFIED BY '123456';\n</code></pre> <p>Le damos al usuario \u00fanicamente privilegios sobre la tabla que queramos, en este caso, la tabla de usuarios</p> <pre><code>GRANT SELECT, INSERT, UPDATE, DELETE ON testdb.usuarios TO 'www-data'@'localhost';\n</code></pre> <p>Para aplciar los privilegios anteriores:</p> <pre><code>FLUSH PRIVILEGES;\n</code></pre>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#2-conexion-a-la-bd-en-un-script-login-de-un-usuario-en-la-bbdd-loginphp","title":"2-Conexi\u00f3n a la BD en un script. Login de un usuario en la BBDD (Login.php)","text":"<p>Vamos a aprovechar el formulario de la p\u0155actica anterior (este):</p> <p></p> <p>y vamos a hacer que dos formularios (dos POST's y un GET quitamos el resto) se conecten a scripts que hagan cosas interesantes. En primer lugar, el primer POST se conecta al primer script, que llamaremos (Login.php) que nos devuelve informaci\u00f3n del usuario (en el siguiente punto veremos como registar a un usuario), la primera parte del script contendr\u00e1 esto:</p> <pre><code>&lt;?php\n$host = getenv(\"DB_HOST\");\n$db   = getenv(\"DB_NAME\");\n$user = getenv(\"DB_USER\");\n$pass = getenv(\"DB_PASS\");\n\n$conn = new mysqli($host, $user, $pass, $db);\n\nif ($conn-&gt;connect_error) {\n    die(\"Error de conexi\u00f3n: \" . $conn-&gt;connect_error);\n}\n\n// Recibir datos por un formulario (url-enconded)\n$email = $_POST['email'] ?? null;\n$pass_input = $_POST['password'] ?? null;\n\nif (!$email || !$pass_input) {\n    die(\"Faltan datos\");\n}\n</code></pre> <p>Hasta aqu\u00ed, todo entendible. Para la conexi\u00f3n a la BD no queremos exponer que en el script se vea el valor de user ni el valor de pass, es por eso que se recogen desde variables de entorno (un fichero donde estas variables est\u00e1n definidas de forma que nadie pordr\u00e1 verlas)</p> <p>En concreto, estas variables las pon\u00e9is en: /etc/apache2/envvars</p> <p>y escrib\u00eds:</p> <p></p> <p>Seguimos rellenando el script con la parte de la consulta:</p> <pre><code>$sql = \"SELECT id, nombre, email, password FROM usuarios WHERE email = ?\";\n$stmt = $conn-&gt;prepare($sql);\n$stmt-&gt;bind_param(\"s\", $email);\n$stmt-&gt;execute();\n$result = $stmt-&gt;get_result();\n</code></pre> <p>\u00bfQu\u00e9 singifica?</p> <pre><code>$sql = \"SELECT id, nombre, email, password FROM usuarios WHERE email = ?\";\n</code></pre> <p>El <code>?</code> es un hueco en donde luego vamos a poner el valor del email del usuario. No lo ponemos directamente en el string. Lo vamos a mandar aparte, de forma segura.</p> <pre><code>$stmt = $conn-&gt;prepare($sql);\n</code></pre> <ul> <li><code>$conn</code>: es la conexi\u00f3n a MySQL (<code>new mysqli(...)</code>).</li> <li><code>prepare()</code>: es un m\u00e9todo que le dice a MySQL: Aqu\u00ed tienes una consulta con huecos (<code>?</code>), prep\u00e1rala porque luego te mandar\u00e9 los valores.</li> <li>Devuelve un objeto de tipo <code>mysqli_stmt</code> (statement = sentencia preparada). Ese objeto lo guardamos en la variable <code>$stmt</code>.</li> </ul> <p>Si fallara algo, $stmt  ser\u00eda <code>false</code>. En c\u00f3digo se comprueba:</p> <pre><code>if (!$stmt) {\n    die(\"Error al preparar: \" . $conn-&gt;error);\n}\n</code></pre> <p>Por \u00faltimo, falta dar valor a <code>?</code>: esto se hace as\u00ed:</p> <pre><code>$stmt-&gt;bind_param(\"s\", $email);\n</code></pre> <p>Este es el m\u00e9todo que m\u00e1s confunde, as\u00ed que vamos muy lento: Pega la variable <code>$email</code> al <code>?</code> que pusimos en la consulta. O sea: el <code>?</code> ahora significa \u201cel valor de $email\u201d. Nos falta todav\u00eda saber qu\u00e9 significa la \"s\".</p> <p>\u00bfQu\u00e9 significa <code>\"s\"</code>? : El primer par\u00e1metro \"s\" indica el tipo de dato del valor que vas a pasar:</p> <ul> <li>\"s\"  string (texto)</li> <li>\"i\" integer (entero / n\u00famero)</li> <li>\"d\" double (n\u00famero decimal)</li> <li>\"b\"  blob (datos binarios)</li> </ul> <p>En este caso:  <code>\"s\"</code> = le estamos diciendo a MySQL: el hueco <code>?</code> va a recibir texto. En el ejemplo (el del POST) siguiente veremos que podemos pasar mas de una cosa y n\u00f3 solo una al mismo tiempo. Por \u00faltimo, ejecutamos la consulta y obtenemos el resultado:</p> <pre><code>$stmt-&gt;execute();\n#No tienes que mandar otra vez la consulta ni los valores: ya est\u00e1n \u201cdentro\u201d del $stmt aplicando el m\u00e9todo get_result.\n$result = $stmt-&gt;get_result();\n</code></pre> <p>Si quisieramos mandar el resultado al cliente, se lo mnandar\u00edamos mediante un array asociativo, usando;</p> <p>[!IMPORTANT]</p> <p><code>fetch_assoc()</code> devuelve UN array asociativo POR LLAMADA, es decir, si el resultado tuviera m\u00e1s de una fila, tendr\u00edamos que hacer algo as\u00ed:</p> <pre><code>while ($usuario = $result-&gt;fetch_assoc()) {\n    echo $usuario[\"nombre\"] . \"&lt;br&gt;\";\n}\n</code></pre> <p>De esta forma, en casa iteraci\u00f3n obtengo una fila distinta, cosa que no es necesaria en este caso.</p> <pre><code>$userData = $result-&gt;fetch_assoc();\n</code></pre> <p>que hace lo siguiente, si mi tabla tiene:</p> id nombre email 5 Juan test@mail.com <p>Convierte esto en un array asociativo que podremos manejar sin problemas en php;</p> <pre><code>[\n    \"id\" =&gt; 5,\n    \"nombre\" =&gt; \"Juan\",\n    \"email\" =&gt; \"test@mail.com\"\n]\n</code></pre> <p>El c\u00f3digo completo de (Login.php) queda as\u00ed:</p> <pre><code>&lt;?php\n$host = getenv(\"DB_HOST\");\n$db   = getenv(\"DB_NAME\");\n$user = getenv(\"DB_USER\");\n$pass = getenv(\"DB_PASS\");\n\n$conn = new mysqli($host, $user, $pass, $db);\n\nif ($conn-&gt;connect_error) {\n    die(\"Error de conexi\u00f3n: \" . $conn-&gt;connect_error);\n}\n\n// Recibir datos\n$email = $_POST['email'] ?? null;\n$pass_input = $_POST['password'] ?? null;\n\nif (!$email || !$pass_input) {\n    die(\"Faltan datos\");\n}\n\n// Consulta usando prepared statement\n$sql = \"SELECT id, nombre, email, password FROM usuarios WHERE email = ?\";\n\n$stmt = $conn-&gt;prepare($sql);\nif (!$stmt) {\n    die(\"Error al preparar: \" . $conn-&gt;error);\n}\n$stmt-&gt;bind_param(\"s\", $email);\n$stmt-&gt;execute();\n$result = $stmt-&gt;get_result();\n\nif ($result-&gt;num_rows === 0) {\n    die(\"Usuario no encontrado\");\n}\n\n$userData = $result-&gt;fetch_assoc();\n\n// Verificar contrase\u00f1a hasehada, esta funci\u00f3n es important\u00edsima ya que mirar\u00e1 la contrase\u00f1a hasheada de la bd\nif (!password_verify($pass_input, $userData['password'])) {\n    exit(\"Contrase\u00f1a incorrecta\");\n}\n\n// Si llega aqu\u00ed, login v\u00e1lido.\nunset($userData['password']);\n\necho json_encode([\n    \"status\" =&gt; \"success\",\n    \"message\" =&gt; \"Login exitoso\",\n    \"data\" =&gt; $userData\n]);\n\n$stmt-&gt;close();\n$conn-&gt;close();\n?&gt;\n</code></pre>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#3-conexion-a-la-bbddpost-registrar-a-un-usuario-para-probar-el-loggin-anterior-registerphp","title":"3-Conexi\u00f3n a la BBDD.POST. Registrar a un usuario para probar el loggin anterior. (Register.php)","text":"<p>Ya sabemos un poco sobre conexi\u00f3n a base de datos seg\u00fan lo visto en el punto anterior. Ahora vamos al rev\u00e9s, os doy el script entero de (Register.php) y lo que haremos ser\u00e1 desmenuzar los puntos que no comprendamos.</p> <pre><code>&lt;?php\nheader(\"Content-Type: application/json\");\n\nini_set('display_errors', 1);\nini_set('display_startup_errors', 1);\nerror_reporting(E_ALL);\n\n$host = getenv(\"DB_HOST\");\n$db   = getenv(\"DB_NAME\");\n$user = getenv(\"DB_USER\");\n$pass = getenv(\"DB_PASS\");\n\n$conn = new mysqli($host, $user, $pass, $db);\n\nheader(\"Content-Type: application/json\");\n\nif ($conn-&gt;connect_error) {\n    echo json_encode([\"status\" =&gt; \"error\", \"message\" =&gt; \"Error de conexi\u00f3n\"]);\n    exit;\n}\n\n$nombre = $_POST['nombre'] ?? null;\n$email = $_POST['email'] ?? null;\n$pass_input = $_POST['password'] ?? null;\n\nif (!$nombre || !$email || !$pass_input) {\n    echo json_encode([\"status\" =&gt; \"error\", \"message\" =&gt; \"Faltan datos\"]);\n    exit;\n}\n\n$hashedPassword = password_hash($pass_input, PASSWORD_DEFAULT);\n\n$sql = \"INSERT INTO usuarios (nombre, email, password) VALUES (?, ?, ?)\";\n\ntry {\n    $stmt = $conn-&gt;prepare($sql);\n    $stmt-&gt;bind_param(\"sss\", $nombre, $email, $hashedPassword);\n    $stmt-&gt;execute();\n\n    echo json_encode([\n        \"status\" =&gt; \"success\",\n        \"message\" =&gt; \"Usuario registrado correctamente\",\n        \"user_id\" =&gt; $stmt-&gt;insert_id\n    ]);\n\n} catch (Exception $e) {\n    echo json_encode([\n        \"status\" =&gt; \"error\",\n        \"message\" =&gt; \"Error al registrar usuario\",\n        \"mysql_error\" =&gt; $conn-&gt;error\n    ]);\n}\n\nif (isset($stmt)) {\n    $stmt-&gt;close();\n}\n\n$conn-&gt;close();\n?&gt;\n</code></pre> <p>Vamos la cosas que todav\u00eda pueden resultar confusas porque no se han visto antes;</p>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#que-es-password_default","title":"\u00bfQu\u00e9 es PASSWORD_DEFAULT?","text":"<p>Es una constante predefinida por PHP cuyo valor es un n\u00famero entero que identifica el algoritmo de hasehado de contrase\u00f1a. No lo ves como texto porque PHP ya lo interpreta. si haces:</p> <pre><code>echo PASSWORD_DEFAULT;\n</code></pre> <p>obtienes <pre><code>1 #metodo de hasehado por defecto. esto no se suele cambiar ni pedir\u00e9 que lo hag\u00e1is\n</code></pre></p>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#otras-cosas-importantes","title":"Otras cosas importantes","text":"<p>En el (<code>INSERT</code>) que acabamos de usar, hacemos un \"if\" con el execute<code>if ($stmt-&gt;execute())</code> . Esto no lo hac\u00edamos en el punto 2 de esta pr\u00e1ctica cuando ve\u00edamos el loggin.</p> <p>Esto tiene sentido en este caso y no en el del punto anterior porque <code>execute()</code> te dice si la consulta se ejecut\u00f3 correctamente o fall\u00f3 (true o false). En este caso, si no se insert\u00f3 nada, falla y devuelve false, por tanto, debemos devolver un error.</p> <p>Sin embargo, En el login anterior, se hac\u00eda una <code>SELECT</code> y no un <code>INSERT</code>, y en este caso, <code>execute()</code> devuelve true siempre que la consulta haya terminado correctamente, a pesar de que haya devuelto 0 registros, esto pasa porque la consulta es v\u00e1lida aunque NO DEVUELVA RESULTADOS.  Por eso se usa despu\u00e9s:</p> <pre><code>if ($result-&gt;num_rows === 0)\n</code></pre> <p>y no el if directamente sobre el m\u00e9todo execute.</p>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#4-conexion-a-la-bbdd-get-que-devuelve-la-info-de-todos-los-usuarios-all_usersphp","title":"4-Conexi\u00f3n a la BBDD. GET que devuelve la info de todos los usuarios. (All_users.php)","text":"<p>En este caso, no hace falta explciar tanto ya que hemos visto muchas cosas, este formulario es el ejemplo vivo de un get en el que no se env\u00eda ninguna informaci\u00f3n. A continuaci\u00f3n os dejo el c\u00f3digo. Recordar que en un formulario html que use get, los par\u00e1metros se env\u00edan por query-param:</p> <pre><code>&lt;?php\nheader(\"Content-Type: application/json\");\n\n$host = getenv(\"DB_HOST\");\n$db   = getenv(\"DB_NAME\");\n$user = getenv(\"DB_USER\");\n$pass = getenv(\"DB_PASS\");\n\n$conn = new mysqli($host, $user, $pass, $db);\n\nif ($conn-&gt;connect_error) {\n    die(json_encode([\"status\" =&gt; \"error\", \"message\" =&gt; \"Error de conexi\u00f3n: \" . $conn-&gt;connect_error]));\n}\n\n\nif ($_SERVER['REQUEST_METHOD'] !== 'GET') {\n    http_response_code(405);\n    die(json_encode([\"status\" =&gt; \"error\", \"message\" =&gt; \"M\u00e9todo no permitido\"]));\n}\n\n// Consulta\n$sql = \"SELECT id, nombre, email FROM usuarios\";\n\n$stmt = $conn-&gt;prepare($sql);\nif (!$stmt) {\n    die(json_encode([\"status\" =&gt; \"error\", \"message\" =&gt; \"Error al preparar consulta: \" . $conn-&gt;error]));\n}\n\n$stmt-&gt;execute();\n$result = $stmt-&gt;get_result();\n\n$usuarios = [];\n\nwhile ($row = $result-&gt;fetch_assoc()) {\n    $usuarios[] = $row;\n}\n\necho json_encode([\n    \"status\" =&gt; \"success\",\n    \"message\" =&gt; \"Usuarios obtenidos correctamente\",\n    \"data\" =&gt; $usuarios\n]);\n\n$stmt-&gt;close();\n$conn-&gt;close();\n?&gt;\n</code></pre> <p>Ojo cuidado, una cosa importante es que en este coso tenemos que recorrer fetch_assoc() seg\u00fan lo que explicamos ya en el bloque important del punto 2.</p>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#5-esquema-del-html","title":"5- Esquema del HTML","text":"<p>A modo esquematico, el body html har\u00e1 las peticiones as\u00ed (el put y el delete siguen haciendo lo que deb\u00edan hacer en la pr\u00e1ctica anterior utilizando los fetch en JS). En primer lugar, el HTML  (El primer POST y el segundo POST) har\u00e1n las peticiones as\u00ed:</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;title&gt;Document&lt;/title&gt;\n\n\n    &lt;style&gt;\n        body {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n\n        .contenedor {\n            display: flex;\n            flex-direction: column;\n        }\n\n        .carta {\n            border: 1px solid rgb(1, 1, 1);\n            text-align: center;\n            margin-top: 1rem;\n            border-radius: 1rem;\n            padding: 1rem;\n            background-color: rgb(222, 255, 252);\n            max-width: 320px;\n        }\n\n        form {\n            display: flex;\n            flex-direction: column;\n            margin-top: 0.5rem;\n\n        }\n        input {\n            max-width:2,5rem;\n            margin: 0px auto;\n            margin-top:0.5rem;\n        }\n\n        button {\n            max-width:2,5rem;\n            margin: 0px auto;\n            margin-top:0.5rem;\n        }\n    &lt;/style&gt;\n\n\n\n&lt;/head&gt;\n\n\n&lt;body&gt;\n    &lt;div class=\"contenedor\"&gt;\n\n        &lt;div class=\"carta\"&gt;\n            &lt;form action=\"Login.php\" method=\"POST\"&gt;\n                &lt;h2&gt;Esto ser\u00eda un primer POST de login&lt;/h2&gt;\n                &lt;input type=\"text\" name=\"email\" placeholder=\"email\"&gt;\n                &lt;input type=\"password\" name=\"password\" placeholder=\"Contrase\u00f1a\"&gt;\n                &lt;button type=\"submit\"&gt;Enviar&lt;/button&gt;\n            &lt;/form&gt;\n        &lt;/div&gt;\n\n        &lt;div class=\"carta\"&gt;\n            &lt;form action=\"Register.php\" method=\"POST\" enctype=\"multipart/form-data\"&gt;\n                &lt;h2&gt;Esto ser\u00eda un POST de register&lt;/h2&gt;\n                &lt;input type=\"text\" name=\"nombre\" placeholder=\"Nombre\"&gt;\n                &lt;input type=\"text\" name=\"email\" placeholder=\"Email\"&gt;\n                &lt;input type=\"password\" name=\"password\" placeholder=\"Contrase\u00f1a\"&gt;\n                &lt;input type=\"file\" name=\"foto\"&gt;\n                &lt;button type=\"submit\"&gt;Enviar &lt;/button&gt;\n            &lt;/form&gt;\n        &lt;/div&gt;\n\n\n        &lt;div class=\"carta\"&gt;\n            &lt;form action=\"All_users.php\" method=\"GET\"&gt;\n                &lt;h2&gt;Esto ser\u00eda un GET de todos los usuarios&lt;/h2&gt;\n                &lt;button type=\"submit\"&gt;Enviar &lt;/button&gt;\n            &lt;/form&gt;\n        &lt;/div&gt;\n\n\n&lt;/body&gt;\n\n&lt;/html&gt;\n</code></pre> <p>En las pr\u00e1cticas siguientes veremos como utilzar el PUT y el DELETE de forma pr\u00e1ctica y real, borrando registros de la BD y editando cuestiones de la BD.</p>"},{"location":"5-Pr%C3%A1ctica.%20Conexiones_bd/#6-practica","title":"6- Pr\u00e1ctica","text":"<p>1-Realiza la pr\u00e1ctica guiada anterior e intenta que por cada usuario que se registre suba una foto del usuario dentro de la carpeta uploads.</p> <p>2-Crea dos formularios HTML (en peticiones_productos.html) que NO usar\u00e1n javascript. Ambos deber\u00e1n hacer una petici\u00f3n GET y un POST respectivamente. Usar\u00e1n boton de tipo submit y la informaci\u00f3n no se recoger\u00e1 din\u00e1micamente si no que se har\u00e1 directamente desde el html.</p> <ul> <li> <p>El POST del formulario html apuntar\u00e1 al script: productos_form.php. Lo que har\u00e1 este script sera conectarse a la BD para registar un producto junto con su ID en una base de datos llamada productos y una breve descripcion. Deber\u00e1s crear la tabla productos para ello.</p> </li> <li> <p>El GET recoger\u00e1 la informaci\u00f3n de un producto en espec\u00edfico (quey -param), en este caso, no ser\u00e1 un json si no que el script \"info_productos.php\" deber\u00e1 devolver un echo con la informaci\u00f3n entera del producto.</p> </li> </ul>"},{"location":"Pr%C3%A1ctica%201/","title":"-Pr\u00e1ctica: Recuperar el Muro Mar\u00eda","text":"<p>Eres un recluta reci\u00e9n graduado del 104\u00ba Cuerpo de Entrenamiento. Tu misi\u00f3n es demostrar tus habilidades t\u00e9cnicas (en Postman o con <code>curl</code>) para unirte a una legi\u00f3n y luchar contra los titanes. Cada endpoint de esta API representa un reto. Sigue el orden y usa el formato correcto, o fallar\u00e1s en la misi\u00f3n. Para poder ejecutar esta pr\u00e1ctica necesitas instalar:</p> <ol> <li>Docker</li> <li>Postman</li> <li>Tener el paquete curl instalado en tu distribuci\u00f3n debian (por defecto en Ubuntu)</li> </ol>"},{"location":"Pr%C3%A1ctica%201/#parte-1-de-la-practica-postman","title":"Parte 1 de la pr\u00e1ctica (POSTMAN)","text":""},{"location":"Pr%C3%A1ctica%201/#1-registrar-un-recluta","title":"1. Registrar un recluta","text":"<p>Verbo:?\u00bf ruta:<code>/register</code> </p> <p>Envia los datos en el body y en JSON. El siguiente ejemplo muestra los datos que debes enviar para que un recluta se pueda alistar.</p> <pre><code>{\n  \"username\": \"eren\",\n  \"password\": \"1234\",\n  \"legion\": \"Exploradores\",\n  \"mentor\": \"Erwin\",\n  \"edad\": 15\n}\n</code></pre> <p>Respuesta esperada:</p> <pre><code>{\n  \"mensaje\": \"Recluta eren registrado en la legi\u00f3n Exploradores, bajo la inspiraci\u00f3n de Erwin\"\n}\n</code></pre> <p>Pregunta: \u00bfQu\u00e9 verbo http debes usar body?</p> <p>Pregunta: \u00bfQu\u00e9 debes enviar \"claves\" en el body?</p> <p>Pregunta: \u00bfQu\u00e9 pasa si eliges <code>\"legion\": \"Caballer\u00eda\"</code> o <code>\"mentor\": \"Levi\"</code>?</p> <p>Pregunta: \u00bfQu\u00e9 pasa si el mentor no es [\"Eren\", \"Erwin\", \"Armin\", \"Mikasa\", \"Reiner\"]?</p> <p>Pregunta: \u00bfQu\u00e9 pasa si la legi\u00f3n no es [\"Exploradores\", \"Guarnici\u00f3n\", \"Polic\u00eda Militar\"]?</p> <p>Pregunta: \u00bfQu\u00e9 error devuelve si la edad es menor de 14?</p> <p>Pregunta: \u00bfQu\u00e9 pasa si el recluta ya existe?</p> <p>Imprime todas las respuestas!</p>"},{"location":"Pr%C3%A1ctica%201/#2-ver-info-de-un-recluta","title":"2. Ver info de un recluta","text":"<p>Verbo:POST ruta:<code>/login</code>  Prueba distintos formatos de datos para enviar la informaci\u00f3n de login y as\u00ed ver la informaci\u00f3n confidencial de dicho recluta. Deber\u00e1s enviar usuario y contrase\u00f1a.</p> <p>Respuesta esperada sobre del endpoint en caso de usar contrase\u00f1a correcta:</p> <pre><code>{\n  \"mensaje\": \"Acceso concedido\",\n  \"recluta\": {\n    \"id\": \"...\",\n    \"username\": \"eren\",\n    \"legion\": \"Exploradores\",\n    \"mentor\": \"Erwin\",\n    \"edad\": 15\n  }\n}\n</code></pre> <p>\u00bfQu\u00e9 mensajes devuelve la API en los siguientes casos?</p> <ol> <li> <p>\u00bfCon qu\u00e9 formato de datos enviaste el Post?</p> </li> <li> <p>Si intentas hacer login con un usuario que no existe en la base de datos.</p> </li> <li>Si el usuario existe pero introduces una contrase\u00f1a incorrecta una vez.</li> <li>Si introduces una contrase\u00f1a incorrecta dos veces seguidas.</li> <li>\u00bfQu\u00e9 ocurre en el tercer intento fallido de contrase\u00f1a?</li> <li>Intenta iniciar sesi\u00f3n con un usuario al que han echado del cuerpo</li> </ol>"},{"location":"Pr%C3%A1ctica%201/#3-obtener-mision-aleatoria","title":"3. Obtener misi\u00f3n aleatoria","text":"<p>Verbo:\u00bf? ruta:<code>/mission</code> </p> <ol> <li> <p>\u00bfQu\u00e9 verbo debes usar?</p> </li> <li> <p>\u00bfQu\u00e9 otras misiones puede asignarte la API?</p> </li> <li> <p>\u00bfCu\u00e1ntas son en total?</p> </li> <li>Devuelve alguna  salida del endpoint</li> </ol>"},{"location":"Pr%C3%A1ctica%201/#4-preguntar-al-comandante-erwin","title":"4. Preguntar al Comandante Erwin","text":"<p>GET <code>/pregunta/erwin?task=\u00bfQue debo hacer?</code></p> <p>Utiliza este Get para preguntar mediante la \"variable\" task a Erwing una pregunta.</p> <ol> <li>\u00bfQu\u00e9 te responde Erwing? </li> <li> <p>\u00bfC\u00f3mo se llama este env\u00edo de datos mediante un Get? </p> </li> <li> <p>\u00bfEs bueno para enviar una contrase\u00f1a?</p> </li> <li>Devuelve la salida del endpoint</li> </ol>"},{"location":"Pr%C3%A1ctica%201/#5-hablar-a-otro-personaje","title":"5. Hablar a otro personaje","text":"<p>GET <code>/pregunta/:personaje</code></p> <p>Utiliza este GET para hablar a otro personaje algo que tu quieras, en este caso responde a las siguientes preguntas:</p> <ol> <li>\u00bfPuedes hablar con cualquier personaje?</li> <li>\u00bfEliges la pregunta que hace o solo a quien hablas?</li> <li>\u00bfC\u00f3mo se llama este env\u00edo de datos para solicitar un recurso? </li> <li>Devuelve la salida del endpoint</li> </ol>"},{"location":"Pr%C3%A1ctica%201/#6-unirte-a-una-tropa","title":"6. Unirte a una Tropa","text":"<p>POST <code>/enlist</code></p> <p>Utiliza este POST para ir de expedici\u00f3n junto con un n\u00famero de tropa. En el body debes enviar el n\u00famero de tropa.</p> <ol> <li>\u00bfEn qu\u00e9 formato debes enviarlo?</li> <li>\u00bfQu\u00e9 rango de n\u00fameros puedes enviar?</li> <li>Devuelve la salida del endpoint</li> </ol>"},{"location":"Pr%C3%A1ctica%201/#7-analizar-titan","title":"7. Analizar Titan","text":"<p>POST <code>/titan</code></p> <p>Utiliza este POST para informar de los datos de un tit\u00e1n. En el body puedes incluir lo que quieras mientras que sea texto</p> <ol> <li>\u00bfEn qu\u00e9 formato puedes enviar la informaci\u00f3n?</li> <li>Devuelva la salida del endpoint</li> </ol>"},{"location":"Pr%C3%A1ctica%201/#8-cumplir-anos","title":"8. Cumplir a\u00f1os","text":"<p>Verbo:\u00bf? Endpoint:<code>/recruit/:id/age</code></p> <p>Utiliza este endpoint para hacer que un recluta que quieras cumpla un a\u00f1o</p> <ol> <li> <p>Establece una estrategia para encontrar el ID del recluta</p> </li> <li> <p>\u00bfQu\u00e9 verbo debe usar este endpoint?</p> </li> <li>Devuelva la salida del endpoint</li> <li>\u00bfExiste body en este caso?</li> </ol>"},{"location":"Pr%C3%A1ctica%201/#9-retirar-a-un-recluta-del-frente","title":"9. Retirar a un recluta del frente","text":"<p>Verbo:\u00bf? Endpoint:<code>/retire/:id</code></p> <p>El objetivo de este endpoint es que despu\u00e9s de que ejecutarlo desaparezca por completo la info del recluta y no se pueda volver a ver su info. Para ello, deber\u00e1s enviar en el body la contrase\u00f1a del recluta sola en un JSON.</p> <ol> <li>Establece una estrategia para encontrar el ID del recluta</li> <li>\u00bfQu\u00e9 verbo debe usar este endpoint?</li> <li>Devuelve la salida del endpoint</li> <li>Prueba que, efectivamente despu\u00e9s de borrar al recluta ya no vuelve a aparecer (intentando hacer login, por ejemplo).</li> </ol>"},{"location":"Pr%C3%A1ctica%201/#10-enviar-mapa-de-datos-png","title":"10. Enviar mapa de datos (png)","text":"<p>Verbo:\u00bf? Endpoint:<code>/map</code></p> <p>El objetivo de este endpoint es enviar un png con la informaci\u00f3n a armin sobre donde se encuentran los titanes m\u00e1s cercanos</p> <p>1- \u00bfQu\u00e9 verbo http debo usar?</p> <p>2- Devuelve las respuesta al enviar un png</p> <p>3- \u00bfQu\u00e9 pasa si no env\u00edo un png? 4- \u00bfA qu\u00e9 salida carpeta de tu proyecto se est\u00e1 guardando en caso de respuesta satisfactoria?</p> <p>5- \u00bfEn qu\u00e9 formato de dato enviaste la petici\u00f3n?</p>"},{"location":"Pr%C3%A1ctica%201/#parte-2-curl","title":"Parte 2 (CURL)","text":"<p>Este apartado es el m\u00e1s importante. Con cada uno de los endpoints anteriores se pide que hagas un CURL v\u00eda terminal para comprobar que las cosas funcionan bien. Adjunta en markdown, junto con capturas, loes ejemplos en cada endpoints junto con sus respuestas.</p>"},{"location":"Teoria%20CURL/","title":"-Teor\u00eda de <code>curl</code> (Previo pr\u00e1ctica)","text":""},{"location":"Teoria%20CURL/#que-es-curl","title":"\u00bfQu\u00e9 es <code>curl</code>?","text":"<p><code>curl</code> =Client URL. Es una herramienta de l\u00ednea de comandos para transferir datos con URLs. Soporta m\u00faltiples protocolos (HTTP, HTTPS, FTP, SFTP, SCP, LDAP, etc.), pero normalmente lo usamos con HTTP/HTTPS.</p>"},{"location":"Teoria%20CURL/#sintaxis-basica","title":"Sintaxis b\u00e1sica","text":"<pre><code>curl [opciones] [URL]\n#Ejemplo simple:\ncurl https://jsonplaceholder.typicode.com/posts/1\n</code></pre>"},{"location":"Teoria%20CURL/#flags-opciones-mas-comunes-en-http","title":"Flags (opciones) m\u00e1s comunes en HTTP","text":""},{"location":"Teoria%20CURL/#1-metodo-http","title":"1- M\u00e9todo HTTP","text":"<p><code>-X &lt;METHOD&gt;</code> . Especifica el m\u00e9todo (<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, etc.) Por defecto, si no ponemos nada usa GET.</p> <pre><code>curl -X GET http://localhost:3000/ping\ncurl -X DELETE http://localhost:3000/delete/1\n</code></pre>"},{"location":"Teoria%20CURL/#2-encabezados","title":"2- Encabezados","text":"<p><code>-H \"&lt;Header&gt;: &lt;valor&gt;\"</code> . a\u00f1ade encabezados HTTP. Nos centramos en el encabezado \"Content-Type\"</p> <pre><code>curl -H \"Content-Type: application/json\" -H \"Authorization: Bearer token\" http://localhost:3000/json\n</code></pre>"},{"location":"Teoria%20CURL/#3-cuerpo-de-la-peticion-body","title":"3- Cuerpo de la petici\u00f3n (body)","text":"<p>Solo nos centraremos en 4 tipos de formatos (Content-Type del Header). </p> <ul> <li> <p><code>application/x-www-form-urlencoded</code></p> </li> <li> <p><code>application/json</code></p> </li> <li> <p><code>text/plain</code>**, **</p> </li> <li> <p><code>multipart/form-data</code>.</p> </li> </ul> <p>Ahora bien, \u00bfc\u00f3mo se env\u00edan este tipo de formatos a trav\u00e9s de un CURL?</p> <ul> <li> <p><code>-d \"campo1=valor&amp;campo2=valor\"</code> \u2192 env\u00eda datos en <code>application/x-www-form-urlencoded</code>. De hecho, si no pones -X POST, se sigue haciendo POST por defecto.</p> </li> <li> <p><code>-d @archivo.json</code> \u2192 env\u00eda el contenido de un archivo como body en formato  <code>application/json</code>. Est\u00e1 guay por si tienes el contenido del Json directamente en un archivo y no quieres escribirlo en la petici\u00f3n.</p> </li> <li> <p><code>--data-raw \"texto crudo\"</code> \u2192 env\u00eda datos tal cual (\u00fatil para texto plano sin necesidad de que est\u00e9n en un archivo) como por ejemplo <code>text/plain</code>. Aunque tambi\u00e9n se puede enviar JSON si se pone en el header :<code>application/json</code> sin necesidad de escribir la informaci\u00f3n en un archivo.</p> </li> <li> <p><code>-F \"campo=@archivo.txt\"</code> \u2192 env\u00eda un archivo en <code>multipart/form-data</code>. \u00datil para enviar binarios con informaci\u00f3n (justo lo que hacen los formularios de register, enviar texto junto con la foto d perfil del usuario)</p> </li> </ul> <p>1-Ejemplos: <code>application/x-www-form-urlencoded</code></p> <pre><code># Enviar formulario POST URL-en (lo q hace por defecto los HTML)\ncurl -X POST \"https://httpbin.org/post\" \\\n  -H \"Content-Type: application/x-www-form-urlencoded\" \\\n  -d \"username=ana&amp;password=secreto\"\n</code></pre> <p>2-Ejemplos: <code>archivo.json</code>. La ruta de <code>archivo.json</code> debe ser relativa a donde ejecutas el comando o absoluta.</p> <pre><code># el archivo.json de ejmpl contiene {\"name\":\"Ana\",\"role\":\"admin\"}\ncurl -X POST \"https://httpbin.org/post\" \\\n  -H \"Content-Type: application/json\" \\\n  -d @archivo.json\n</code></pre> <p>3-Ejemplos: <code>--data-raw \"texto crudo\"</code>   \u00bfPor qu\u00e9 usar <code>--data-raw</code> en lugar de <code>-d</code>?</p> <ul> <li> <p><code>-d</code> tambi\u00e9n sirve, pero interpreta algunas cosas (por ejemplo <code>@archivo</code> lo trata como archivo).</p> </li> <li> <p><code>--data-raw</code> asegura que el string se mande tal cual (sin interpretar).</p> </li> </ul> <p>Si usas JSON con <code>--data-raw</code>, s\u00ed debes poner <code>-H \"Content-Type: application/json\"</code> porque el servidor necesita saber que lo que le mandas es JSON.</p> <pre><code>curl -X POST \"https://httpbin.org/post\" \\\n  -H \"Content-Type: text/plain\" \\\n  --data-raw \"Este es un mensaje en texto plano\\nSegunda l\u00ednea\"\n\n # Enviar JSON inline sin fichero (m\u00ednimo)\ncurl -X POST \"https://httpbin.org/post\" \\\n  -H \"Content-Type: application/json\" \\\n  --data-raw '{\"title\":\"Hola\",\"body\":\"Mundo\"}'\n</code></pre> <p>4-Ejemplos:<code>-F \"campo=@archivo.txt\"</code> \u2192 env\u00eda un archivo en <code>multipart/form-data</code>. <code>-F \"campo=valor\"</code> \u2192 env\u00eda tambi\u00e9n campos normales de texto.</p> <ul> <li>file=@/ruta/a/mapa.png<code>\u2192 adjunta el archivo (ruta relativa o absoluta, igual que con</code>@archivo.json`)</li> </ul> <pre><code>curl -X POST http://localhost:3000/map \\\n  -F \"file=@/ruta/a/mapa.png\" \\\n  -F \"mission=recuperar_muro\" \\\n  -F \"commander=Erwin\"\n</code></pre> <p>Ojo: Si usas <code>-d</code> sin especificar <code>-X</code>, curl autom\u00e1ticamente usa <code>POST</code> y as\u00ed te lo ahorras.</p>"},{"location":"Teoria%20CURL/#4-envio-de-datos-dentro-de-la-propia-url","title":"4- Env\u00edo de datos dentro de la propia URL.","text":"<p>Los query params siempre van en la URL, despu\u00e9s del <code>?</code>. Es decir, nunca viajan en el cuerpo de la petici\u00f3n.  Para hacer un env\u00edo de query-params a trav\u00e9s de un get, se hace de la siguiente forma:</p> <pre><code>curl --get \"https://api.ejemplo.com/buscar\" \\\n  -d \"q=hola mundo\" \\\n  -d \"categoria=libros usados\" \\\n  -d \"autor=Manolito\"\n</code></pre> <p>Ojo, No uses <code>-X GET</code> cuando env\u00edas query params con <code>-d</code>. Usa <code>--get</code> . Esto es un error conceptual, porque:</p> <ul> <li><code>-d</code> (o <code>--data</code>) se utiliza para enviar cuerpo (POST/PUT)</li> <li><code>GET</code> no tiene cuerpo</li> </ul> <p>Poniendo <code>--get</code> o incluso <code>G</code>, obligamos a que -d se convierta en un query-param. En el caso de que se quiera enviar caract\u00e9res codificamos en UTF-8 conviene usar --data-urlencode.</p> <pre><code>curl -G \"https://api.ejemplo.com/buscar\" \\\n  --data-urlencode \"q=hola mundo\" \\\n  --data-urlencode \"categoria=libros usados\" \\\n  --data-urlencode \"autor=El churumbel\"\n</code></pre>"},{"location":"Teoria%20CURL/#5-mostrar-respuesta-y-otras-opciones-de-curl","title":"5- Mostrar respuesta y otras opciones de curl","text":"<ul> <li>Por defecto imprime la respuesta en stdout.</li> <li><code>-i</code> . muestra tambi\u00e9n encabezados de la respuesta.</li> <li><code>-s</code>. modo silencioso (no muestra barra de progreso ni errores).</li> <li><code>-v</code> . verbose (muestra detalles de la petici\u00f3n y respuesta).</li> <li><code>-o archivo.txt</code> . guarda la respuesta en un archivo.</li> <li><code>-O</code> . guarda con el mismo nombre que el archivo remoto.</li> </ul>"},{"location":"Vscode/","title":"Vscode","text":""},{"location":"Vscode/#formatear-y-ajustar-codigo","title":"FORMATEAR Y AJUSTAR C\u00d3DIGO","text":""},{"location":"Vscode/#formatear-documento-indentado-automatico","title":"Formatear documento (indentado autom\u00e1tico)","text":"<p><code>Ctrl + Shift + I</code></p>"},{"location":"Vscode/#ajustar-lineas-al-ancho-de-la-pantalla-word-wrap","title":"Ajustar l\u00edneas al ancho de la pantalla (word wrap)","text":"<p><code>Alt + Z</code></p>"},{"location":"Vscode/#comentardescomentar-bloque-de-codigo","title":"Comentar/Descomentar bloque de c\u00f3digo","text":"<p><code>Control + Shift + /</code></p>"},{"location":"Vscode/#terminal","title":"TERMINAL","text":""},{"location":"Vscode/#abrir-ocultar-terminal-integrada","title":"Abrir / Ocultar terminal integrada","text":"<ul> <li><code>Ctrl +</code></li> </ul>"},{"location":"Vscode/#nueva-terminal","title":"Nueva terminal","text":"<ul> <li>Ctrl + Shift + `</li> </ul>"},{"location":"Vscode/#panel-lateral-explorer-y-secciones","title":"PANEL LATERAL (EXPLORER Y SECCIONES)**","text":""},{"location":"Vscode/#abrir-cerrar-panel-lateral","title":"Abrir / Cerrar panel lateral","text":"<ul> <li><code>Ctrl + B</code></li> </ul>"},{"location":"Vscode/#moverse-entre-secciones-del-panel-explorer-search-git-etc","title":"Moverse entre secciones del panel (Explorer, Search, Git, etc.)","text":"<ul> <li>Explorer: <code>Ctrl + Shift + E</code> </li> <li>Search: <code>Ctrl + Shift + F</code> </li> <li>Source Control: <code>Ctrl + Shift + G</code> </li> <li>Run/Debug: <code>Ctrl + Shift + D</code> </li> <li>Extensions: <code>Ctrl + Shift + X</code> </li> </ul>"},{"location":"Vscode/#seleccionaractivar-el-panel-lateral","title":"Seleccionar/activar el panel lateral","text":"<ul> <li><code>Ctrl + 0</code></li> </ul>"},{"location":"Vscode/#volver-al-editor-de-codigo","title":"Volver al editor de c\u00f3digo","text":"<ul> <li><code>Ctrl + 1</code></li> </ul>"},{"location":"Vscode/#ir-a-linea-de-codigo","title":"Ir a l\u00ednea de c\u00f3digo","text":"<ul> <li><code>Ctrl + G</code> y escribir linea</li> </ul>"},{"location":"Vscode/#navegar-entre-editores-ventanaspestanas","title":"NAVEGAR ENTRE EDITORES (VENTANAS/Pesta\u00f1as)**","text":""},{"location":"Vscode/#ir-al-editor-anterior-siguiente","title":"Ir al editor anterior / siguiente","text":"<ul> <li><code>Ctrl + Tab</code></li> </ul>"},{"location":"Vscode/#cerrar-pestana-actual","title":"Cerrar pesta\u00f1a actual","text":"<ul> <li><code>Ctrl + W</code></li> </ul>"},{"location":"practica4_php/","title":"Pr\u00e1ctica 4: PHP (Continuaci\u00f3n de lo anterior)","text":"<p>Esta pr\u00e1ctica contin\u00faa con el aprendizaje de PHP centr\u00e1ndose en peque\u00f1os detalle intermedias necesarios para el desarrollo web que veremos, en especial en el punto 8 veremos como trabajar sobre los disntitos datos que envia el cliente. Al igual que en la pr\u00e1ctica anterior, cada bloque incluye explicaci\u00f3n, ejemplos y pr\u00e1ctica que deber\u00e1s resolver.</p> <p>Ojo, para resolver esta pr\u00e1ctica debes haber resuelto la anterior porque hay conceptos previos que debes saber, por ejemplo, en el apartado 1, deber\u00e1s saber c\u00f3mo recorrer un array asociativo...</p>"},{"location":"practica4_php/#1-valores-truthy-y-falsy-importantisimo","title":"1. Valores truthy y falsy (important\u00edsimo)","text":"<p>En PHP, ciertos valores se consideran falsos incluso si no son literalmente <code>false</code>. Esto tiene que ver mucho con los dos tipos de comparaciones que tenemos: <code>==</code>y <code>===</code>.</p> <p>Esto es muy importante al usar condicionales y seguro que en alg\u00fan punto os trae problemas si no lo hac\u00e9is correctamente. El siguiente c\u00f3digo muestra para cada uno de los elementos del array si son truly o falsy.</p> <p><pre><code>&lt;?php\n$valores = [0, 0.0, \"\", \"0\", null, false, [], [1], \"hola\"];\nforeach ($valores as $v) {\n    if ($v) { //if($v==true)\n        echo var_export($v, true) . \" es TRUTHY&lt;br&gt;\"; //al poner true devuelve como un string. var_export es silimar a print_r($v, true), que de igual forma, con el true al final, devuelve un strning\n    } else {\n        echo var_export($v, true) . \" es FALSY&lt;br&gt;\";\n    }\n}\n</code></pre> Deb\u00e9is saber que, si ejecut\u00e1is el c\u00f3digo anterior:</p> <ul> <li>Falsy: <code>0</code>, <code>\"0\"</code>, <code>\"\"</code>, <code>[]</code>, <code>null</code>, <code>false</code> </li> <li>Truthy: cualquier otro valor.</li> </ul> <p>Veamos donde puede causar esto problemas en un c\u00f3digo, aunque primero vamos a repasar como afecta los truthy y falsy en operadores ternarios. En la pr\u00e1ctica anterior visteis como usar <code>??</code>:</p> <pre><code>&lt;?php\n$nombre = $_GET[\"nombre\"] ?? \"invitado\";\n</code></pre> <p>que significa:  usa valor si no es null ni est\u00e1 sin definir (variable no declarada todav\u00eda), si no usa el de la derecha. Pero muchas veces ver\u00e9is esto en otros c\u00f3digos.</p> <pre><code>&lt;?php\n$nombre = $_GET[\"nombre\"] ?: 'inivitado';\n$nombre = $_GET[\"nombre\"] ? \"trhuthy\": \"falsy\"\n</code></pre> <p>que significa algo completamente distinto:</p> <p>Si $GET[\"nombre\"] es truthy : <code>$_GET[\"nombre\"]</code> Si $GET[\"nombre\"] es falsy : <code>'inivitado</code></p> <p>Ahora, vamos a ver un ejemplo de c\u00f3digo que pone de manifiesto la importancia de manejar bien valores truthy y falsy:</p> <pre><code>&lt;?php\n$amigos = $_GET['numero_amigos'] ?? null; \n\nif ($amigos) {\n    echo \"El usuario est\u00e1 activo y tiene {$amigos} amigos\";\n} else {\n    echo \"El usuario NO tiene definido el n\u00famero de amigos\";\n}\n</code></pre> <p>Si imaginamos que el valor de <code>$_GET['numero_amigos']</code> es el string <code>\"0\"</code>, y en PHP <code>\"0\"</code> es falsy.  As\u00ed que para este valor, el c\u00f3digo entra en el else aunque el par\u00e1metro est\u00e1 \"presente\", es decir, valga \"0\". En general, ten\u00e9is que tener mucho cuidado con la forma de comparar, lo anterior en la parte del if es equivalente a usar:</p> <pre><code>&lt;?php\nif ($amigos==true)\n</code></pre> <p>Por lo visto anteriormente \"0\" es un valor falsy en php, es decir:<code>\"0\"==false</code> pero <code>\"0\"===false</code>no es cierto. De hecho se puede ver con este bloque de c\u00f3digo:</p> <pre><code>&lt;?php\nvar_dump(\"0\" == false);   // bool(true). Comparaci\u00f3n laxa (convierte tipos)\nvar_dump(\"0\" === false);  // bool(false). Comparaci\u00f3n estricta\n</code></pre>"},{"location":"practica4_php/#practica-truthy_falsyphp","title":"Pr\u00e1ctica (truthy_falsy.php)","text":"<p>Crea <code>truthy_falsy.php</code> . Este script recorre todas las claves del array asocitativo <code>$_GET</code> (mirar el punto de los bucles de la pr\u00e1ctica anterior para saber como recorrer un array asociativo) y printea si sus valores son trulys o falsys (con los operadores ternarios <code>?</code>o <code>??</code>seg\u00fan te convenga y sin usar if), para ello, prueba a hacer la petici\u00f3n con los siguiente queryparams: </p> <pre><code>&lt;?php\n[\"sin_animo_de_lucro\",\"\", \"0\", \"hola\", \" \", \"i_love_iaw\"]\n</code></pre>"},{"location":"practica4_php/#2-bucle-dowhile-uso-debreak-continue","title":"2. Bucle: <code>do...while</code>, Uso de:<code>break</code>, <code>continue</code>","text":"<p>PHP ofrece un bucle que no vimos en la pr\u00e1ctica pasada, el <code>do while</code>, adem\u00e1s, los bucles poseen las cla\u00fasulas <code>break</code> y <code>continue</code>.</p> <p><pre><code>&lt;?php\n$j = 1;\ndo {\n  echo \"do...while: $j&lt;br&gt;\";\n  $j++;\n} while ($j &lt;= 3);\n\n$frutas = [\"manzana\", \"pera\", \"uva\", \"pl\u00e1tano\"];\nforeach ($frutas as $f) {\n  if ($f === \"pera\") continue; // salta\n  if ($f === \"uva\") break;    // rompe\n  echo \"Fruta: $f&lt;br&gt;\";\n}\n</code></pre> <code>continue</code> salta a la siguiente iteraci\u00f3n, <code>break</code> rompe el bucle.</p>"},{"location":"practica4_php/#practica-otros_buclesphp","title":"Pr\u00e1ctica (otros_bucles.php)","text":"<ol> <li>Crea un script que imprima los n\u00fameros del 1 hasta infinito, pero salte los m\u00faltiplos de 3 y termine al llegar a 8.  </li> <li>Hazlo con un do while con la condici\u00f3n true en el while, usa un break cundo el n\u00famero valga 8 y un continue cuando sea divisible entre 3, recuerda que el resto de n\u00fameros debe imprimirlos.</li> <li>Despu\u00e9s, haz lo mismo con un bucle for con un break cuando llegue a 8 y un continue cuando sea divisible entre 3, recuerda que el resto de n\u00fameros debe imprimirlos.</li> </ol>"},{"location":"practica4_php/#3-funciones-nombradas-anonimas-flecha-uso-de-callbacks-en-funciones-de-orden-superior-como-array_filter-array_map-y-array_reduce-nuevo","title":"3. Funciones nombradas, an\u00f3nimas, flecha. Uso de callbacks en funciones de orden superior como: array_filter, array_map y array_reduce (nuevo!!)","text":"<p>Antes de explicar este punto, que puede ser un poco confuso, me gustar\u00eda comentar algunas cosas potencialmente importante de array_filter:</p> <p>PHP no distingue entre \u201carrays normales\u201d y \u201casociativos\u201d como otros lenguajes (por ejemplo, JavaScript o Python). Internamente, todo array es un mapa clave\u2013valor, es decir:</p> <pre><code>&lt;?php\n$nums = [10, 20, 30];\n</code></pre> <p>es en realidad:</p> <pre><code>&lt;?php\n$nums = [\n    0 =&gt; 10,\n    1 =&gt; 20,\n    2 =&gt; 30\n];\n</code></pre> <p>Esto puede suponer problemas a la hora de realziar un array filter:</p> <pre><code>&lt;?php\n$nums = [-3, -2, -1, 0, 1, 2, 3, 4];\n\nfunction esPar($n) {\n    return $n % 2 === 0;\n}\n\n$soloPares = array_filter($nums, 'esPar');\n\nprint_r($soloPares);\n</code></pre> <p>cuya salida es:</p> <pre><code>&lt;?php\nArray\n(\n    [1] =&gt; -2\n    [3] =&gt; 0\n    [5] =&gt; 2\n    [7] =&gt; 4\n)\n</code></pre> <p>Si quisieramos tener los indices normales de un array, es decir, empezando en 0, deber\u00edamos hacer lo siguiente:</p> <pre><code>&lt;?php\n$soloPares = array_values(array_filter($nums, 'esPar'));\nprint_r($soloPares)\n</code></pre> <p>si guardas los valores, por defecto se indexar\u00e1 en 0.</p> <pre><code>Array\n(\n    [0] =&gt; -2\n    [1] =&gt; 0\n    [2] =&gt; 2\n    [3] =&gt; 4\n)\n</code></pre> <p>Dicho esto sobre array_filter, vamos a ver la diferencia entre funciones nombradas, an\u00f3nimas, flecha y el uso de callbacks. empezamos por los tipos de funciones que tenemos:</p> <pre><code>&lt;?php\n\n//------------1) TIPOS DE FUNCIONES: nombradas o definidas, an\u00f3nimas y flecha------------\n// Funci\u00f3n definida (con nombre)\nfunction esPar2(int $n): bool {\n    return $n % 2 === 0;\n}\n\nfunction duplicar(int $n): int {\n    return $n * 2;\n}\n\n// Funci\u00f3n an\u00f3nima (closure), almacenada en variable, para poder ser usada m\u00e1s tarde\n$esPositivo = function (int $n): bool {\n    return $n &gt; 0;\n};\n\n// Funci\u00f3n flecha (arrow function), tambi\u00e9n la guardamos en variable para poder ser usada m\u00e1s tarde\n$triplicar = fn ($n) =&gt; $n * 3;\n\n//Definimos un array para utilizarlo\n$nums = [-2, -1, 0, 1, 2, 3, 4];\n</code></pre> <p>Uso de array_filter con los tres tipos de funciones pasadas como \"callbacks\"</p> <pre><code>&lt;?php\n//2) vamos a ver como usar array_filter con los tres tipos de funciones definidad\n\n// a) Con funci\u00f3n definida (named)\n$soloPares = array_values(array_filter($nums, 'esPar')); // ['-2','0','2','4'] pero manteniendo claves originales\n\n// b) Con funci\u00f3n an\u00f3nima\n$soloPositivos = array_values(array_filter($nums, function (int $n): bool {\n    return $n &gt; 0;\n})); // [1,2,3,4]\n\n// c) Con funci\u00f3n f$soloPares = array_values(array_filter($nums, 'esPar2')); // ['-2','0','2','4'] pero manteniendo claves originales\necho \"&lt;br&gt;\";\nprint_r($soloPares);\n\n// b) Con funci\u00f3n an\u00f3nima\n$soloPositivos = array_values(array_filter($nums, $esPositivo)); // [1,2,3,4]\necho \"&lt;br&gt;\";\nprint_r($soloPositivos);\n\n// c) Con funci\u00f3n flecha (p.ej. mayores que 1)\n$mayoresQueUno = array_values(array_filter($nums, fn (int $n): bool =&gt; $n &gt; 1)); // [2,3,4]\necho \"&lt;br&gt;\";\nprint_r($mayoresQueUno);\nlecha (p.ej. mayores que 1)\n$mayoresQueUno = array_values(array_filter($nums, fn (int $n): bool =&gt; $n &gt; 1)); // [2,3,4]\n</code></pre> <p>Uso de array_map con los tres tipos de funciones pasadas como \"callbacks\"</p> <pre><code>&lt;?php\n//3) vamos a ver como usar array_map con los tres tipos\n\n// a) Con funci\u00f3n definida\n$duplicados = array_map('duplicar', $nums); // [-4,-2,0,2,4,6,8]\necho \"&lt;br&gt;\";\nprint_r($duplicados);\n\n// b) Con funci\u00f3n an\u00f3nima\n$alCuadrado = array_map(function (int $n): int {\n    return $n * $n;\n}, $nums); // [4,1,0,1,4,9,16]\necho \"&lt;br&gt;\";\nprint_r($alCuadrado);\n\n// c) Con funci\u00f3n flecha\n$triplicados = array_map($triplicar, $nums); // [-6,-3,0,3,6,9,12]\necho \"&lt;br&gt;\";\nprint_r($triplicados);\n</code></pre> <p>Uso de array_reduce con los tres tipos de funciones pasadas como \"callbacks\"</p> <pre><code>&lt;?php\n//3) vamos a ver como usar array_reduce con los tres tipos\n\n$nums = [-2, -1, 0, 1, 2, 3, 4];\n\n// a) Con funci\u00f3n definida\nfunction sumarSiPar(int $acc, int $n): int {\n    return esPar($n) ? $acc + $n : $acc; //ojo, debe ser truly para que acumule!!\n}\necho \"&lt;br&gt;\";\n$sumaDePares1 = array_reduce($nums, 'sumarSiPar', 0); //El \u00faltimo par\u00e1metro es el alcumulador e indica por donde comenzamos\necho \"Suma de pares (funci\u00f3n nombrada): {$sumaDePares1}\\n\"; // 4\n\n// b) Con funci\u00f3n an\u00f3nima (tipada en este caso)\n$sumaDePares2 = array_reduce($nums, function (int $acc, int $n): int {\n    return ($n % 2 === 0) ? $acc + $n : $acc;\n}, 0);\necho \"&lt;br&gt;\";\necho \"Suma de pares (funci\u00f3n an\u00f3nima): {$sumaDePares2}\\n\"; // 4\n\n// c) array_reduce con callback (acumulador)\n$sumaDePares3 = array_reduce(\n    $nums,\n    fn(int $acc, int $n): int =&gt; ($n % 2 === 0) ? $acc + $n : $acc,\n    0\n);\necho \"&lt;br&gt;\";\necho \"Suma de pares (arrow function): {$sumaDePares3}\\n\";\n</code></pre> <p>Ojo: tanto <code>array_map()</code> como <code>array_filter()</code> funcionan perfectamente con arrays asociativos,  pero por defecto usan solo los valores, ignorando las claves (a menos que se indique lo contrario).</p> <pre><code>&lt;?php\n$precios = [\"pan\" =&gt; 1, \"leche\" =&gt; 2, \"queso\" =&gt; 3];\n\n$iva = array_map(fn($p) =&gt; $p * 1.21, $precios);\necho \"&lt;br&gt;\";\nprint_r($iva);\n/**\n    Array\n(\n    [0] =&gt; 1.21\n    [1] =&gt; 2.42\n    [2] =&gt; 3.63\n)\n    */\n</code></pre> <p>Para mantenerlas, habr\u00eda que utilizar <code>array_combine</code></p> <pre><code>&lt;?php\n$iva2 = array_combine(array_keys($precios), $iva);\necho \"&lt;br&gt;\";\nprint_r($iva2);\n/**\n    Array\n(\n    [pan] =&gt; 1.21\n    [leche] =&gt; 2.42\n    [queso] =&gt; 3.63\n)\n    */\n</code></pre>"},{"location":"practica4_php/#practica-mis_callbacksphp","title":"Pr\u00e1ctica (mis_callbacks.php)","text":"<pre><code>&lt;?php\n$nums = [-5, -2, -1, 0, 1, 2, 3, 4, 5];\n</code></pre> <p>Dado el array anterior:</p> <ul> <li>Usa <code>array_filter</code> para quedarte solo con los n\u00fameros positivos e impares y reindixa</li> <li>Usa <code>array_map</code> para elevarlos al cuadrado</li> <li>Usa <code>array_reduce</code> para obtener la suma total de esos cuadrados.</li> <li>Muestra cada resultado (<code>print_r</code> o <code>echo</code> seg\u00fan el caso).</li> </ul> <p>El array_filter lo har\u00e1s con una funci\u00f3n an\u00f3nima, el array_map con una funcion nombrada definida previamente y el array_reduce con una funci\u00f3n flecha.</p>"},{"location":"practica4_php/#4-metodos-utiles-para-arrays-desectructuracion-de-arrays-tanto-normales-como-asocitativos","title":"4. M\u00e9todos \u00fatiles para Arrays. Desectructuraci\u00f3n de Arrays (tanto normales como asocitativos)","text":"<p>Adem\u00e1s de <code>array_map</code> y <code>array_filter</code>, vistos en la pr\u00e1ctica y en el punto anterior existen funciones muy pr\u00e1cticas para el manejo de arrays. Adem\u00e1s, veremos el concepto de \"desectructurar un array\", important\u00edsimo.</p> <p><pre><code>&lt;?php\n//------ordenar arrays------------------\n$nums = [5, 2, 9, 1];\necho \"&lt;br&gt;\";\nprint_r($nums);\nsort($nums); // ordena ascendente\necho \"&lt;br&gt;\";\nprint_r($nums);\nrsort($nums); // descendente\necho \"&lt;br&gt;\";\nprint_r($nums);\n\n//----haciendo slices--------------------\n\n$parte = array_slice($nums, 1, 3, true); //cogemos tres elementos a partir del indicie 1 incluyendolo\necho \"&lt;br&gt;\";\nprint_r($parte);\n\n\n$parte = array_slice($nums, 3, true); //cogemos todos los elementos a partir del \u00edndice 3\necho \"&lt;br&gt;\";\nprint_r($parte);\n\n\n/*\nArray\n(\n    [1] =&gt; 20\n    [2] =&gt; 30\n    [3] =&gt; 40\n)\n\n*/\n\n\n$nums = [10, 20, 30, 40, 50];\n$ultimos = array_slice($nums, -2); // \u00faltimos 2 elementos\necho \"&lt;br&gt;\";\nprint_r($ultimos);\n/*\nArray\n(\n    [0] =&gt; 40\n    [1] =&gt; 50\n)\n*/\n\n$ultimo = end($nums); // devuelve 50\necho \"&lt;br&gt;\";\necho $ultimo;\n\n\n//----mergear arrays-----------------------------\n$mix = [1, 2, 3];\n$otros = [\"a\", \"b\"];\n$combinado = array_merge($mix, $otros); // une arrays\necho \"&lt;br&gt;\";\nprint_r($combinado);\n\n\n//------destructuraci\u00f3n, defino tres variables de forma rapid\u00edsima\n$valores = [\"x\", \"y\", \"z\"];\nlist($a, $b, $c) = $valores; \necho \"&lt;br&gt;\";\necho $a; // x\n\n//-----------------Buscar y verificar en arrays\n$colores = [\"rojo\", \"verde\", \"azul\"];\nif (in_array(\"verde\", $colores)) echo \"Verde est\u00e1\";\necho \"&lt;br&gt;\";\necho array_search(\"azul\", $colores); // devuelve \u00edndice. Solo devuelve la primera clave\n</code></pre> Para arrays-asociativos:</p> <pre><code>&lt;?php\n//--------------------slices\n$animales = [\n    \"a\" =&gt; \"perro\",\n    \"b\" =&gt; \"gato\",\n    \"c\" =&gt; \"pez\",\n    \"d\" =&gt; \"loro\"\n];\n\n$trozo = array_slice($animales, 1, 2, true);\necho \"&lt;br&gt;\";\nprint_r($trozo);\n/*\nArray de salida\n(\n    [b] =&gt; gato\n    [c] =&gt; pez\n)\n*/\n\n$ultimo = end($animales);\necho \"&lt;br&gt;\";\necho $ultimo; // loro\n\n$ultimos = array_slice($animales, -2, null, true);\necho \"&lt;br&gt;\";\nprint_r($ultimos);\n/*\nArray de salida\n(\n    [c] =&gt; pez\n    [d] =&gt; loro\n)\n*/\n</code></pre> <p>Tambi\u00e9n ordenamos</p> <pre><code>&lt;?php\n$personas = [\"juan\" =&gt; 30, \"ana\" =&gt; 25, \"pedro\" =&gt; 35];\nsort($personas); // pierde las claves\necho \"&lt;br&gt;\";\nprint_r($personas);\n</code></pre> <p>resultado</p> <pre><code>Array\n(\n    [0] =&gt; 25\n    [1] =&gt; 30\n    [2] =&gt; 35\n)\n</code></pre> <p>El merge funciona sin problemas tambi\u00e9n para arrays asociativos</p> <pre><code>&lt;?php\n$personas = [\"juan\" =&gt; 30, \"ana\" =&gt; 25, \"pedro\" =&gt; 35];\nsort($personas); // pierde las claves\necho \"&lt;br&gt;\";\nprint_r($personas);\n\n\n$a = [\"x\" =&gt; 1, \"y\" =&gt; 2];\n$b = [\"z\" =&gt; 3];\necho \"&lt;br&gt;\";\nprint_r(array_merge($a, $b));\n\n/*\n\nArray\n(\n    [x] =&gt; 1\n    [y] =&gt; 2\n    [z] =&gt; 3\n)\n*/\n</code></pre> <p>desectructuraci\u00f3n de arrays_asocitavos:</p> <pre><code>&lt;?php\n$a = [\"x\" =&gt; 1, \"y\" =&gt; 2];\n$b = [\"z\" =&gt; 3];\necho \"&lt;br&gt;\";\nprint_r(array_merge($a, $b));\n</code></pre> <p>in_array y array_search funcionan igual tambi\u00e9n</p> <pre><code>&lt;?php\n$colores = [\"rojo\" =&gt; \"#f00\", \"verde\" =&gt; \"#0f0\"];\necho in_array(\"#0f0\", $colores);\necho array_search(\"#0f0\", $colores); \n</code></pre>"},{"location":"practica4_php/#practica-mas_metodos_arraysphp","title":"Pr\u00e1ctica (mas_metodos_arrays.php)","text":"<p>Crea un array con los n\u00fameros <code>[9, 1, 5, 2, 7]</code>.</p> <ul> <li>Ord\u00e9nalos en orden ascendente.</li> <li>Muestra el primer (menor) y el \u00faltimo (mayor) valor del array.</li> <li>Luego ord\u00e9nalos en descendente y muestra el nuevo orden.</li> </ul> <p>Crea dos arrays:</p> <ul> <li><code>$frutas = [\"manzana\", \"pera\", \"kiwi\"];</code></li> <li><code>$bebidas = [\"agua\", \"zumo\"];</code></li> <li>Comb\u00ednalos con <code>array_merge()</code> en un \u00fanico array llamado <code>$lista</code>,    y muestra su contenido con <code>print_r()</code>.</li> </ul> <p>Dado el array $colores = [\"rojo\", \"verde\", \"azul\"];</p> <ul> <li>Desestructura los tres valores en variables individuales <code>$a</code>, <code>$b</code>, <code>$c</code> usando <code>list()</code>,    y muestra una frase como: <code>Los colores primarios son rojo, verde y azul</code></li> </ul> <p>Crea el array: <code>$animales = [\"perro\", \"gato\", \"pez\", \"loro\"]</code></p> <ul> <li> <p>Verifica si <code>\"gato\"</code> est\u00e1 dentro del array con <code>in_array()</code>.</p> </li> <li> <p>Busca el \u00edndice o posici\u00f3n de <code>\"loro\"</code> con <code>array_search()</code>.</p> </li> </ul> <p>Crea el siguiente array asociativo con nombres y edades  <code>$personas = [     \"juan\" =&gt; 30,     \"ana\" =&gt; 25,     \"pedro\" =&gt; 35,     \"marta\" =&gt; 28 ];</code></p> <ul> <li>Muestra todas las personas y sus edades.</li> <li>Ordena el array por edad ascendente manteniendo las claves si usar la funci\u00f3n predefinida que no veremos <code>asort</code></li> <li>Muestra el \u00edndice del m\u00e1s joven y el m\u00e1s mayor. Te recomiendo buscar en el array de valores el n\u00famero m\u00e1s alto y despu\u00e9s buscar el indice. Ambo est\u00e1 hecho en ejemplos en esta pr\u00e1ctica.</li> <li>Verifica si existe la persona <code>\"ana\"</code> con en el array de keys.</li> </ul>"},{"location":"practica4_php/#5-metodos-importantes-para-strings","title":"5. M\u00e9todos importantes para Strings","text":"<p><pre><code>&lt;?php\n$texto = \"  Hola Mundo desde PHP  \";\necho strlen($texto); // longitud\necho \"&lt;br&gt;\";\necho strtolower($texto);\necho \"&lt;br&gt;\";\necho strtoupper($texto);\necho \"&lt;br&gt;\";\necho trim($texto); // elimina espacios\necho \"&lt;br&gt;\";\necho str_replace(\"PHP\", \"el servidor\", $texto);\necho \"&lt;br&gt;\";\necho strpos($texto, \"Mundo\"); // posici\u00f3n\necho \"&lt;br&gt;\";\necho substr($texto, 2, 4); // subcadena\necho \"&lt;br&gt;\";\n\n//Aceder yb recorrer strings\n$texto = \"Hola Mundo\";\n\necho $texto[0]; // H\necho \"&lt;br&gt;\";\necho $texto[1]; // o\necho \"&lt;br&gt;\";\necho $texto[5]; // M\necho \"&lt;br&gt;\";\n\n$texto = \"Hola\";\n\nfor ($i = 0; $i &lt; strlen($texto); $i++) {\n    echo \"&lt;br&gt;\";\n    echo $texto[$i] . \"\\n\";\n}\n\n$texto = \"Hola\";\n$texto[0] = \"M\";\necho \"&lt;br&gt;\";\necho $texto; // Mola\n</code></pre> Tambi\u00e9n puedes dividir y unir cadenas:</p> <pre><code>&lt;?php\n$frase = \"uno,dos,tres\";\n$partes = explode(\",\", $frase); // [\"uno\",\"dos\",\"tres\"]\necho implode(\" - \", $partes); // uno - dos - tres\n</code></pre>"},{"location":"practica4_php/#practica-metodos_stringsphp","title":"Pr\u00e1ctica (metodos_strings.php)","text":"<ol> <li>Crea <code>strings.php</code> y crea una funcion llamada prueba que sobre una cadena prueba e imprime todos los m\u00e9todos anteriores.  </li> <li>A\u00f1ade un <code>$_GET[\"texto\"]</code> despu\u00e9s de  y realiza: longitud, conversi\u00f3n a may\u00fasculas, y b\u00fasqueda de una palabra concreta (\"comida\"). Esto se har\u00e1 realizando un explode y un array_search normalizando cada elemento del array pasandolo a may\u00fasculas y haciendole un trim.</li> </ol>"},{"location":"practica4_php/#6-manejo-de-errores-try-catch-finally","title":"6. Manejo de errores: <code>try</code>, <code>catch</code>, <code>finally</code>","text":"<p>Esto es fundamental de muchos lenguajes y permite manejar excepciones sin detener el script.</p> <p>Cuando el c\u00f3digo dentro de un bloque <code>try</code> puede generar un error, se encierra dentro el codigo dentro de <code>try { ... }</code>.  Si dentro de ese bloque ocurre una excepci\u00f3n, PHP interrumpe la ejecuci\u00f3n normal del <code>try</code> y salta directamente al bloque <code>catch</code>, donde se puede capturar y manejar ese error de manera segura.El bloque <code>finally</code> se ejecuta siempre, ocurra o no una excepci\u00f3n.</p> <p>Tambi\u00e9n vemos como: throw new Exception(\"No se puede dividir entre 0\");  que significa que el programa est\u00e1 generando (lanzando) una excepci\u00f3n de forma intencional cuando ocurre una situaci\u00f3n que consideramos un error, en este caso intentar dividir entre cero.</p> <pre><code>&lt;?php\ntry {\n    $divisor = $_GET[\"divisor\"] ?? 0;\n    if ($divisor == 0) throw new Exception(\"No se puede dividir entre 0\");\n    echo 10 / $divisor;\n} catch (Exception $e) {\n    echo \"Error: \" . $e-&gt;getMessage(); //ojo e-&gt;getMessage() es la ejecuci\u00f3n de un objeto.\n} finally {\n    echo \"&lt;br&gt;Bloque finally ejecutado siempre.\";\n}\n</code></pre>"},{"location":"practica4_php/#practica-mi_ipphp","title":"Pr\u00e1ctica (mi_ip.php)","text":"<p>Crea una funcion en PHP que:</p> <ol> <li>Reciba un par\u00e1metro <code>ip</code> por la URL (<code>?ip=192.168.1.10</code>).</li> <li>Separe la IP en 4 bloques usando <code>explode(\".\")</code>.</li> <li>Verifique que haya exactamente 4 partes.</li> <li>Compruebe que cada bloque sea num\u00e9rico (utiliza is_digit) y est\u00e9 entre 0 y 255.</li> <li>Si falla alguna validaci\u00f3n, lance <code>throw new Exception(\"mensaje de error\")</code> y recoja la excepci\u00f3n con un catch y dejando claro que la ip, no es correcta.</li> <li>En conclusi\u00f3n, usa: <code>try</code>, <code>catch</code> y <code>finally</code> para que el script no se detenga nunca.</li> </ol>"},{"location":"practica4_php/#atencion-exception-vs-error-y-uso-de-throwable","title":"Atenci\u00f3n: Exception vs Error y uso de Throwable.","text":"<p>Fij\u00e9monos el en siguiete c\u00f3digo:</p> <pre><code>&lt;?php\ntry {\n $divisor = $_GET[\"divisor\"] ?? 0;\n\n if ($divisor == 0) {\n     throw new Exception(\"No se puede dividir entre 0\");\n }\n\n $resultado = 10 + [\"esto genera un error\"];\n echo 10 / $divisor;\n\n} catch (Exception $e) {\n echo \"Excepci\u00f3n: \" . $e-&gt;getMessage();\n\n} catch (Error $e) {\n echo \"Error del motor PHP: \" . $e-&gt;getMessage();\n\n}\n\nfinally {\n echo \"&lt;br&gt;Bloque finally ejecutado siempre.\";\n}\n?&gt;\n</code></pre> <p>En PHP, una Exception representa errores controlables dentro de la l\u00f3gica de la aplicaci\u00f3n: condiciones que t\u00fa esperas y decides manejar, como validar datos o evitar divisiones por cero. En cambio, un Error representa fallos del motor de PHP, cosas que no se pueden hacer a nivel de lenguaje, como sumar un n\u00famero con un array o llamar a una funci\u00f3n inexistente. Las excepciones las lanzas t\u00fa para controlar el flujo; los errores los genera PHP cuando detecta algo imposible o inv\u00e1lido en tiempo de ejecuci\u00f3n.</p>"},{"location":"practica4_php/#7-parametros-de-ruta-continuacion-de-query-params-peticiones-desde-clientes-html-y-fetch-con-javascript-inline","title":"7. Par\u00e1metros de ruta (continuaci\u00f3n de Query Params). Peticiones desde clientes HTML y fetch con JavaScript (inline)","text":"<p>Lo que vas a ver la forma b\u00e1sica y manual de manejar rutas en PHP usando Apache, sin frameworks.</p> <p>Hasta ahora usamos query params (<code>?nombre=Juan</code>). Tambi\u00e9n podemos pasar par\u00e1metros en la ruta, por ejemplo: <code>http://localhost/usuario/juan</code></p> <p>Para que esto funcione, el servidor (Apache) debe tener habilitado <code>mod_rewrite</code> y un archivo <code>.htaccess</code> que redirija todas las peticiones al archivo principal (<code>index.php</code> ) tal y como hicimos en la pr\u00e1ctica 2.</p> <pre><code>&lt;?php\n// index.php\n$path = $_SERVER[\"REQUEST_URI\"]; //url solicitada\n$partes = explode(\"/\", trim($path, \"/\")); // [\"usuario\", \"ana\"] pensadlo, ambas funciones vistas antes\n$ultimo = end($partes); // \"ana\"\n\n$metodo = $_SERVER[\"REQUEST_METHOD\"]; // GET, POST, PUT, DELETE...\n\necho \"&lt;h2&gt;Ruta accedida: \" . htmlspecialchars($path) . \"&lt;/h2&gt;\";\necho \"&lt;p&gt;\u00daltimo segmento: &lt;strong&gt;\" . htmlspecialchars($ultimo) . \"&lt;/strong&gt;&lt;/p&gt;\";\necho \"&lt;p&gt;M\u00e9todo HTTP: &lt;strong&gt;$metodo&lt;/strong&gt;&lt;/p&gt;\";\n\n// Ejemplo interesante: comportamiento distinto seg\u00fan m\u00e9todo que se pida\nif ($metodo === \"GET\") {\n    echo \"&lt;p&gt;Mostrando informaci\u00f3n del usuario &lt;strong&gt;$ultimo&lt;/strong&gt;.&lt;/p&gt;\";\n} elseif ($metodo === \"POST\") {\n    echo \"&lt;p&gt;Creando un nuevo recurso llamado &lt;strong&gt;$ultimo&lt;/strong&gt;.&lt;/p&gt;\";\n} else {\n    echo \"&lt;p&gt;M\u00e9todo no manejado.&lt;/p&gt;\";\n}\n?&gt;\n</code></pre>"},{"location":"practica4_php/#practica-indexphp","title":"Pr\u00e1ctica (index.php)","text":"<p>Ejecuta el c\u00f3digo anterior con GET POST PUT y DELETE mediante postman y haz capturas de pantalla, prueba a enviar informaci\u00f3n a ver si la recibe correctamente. Importa que env\u00edes informaci\u00f3n o da igual la info que env\u00edes (por ejemplo en un post) .</p> <p>Despu\u00e9s de hacer las peticiones con postman, elabora un formulario llamdo \"formulario.html\" que mediante 4 formularios html's (dentro de formulario.html) haga las peticiones al script anterior con GET POST PUT Y DELETE, (resuelto en el siguiente script.) Qu\u00e9 problema encuentras con PUT Y DELETE? (Pues que no deja como action en el HTML)</p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n    &lt;title&gt;Document&lt;/title&gt;\n\n    &lt;style&gt;\n        body {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n\n        .contenedor {\n            display: flex;\n            flex-direction: column;\n        }\n\n        .carta {\n            height: 13rem;\n            border: 1px solid rgb(1, 1, 1);\n            text-align: center;\n            margin-top: 1rem;\n            border-radius: 1rem;\n            padding: 1rem;\n            background-color: rgb(222, 255, 252);\n            transition: height 0.5s ease-in-out;\n            overflow: hidden;\n        }\n\n        form {\n            display: flex;\n            flex-direction: column;\n\n        }\n        input {\n            margin: 0px auto;\n            margin-top: 0.5rem;\n            max-width: 10rem;\n\n        }\n        button {\n            margin: 0px auto;\n            margin-top: 0.5rem;\n        }\n    &lt;/style&gt;\n\n    &lt;script&gt;\n        async function fetch_put() {\n            let carta= document.getElementById(\"carta_put\")\n            let div_put = document.getElementById(\"resultado_put\")\n            let boton_put = document.getElementById(\"button_put\")\n            if (div_put.innerHTML != \"\") {\n                div_put.innerHTML = \"\"\n                boton_put.innerHTML = \"Enviar PUT\"\n                carta.style.height= \"15rem\"\n            }\n            else {\n                let put_value = document.getElementById(\"put-msg\").value\n                try {\n                    const response = await fetch(\"usuario/ana\", {\n                        method: \"PUT\",\n                        headers: { \"Content-Type\": \"application/json\" },\n                        body: JSON.stringify({ \"mensaje\": put_value })\n                    })\n                    const respuesta_text = await response.text()\n                    div_put.innerHTML=respuesta_text\n                    boton_put.innerHTML = \"Borrar salida PUT\"\n                    carta.style.height= carta.scrollHeight + \"px\"   \n                }\n\n                catch (error) {\n                    div_put.innerHTML=error\n                    boton_put.innerHTML = \"Borrar salida PUT\"\n                }\n            }\n        }\n\n\n        async function fetch_delete() {\n            let carta= document.getElementById(\"carta_delete\")\n            let div_delete = document.getElementById(\"resultado_delete\")\n            let boton_delete = document.getElementById(\"button_delete\")\n            if (div_delete.innerHTML != \"\") {\n                div_delete.innerHTML = \"\"\n                boton_delete.innerHTML = \"Enviar DELETE\"\n                carta.style.height= \"15rem\"\n            }\n            else {\n                let delete_value = document.getElementById(\"delete-msg\").value\n                try {\n                    const response = await fetch(\"usuario/ana\", {\n                        method: \"DELETE\",\n                        headers: { \"Content-Type\": \"application/json\" },\n                        body: JSON.stringify({ \"mensaje\": delete_value })\n                    })\n                    const respuesta_text = await response.text()\n                    div_delete.innerHTML=respuesta_text\n                    boton_delete.innerHTML = \"Borrar salida DELETE\"\n                    carta.style.height= carta.scrollHeight + \"px\"  \n                }\n                catch (error) {\n                    div_delete.innerHTML=error\n                    boton_delete.innerHTML = \"Borrar salida PUT\"\n                }\n            }\n        }\n\n    &lt;/script&gt;\n\n&lt;/head&gt;\n\n&lt;body&gt;\n    &lt;div class=\"contenedor\"&gt;\n\n        &lt;div class=\"carta\"&gt;\n            &lt;form action=\"/usuario/ana\" method=\"GET\"&gt;\n                &lt;h2&gt;Esto ser\u00eda un GET&lt;/h2&gt;\n                &lt;input type=\"text\" name=\"mensaje\" placeholder=\"Pon tus datos\"&gt;\n                &lt;button type=\"submit\"&gt;Enviar&lt;/button&gt;\n            &lt;/form&gt;\n        &lt;/div&gt;\n\n        &lt;div class=\"carta\"&gt;\n            &lt;form action=\"ejemplo_post.php\" method=\"POST\" enctype=\"multipart/form-data\"&gt;\n                &lt;h2&gt;Esto ser\u00eda un POST&lt;/h2&gt;\n                &lt;input type=\"text\" name=\"usuario\" placeholder=\"Pon tus datos\"&gt;\n                &lt;input type=\"text\" name=\"clave\" placeholder=\"Pon tus datos\"&gt;\n                &lt;input type=\"file\" name=\"foto\"&gt;\n                &lt;button type=\"submit\"&gt;Enviar &lt;/button&gt;\n            &lt;/form&gt;\n        &lt;/div&gt;\n\n        &lt;div class=\"carta\" id=\"carta_put\"&gt;\n            &lt;form&gt;\n                &lt;h2&gt;Esto ser\u00eda un PUT&lt;/h2&gt;\n                &lt;input id=\"put-msg\" type=\"text\" placeholder=\"Pon tus datos\"&gt;\n                &lt;button id=\"button_put\" type=\"button\" onclick=\"fetch_put()\"&gt;Enviar PUT &lt;/button&gt;\n            &lt;/form&gt;\n            &lt;div id=\"resultado_put\"&gt;&lt;/div&gt;\n        &lt;/div&gt;\n\n        &lt;div class=\"carta\" id=\"carta_delete\"&gt;\n            &lt;form&gt;\n                &lt;h2&gt;Esto ser\u00eda un DELETE&lt;/h2&gt;\n                &lt;input id=\"delete-msg\" type=\"text\" placeholder=\"Pon tus datos\"&gt;\n                &lt;button id=\"button_delete\" type=\"button\" onclick=\"fetch_delete()\"&gt;Enviar DELETE &lt;/button&gt;\n            &lt;/form&gt;\n            &lt;div id=\"resultado_delete\"&gt;&lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>"},{"location":"practica4_php/#8-preparar-una-ruta-para-recoger-informacion-que-envia-el-cliente-manejar-el-content-type-para-recoger-los-datos-que-envia-el-cliente-opcional","title":"8. Preparar una ruta para recoger informaci\u00f3n que env\u00eda el cliente. Manejar el Content-Type para recoger los datos que env\u00eda el cliente. (Opcional)","text":"<p>Una vez hemos visto los conceptos m\u00e1s b\u00e1sicos de php, lo que vemos ahora es c\u00f3mo configurar el servidor para poder recibir distintos tipos de datos.</p>"},{"location":"practica4_php/#81-recoger-contenido-de-un-form-data-x-www-form-urlencoded-o-multipartform-data-para-archivos","title":"8.1 Recoger contenido de un Form Data (x-www-form-urlencoded o multipart/form-data para archivos)","text":"<p>Cuando los datos se env\u00edan mediante un formulario HTML tradicional, se usan los tipos de contenido <code>application/x-www-form-urlencoded</code> o <code>multipart/form-data</code> (si se incluyen archivos). Por ejemplo, un formulario podr\u00eda ser:</p> <pre><code>&lt;form method=\"POST\" action=\"api.php\"&gt;\n  &lt;input name=\"usuario\" value=\"pepe\"&gt;\n  &lt;input name=\"clave\" value=\"1234\"&gt;\n  &lt;button type=\"submit\"&gt;Enviar&lt;/button&gt;\n&lt;/form&gt;\n</code></pre> <p>En el servidor PHP, en el <code>script api.php</code>se pueden leer los datos de la siguiente forma:</p> <pre><code>$usuario = $_POST['usuario'];\n$clave = $_POST['clave'];\necho \"usuario $usuario con clave $clave logueado correctamente\" //simulo que hago un loggin con los datos, como todav\u00eda no tenemos bases de datos no tiene mucho sentido, pero ya sabemos como recoger la info que env\u00eda el cliente.\n</code></pre> <p>Cuando el formulario HTML del cliente se env\u00eda con una foto (ejemplo siguiente), PHP crea autom\u00e1ticamente un arreglo especial llamado <code>$_FILES</code> con la informaci\u00f3n del archivo. Por ejemplo, imagina que el cliente env\u00eda lo siguiente:</p> <pre><code>&lt;form method=\"POST\" action=\"api.php\" enctype=\"multipart/form-data\"&gt;\n  &lt;input type=\"text\" name=\"usuario\" value=\"pepe\"&gt;\n  &lt;input type=\"file\" name=\"foto\"&gt;\n  &lt;button type=\"submit\"&gt;Subir archivo&lt;/button&gt;\n&lt;/form&gt;\n</code></pre> <p>Si en el servidor (script <code>subir.php</code> en este caso) ejecutas lo siguiente</p> <pre><code>&lt;?php\nprint_r($_POST);\nprint_r($_FILES);\n</code></pre> <p>Ver\u00e1s algo as\u00ed:</p> <pre><code>Array\n(\n    [usuario] =&gt; pepe\n)\nArray\n(\n    [foto] =&gt; Array\n        (\n            [name] =&gt; selfie.jpg\n            [type] =&gt; image/jpeg\n            [tmp_name] =&gt; /tmp/php8F3.tmp\n            [error] =&gt; 0\n            [size] =&gt; 123456\n        )\n)\n</code></pre> <p>Donde <code>$_FILES</code> tambi\u00e9n es un array, pero contiene otro array dentro (porque puede haber varios archivos aunque aqu\u00ed s\u00f3lo hay 1). En este ejemplo, el campo del formulario html se llamaba <code>foto</code>, por eso aparece una secci\u00f3n <code>[foto]</code>. Dentro de esa secci\u00f3n hay otra lista con la informaci\u00f3n del archivo que se crea de forma predeterminada:</p> <ul> <li><code>name</code>: el nombre original del archivo (<code>selfie.jpg</code>)</li> <li><code>type</code>: el tipo de archivo (<code>image/jpeg</code>)</li> <li><code>tmp_name</code>: la ubicaci\u00f3n temporal donde PHP lo guarda autom\u00e1ticamente</li> <li><code>error</code>: c\u00f3digo de error (0 significa que no hubo error)</li> <li><code>size</code>: el tama\u00f1o en bytes (por ejemplo 123456)</li> </ul> <p>Podr\u00edamos guardar el archivo enviado en el html en una carpeta del servidor de la siguiente forma a\u00f1adiendo un poco m\u00e1s de c\u00f3digo al script <code>subir.php</code>.</p> <pre><code>&lt;?php\nprint_r($_POST);\nprint_r($_FILES);\n$archivo_temporal = $_FILES['foto']['tmp_name'];\n$nombre_final = 'uploads/' . $_FILES['foto']['name']; //ruta relativa luego carpeta uploads de var/www/html (ninguna seguridad y cualquier cliente puede acceder)\nmove_uploaded_file($archivo_temporal, $nombre_final);\n</code></pre>"},{"location":"practica4_php/#82-recoger-applicationjson-o-textraw","title":"8.2 Recoger application/json o text/raw","text":"<p>Cuando una aplicaci\u00f3n o un cliente env\u00eda datos en formato JSON , se usa el tipo de contenido <code>application/json</code>. Este tipo de env\u00edo es com\u00fan en APIs modernas o peticiones AJAX. Por ejemplo, desde JavaScript se puede enviar algo as\u00ed, tal y como hicimos en el punto 7.</p> <pre><code>fetch(\"api.php\", {\n  method: \"POST\",\n  headers: { \"Content-Type\": \"application/json\" },\n  body: JSON.stringify({ usuario: \"pepe\", clave: \"1234\" })\n});\n</code></pre> <p>En el servidor PHP no se usa <code>$_POST</code> en este caso, porque PHP no interpreta autom\u00e1ticamente el JSON. En su lugar, se debe leer el cuerpo crudo de la petici\u00f3n con <code>php://input</code> y luego decodificarlo con <code>json_decode</code>:</p> <pre><code>&lt;?php\n$raw = file_get_contents(\"php://input\");\n$data = json_decode($raw, true); #con true devuelve un array asociativo, ponedlo.\n$usuario = $data['usuario'];\n$clave = $data['clave'];\n</code></pre> <p>Si el usuario enviase text/raw, el contenido se recoger\u00eda as\u00ed:</p> <pre><code>&lt;?php\n$raw = file_get_contents(\"php://input\");\n</code></pre> <p>es decir, no har\u00eda falta decodificarlo a JSON (ya que se env\u00eda texto, nada m\u00e1s)</p>"},{"location":"practica4_php/#83-ejemplo-combinado-de-lo-anterior-emjemplo_final_practica4php","title":"8.3 Ejemplo combinado de lo anterior (emjemplo_final_practica4.php)","text":"<p>El siguiente c\u00f3digo estar\u00e1 tambi\u00e9n en index.php ya que est\u00e1 elaborado para detectar incluso rutas que no existen. Este script presenta muchas formas de trabajar con las peticiones que llegan por el body, ya sean GET por query-param, POST por formularios o JSON's, que env\u00eda el cliente, archivos que env\u00eda el cleinte o incluso texto plano.</p> <pre><code>&lt;?php\n// ------------------------------------------------------------\n// CONFIGURACI\u00d3N B\u00c1SICA\n// ------------------------------------------------------------\n\n// Siempre estableceremos la codificaci\u00f3n de salida ya que en este caso, enviaremos texto plano al cliente, para que el navegador sepa exactamente lo que se env\u00eda.\nheader(\"Content-Type: text/plain; charset=utf-8\");\n\n// ------------------------------------------------------------\n// VARIABLES DE ENTORNO DEL SERVIDOR\n// ------------------------------------------------------------\n$path = $_SERVER[\"REQUEST_URI\"];\n$metodo = $_SERVER[\"REQUEST_METHOD\"];\n$tipoContenido = $_SERVER[\"CONTENT_TYPE\"] ?? 'no especificado';\n\n// Variables para la respuesta que enviaremos en el texto de la respuesta\n$data = [];\n$resultado = \"\";\n\n// ------------------------------------------------------------\n// L\u00d3GICA PRINCIPAL DE PROCESAMIENTO\n// ------------------------------------------------------------\ntry {\n    if ($metodo === \"GET\") {\n        // ----------------- PETICI\u00d3N GET, recoger query-params -----------------\n        $data = $_GET;\n        $resultado = \"Datos recibidos por m\u00e9todo GET.\";\n\n    } elseif (in_array($metodo, [\"POST\", \"PUT\", \"DELETE\"])) {\n\n        // ----------------- recoger application/json del cliente -----------------\n        if (str_contains($tipoContenido, \"application/json\")) {\n            $raw = file_get_contents(\"php://input\");\n            $data = json_decode($raw, true);\n#Ojo aqui a las funcines json_last_error() yjson_last_error_msg(), muy importantes.\n            if (json_last_error() !== JSON_ERROR_NONE) {\n                throw new Exception(\"JSON inv\u00e1lido: \" . json_last_error_msg()); #Es una funci\u00f3n interna de  PHP que te dice si la \u00faltima llamada a json_decode() tuvo alg\u00fan error.\n            }\n\n            $resultado = \"Datos recibidos en formato JSON.\";\n        }\n\n        // ----------------- recoger application/x-www-form-urlencoded del cliente -----------------\n        elseif (str_contains($tipoContenido, \"application/x-www-form-urlencoded\")) {\n            $data = $_POST;\n            if (empty($data)){ #empty devuelve true si $data es falsy o no existe\n                throw new Exception(\"No se recibieron datos del formulario.\");\n            }\n            $resultado = \"Datos recibidos desde un formulario (x-www-form-urlencoded).\";\n        }\n\n        // ----------------- recoger multipart/form-data (con archivos) -----------------\n        elseif (str_contains($tipoContenido, \"multipart/form-data\")) {\n            $data = $_POST;\n\n            if (empty($_FILES)) {\n                throw new Exception(\"No se recibi\u00f3 ning\u00fan archivo.\");\n            }\n\n            foreach ($_FILES as $nombre =&gt; $archivo) {\n                if ($archivo['error'] !== 0) {\n                    throw new Exception(\"Error al subir'{$archivo['name']}'. C\u00f3digo: {$archivo['error']}\");\n                }\n\n                $destinoCarpeta = 'uploads/';\n                if (!is_dir($destinoCarpeta)) { //\u00bfque hace is_dir?\n                    throw new Exception(\" 'uploads/' no existe. Cr\u00e9ala con permisos de escritura.\");\n                }\n\n                $dest = $destinoCarpeta . basename($archivo['name']); //\u00bfque hace basename?\n\n                if (!move_uploaded_file($archivo['tmp_name'], $dest)) {\n                    throw new Exception(\"No se pudo mover el archivo a la carpeta de destino.\");\n                }\n\n                $data['archivo_subido'] = \"Archivo '{$archivo['name']}' guardado correctamente en '$dest'.\";\n            }\n\n            $resultado = \"Datos recibidos desde un formulario con archivo (multipart/form-data).\";\n        }\n\n        // ----------------- recoger text/plain del cliente -----------------\n        elseif (str_contains($tipoContenido, \"text/plain\")) {\n            $raw = file_get_contents(\"php://input\");\n            if (trim($raw) === \"\") {\n                throw new Exception(\"El cuerpo del texto est\u00e1 vac\u00edo.\");\n            }\n            $data[\"texto\"] = $raw;\n            $resultado = \"Texto plano recibido (text/plain).\";\n        }\n\n        // ----------------- Tipo desconocido -----------------\n        else {\n            throw new Exception(\"Formato de contenido no admitido: $tipoContenido\");\n        }\n    } else {\n        throw new Exception(\"M\u00e9todo HTTP no soportado por este ejemplo.\");\n    }\n\n} catch (Exception $e) {\n    $resultado = \"Error: \" . htmlspecialchars($e-&gt;getMessage());\n}\necho $resultado . \" \" . $data;\n</code></pre>"},{"location":"practica4_php/#practica-indexphp_1","title":"Pr\u00e1ctica (index.php)","text":"<p>Todav\u00eda no tienes que saber como programar esto, as\u00ed que ejecuta el c\u00f3digo anterior con GET POST PUT y DELETE mediante postman y haz capturas de pantalla, prueba a enviar informaci\u00f3n a ver si la recibe correctamente con los tres tipos de datos distintos: urlencoded, queryparams y fotos con form/data (crea la carpeta uploads en www/var/html con los permisos adecuados). </p>"}]}