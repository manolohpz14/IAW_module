
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../5-Pr%C3%A1ctica.%20Conexiones_bd/">
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Borrar y cambiar registros de la BD. Uso de cookies. Practica 6 - Módulo IAW</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practica-guiada-6-conexiones-a-bd" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Módulo IAW" class="md-header__button md-logo" aria-label="Módulo IAW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Módulo IAW
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Borrar y cambiar registros de la BD. Uso de cookies. Practica 6
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Módulo IAW" class="md-nav__button md-logo" aria-label="Módulo IAW" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Módulo IAW
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inicio
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tema 1. Introducción a HTTP
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tema 1. Introducción a HTTP
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Teoria%20CURL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Teoría CURL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Pr%C3%A1ctica%201/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CURL y POSTMAN. Practica 1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2%20Teor%C3%ADa-Pr%C3%A1ctica-Guiada/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduccion a APACHE e instalacion. Practica 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tema 2. Lenguajes de entorno sevidor PHP
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tema 2. Lenguajes de entorno sevidor PHP
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3%20primera_practica_PHP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sintaxis, ejecución y estructuras de datos. Práctica 3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../practica4_php/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Métodos avanzados. Peticiones fetch y HTML. Práctica 4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tema 3. Acceso a bases de datos desde lenguajes de entorno servidor. Uso de frameworks PHP
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tema 3. Acceso a bases de datos desde lenguajes de entorno servidor. Uso de frameworks PHP
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-Pr%C3%A1ctica.%20Conexiones_bd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Setters y Getters. Conexion a BBDD y manejo de peticiones en entorno servidor. Practica 5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Borrar y cambiar registros de la BD. Uso de cookies. Practica 6
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Borrar y cambiar registros de la BD. Uso de cookies. Practica 6
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#practica-guiada-6-conexiones-a-bd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Práctica Guiada 6. Conexiones a BD
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-html-de-login_registerhtml-form-anterior" class="md-nav__link">
    <span class="md-ellipsis">
      
        1-HTML de login_register.html (form anterior)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-script-login_iawphp" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-Script login_IAW.php
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-html-inicio_iawhtml" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-HTML inicio_IAW.html
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-script-delete_userphp" class="md-nav__link">
    <span class="md-ellipsis">
      
        4-Script delete_user.php
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-script-change_passwordphp" class="md-nav__link">
    <span class="md-ellipsis">
      
        5-Script change_password.php
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-practica" class="md-nav__link">
    <span class="md-ellipsis">
      
        6-Práctica
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#practica-guiada-6-conexiones-a-bd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Práctica Guiada 6. Conexiones a BD
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-html-de-login_registerhtml-form-anterior" class="md-nav__link">
    <span class="md-ellipsis">
      
        1-HTML de login_register.html (form anterior)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-script-login_iawphp" class="md-nav__link">
    <span class="md-ellipsis">
      
        2-Script login_IAW.php
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-html-inicio_iawhtml" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-HTML inicio_IAW.html
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-script-delete_userphp" class="md-nav__link">
    <span class="md-ellipsis">
      
        4-Script delete_user.php
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-script-change_passwordphp" class="md-nav__link">
    <span class="md-ellipsis">
      
        5-Script change_password.php
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-practica" class="md-nav__link">
    <span class="md-ellipsis">
      
        6-Práctica
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Borrar y cambiar registros de la BD. Uso de cookies. Practica 6</h1>

<h2 id="practica-guiada-6-conexiones-a-bd">Práctica Guiada 6. Conexiones a BD</h2>
<p>Lo nuevo de esta práctica es que implementaremos los métodos DELETE y PUT para borrar info de la base de datos, al mismo tiempo usaremos cookies y haremos redirecciones.</p>
<p>En primer lugar querremos una página de incio llamada (inicioIAW.html) donde podamos acceder a una hipotética página web de nuestro módulo. Este html tendrá dos formularios. Uno para registrarnos y otro, para iniciar sesión.</p>
<p><img alt="image-20251204132803044" src="../img/image-20251204132803044.png" /></p>
<h2 id="1-html-de-login_registerhtml-form-anterior">1-HTML de login_register.html (form anterior)</h2>
<p>el html de los dos formularios (foto anterior), es este:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Document<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>


    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">        </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">            </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
<span class="w">            </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">            </span><span class="k">justify-content</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">            </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">95</span><span class="kt">vh</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nt">h1</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>


<span class="w">        </span><span class="p">.</span><span class="nc">contenedor</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">            </span><span class="k">justify-content</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">            </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">vh</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="p">.</span><span class="nc">carta</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">222</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">252</span><span class="p">);</span>
<span class="w">            </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">320</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-right</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nt">form</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">            </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
<span class="w">            </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">left</span><span class="p">;</span>

<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nt">input</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nt">button</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>



<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>


<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Bienvenido al formulario de Inicio de la pagina WEB de IAW<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;contenedor&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;carta&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;Login.php&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Inicia sesión en la pagina web<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;email&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Contraseña&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Enviar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;carta&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;Register.php&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Registrate e inserta una imagen<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;nombre&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Nombre&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Email&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Contraseña&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;imagen&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Enviar <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>Observamos que cada formulario hace peticiones a scripts php distintos:</p>
<p><img alt="image-20251204133333891" src="../img/image-20251204133333891.png" /></p>
<ul>
<li>
<p>Visto esto, el de register_IAW.php es igual que en la práctica anterior, así que nos olvidamos de él ya que no hay nada nuevo.</p>
</li>
<li>
<p>El script de login_IAW.php es un poco distinto, ya que si inicias sesión correctamente no te manda un json felicitandote, si no que te redirige de verdad a otro HTML donde puedes cambiar tu contraseña o borrar tu cuenta. Además, inserta dos cookies en tu navegador a las que nadie pordrá acceder nunca, solo el servidor de tu página web. Estas cookies serán la cookie de la contraseña en texto plano (recuerdo que en la BD la contraseña se haseha) y la otra cookie será el email de la persona que inicia sesión.</p>
</li>
</ul>
<p>dejo por aquí solo el script login_IAW.php ya que el otro es igual que en la práctica anterior:</p>
<h2 id="2-script-login_iawphp">2-Script login_IAW.php</h2>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="p">);</span>

<span class="nv">$host</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_HOST&quot;</span><span class="p">);</span>
<span class="nv">$db</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">);</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_USER&quot;</span><span class="p">);</span>
<span class="nv">$pass</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_PASS&quot;</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$dsn</span> <span class="o">=</span> <span class="s2">&quot;mysql:host=</span><span class="si">$host</span><span class="s2">;dbname=</span><span class="si">$db</span><span class="s2">;charset=utf8mb4&quot;</span><span class="p">;</span>
    <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">,</span> <span class="p">[</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span> <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">,</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_DEFAULT_FETCH_MODE</span> <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">,</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_EMULATE_PREPARES</span> <span class="o">=&gt;</span> <span class="k">false</span>
    <span class="p">]);</span>

    <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="k">null</span><span class="p">;</span>
    <span class="nv">$pass_input</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$email</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$pass_input</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;Faltan datos&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT id, nombre, email, password FROM usuarios WHERE email = ?&quot;</span><span class="p">);</span>
    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="nv">$email</span><span class="p">]);</span>
    <span class="nv">$userData</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$userData</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;Usuario no encontrado&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$pass_input</span><span class="p">,</span> <span class="nv">$userData</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;Contraseña incorrecta&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nb">setcookie</span><span class="p">(</span>
        <span class="s2">&quot;clave_plana&quot;</span><span class="p">,</span>                  <span class="c1">// Nombre</span>
        <span class="nv">$pass_input</span><span class="p">,</span>                    <span class="c1">// Valor (contraseña a pelo)</span>
        <span class="p">[</span>
            <span class="s2">&quot;expires&quot;</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span>   <span class="c1">// 1 hora</span>
            <span class="s2">&quot;path&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
            <span class="c1">// &quot;secure&quot;   =&gt; true,         // Activar sólo en HTTPS</span>
            <span class="s2">&quot;httponly&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>            <span class="c1">// NO accesible desde JavaScript</span>
            <span class="s2">&quot;samesite&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;strict&quot;</span>         <span class="c1">//La cookie solo se envia a paginar del mismo domino</span>
        <span class="p">]</span>
    <span class="p">);</span>

    <span class="nb">setcookie</span><span class="p">(</span>
        <span class="s2">&quot;email&quot;</span><span class="p">,</span>                  <span class="c1">// Nombre</span>
        <span class="nv">$email</span><span class="p">,</span>                    <span class="c1">// Valor (contraseña a pelo)</span>
        <span class="p">[</span>
            <span class="s2">&quot;expires&quot;</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span>   <span class="c1">// 1 hora</span>
            <span class="s2">&quot;path&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
            <span class="c1">// &quot;secure&quot;   =&gt; true,         // Activar sólo en HTTPS</span>
            <span class="s2">&quot;httponly&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>            <span class="c1">// NO accesible desde JavaScript</span>
            <span class="s2">&quot;samesite&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;strict&quot;</span>         <span class="c1">//La cookie solo se envia a paginar del mismo domino</span>
        <span class="p">]</span>
    <span class="p">);</span>

    <span class="c1">// Redirigir a la página de inicio</span>
    <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location: inicioIAW.html&quot;</span><span class="p">);</span>
    <span class="k">exit</span><span class="p">;</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

    <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="p">);</span>

    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
        <span class="s2">&quot;status&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span>
    <span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
<p>La parte importante es que con</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Redirigir a la página de inicio</span>
<span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location: inicioIAW.html&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Inserto un header en la respuesta del servidor al cliente (response). Este header permitirá al cliente hacer la redirección al nuevo HTML y se hace automáticamente así ya que el formulario de incio es de tipo submit luego sigue redirecciones (el siguiente fragmente de código es de la parte de HTML que posee <code>login_register.html</code> del punto anterior).</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;Login.php&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Inicia sesión en la pagina web<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;email&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;email&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Contraseña&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Enviar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div>
<p>Otra parte importante es que insertamos cookies:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
    <span class="nb">setcookie</span><span class="p">(</span>
        <span class="s2">&quot;clave_plana&quot;</span><span class="p">,</span>                  <span class="c1">// Nombre</span>
        <span class="nv">$pass_input</span><span class="p">,</span>                    <span class="c1">// Valor (contraseña a pelo)</span>
        <span class="p">[</span>
            <span class="s2">&quot;expires&quot;</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span>   <span class="c1">// 1 hora</span>
            <span class="s2">&quot;path&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
            <span class="c1">// &quot;secure&quot;   =&gt; true,         // Activar sólo en HTTPS</span>
            <span class="s2">&quot;httponly&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>            <span class="c1">// NO accesible desde JavaScript</span>
            <span class="s2">&quot;samesite&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;strict&quot;</span>         <span class="c1">//La cookie solo se envia a paginar del mismo domino</span>
        <span class="p">]</span>
    <span class="p">);</span>

    <span class="nb">setcookie</span><span class="p">(</span>
        <span class="s2">&quot;email&quot;</span><span class="p">,</span>                  <span class="c1">// Nombre</span>
        <span class="nv">$email</span><span class="p">,</span>                    <span class="c1">// Valor (contraseña a pelo)</span>
        <span class="p">[</span>
            <span class="s2">&quot;expires&quot;</span> <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span>   <span class="c1">// 1 hora</span>
            <span class="s2">&quot;path&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
            <span class="c1">// &quot;secure&quot;   =&gt; true,         // Activar sólo en HTTPS</span>
            <span class="s2">&quot;httponly&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>            <span class="c1">// NO accesible desde JavaScript</span>
            <span class="s2">&quot;samesite&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;strict&quot;</span>         <span class="c1">//La cookie solo se envia a paginar del mismo domino</span>
        <span class="p">]</span>
    <span class="p">);</span>
</code></pre></div>
<p>donde httponly nos permite que la cookie no sea accesible desde javascript y solo viaje por http al servidor y con samesite strict nos aseguramos que no se envíe a otros servidores que no sean el nuestro.</p>
<h2 id="3-html-inicio_iawhtml">3-HTML inicio_IAW.html</h2>
<p>Si iniciamos sesión correctamente, entonces se nos redirige al HTML (inicio_IAW.HTML) y además se nos insertan las cookies anteriores. Mostramos captura de ambas cosas:</p>
<p>La imagen muestra el HTML que te aparece una vez inicias sesión</p>
<p><img alt="image-20251204134707751" src="../img/image-20251204134707751.png" /></p>
<p>Lo siguiente sería la captura de las cookies en el navegador:</p>
<p><img alt="image-20251204134922756" src="../img/image-20251204134922756.png" /></p>
<p>dejo aquí el código HTML de inicio_IAW.html</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Document<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>


    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">        </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">            </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
<span class="w">            </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">            </span><span class="k">justify-content</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">            </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">95</span><span class="kt">vh</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nt">h1</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>


<span class="w">        </span><span class="p">.</span><span class="nc">contenedor</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">            </span><span class="k">justify-content</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">            </span><span class="k">align-items</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">vh</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="p">.</span><span class="nc">carta</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">border-radius</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgb</span><span class="p">(</span><span class="mi">222</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">252</span><span class="p">);</span>
<span class="w">            </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">320</span><span class="kt">px</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-right</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nt">form</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">            </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
<span class="w">            </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">left</span><span class="p">;</span>

<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nt">input</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nt">button</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">max-width</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">            </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="kt">rem</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">        </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fetch_put</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">carta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.carta_put&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">div_put</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.resultado_put&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">boton_put</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#button_put&quot;</span><span class="p">);</span>

<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">input_pass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">input_pass2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password_repeated&quot;]&#39;</span><span class="p">);</span>


<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">div_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">div_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="w">                </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cambiar contraseña&quot;</span><span class="p">;</span>
<span class="w">                </span><span class="nx">input_pass</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">                </span><span class="nx">input_pass2</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">                </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input_pass</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">password_repeated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">input_pass2</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>

<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>

<span class="w">                </span><span class="nx">input_pass</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">                </span><span class="nx">input_pass2</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">                </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;change_password.php&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">                        </span><span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="w">                        </span><span class="s2">&quot;password&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span>
<span class="w">                        </span><span class="s2">&quot;password_repeated&quot;</span><span class="o">:</span><span class="w"> </span><span class="nx">password_repeated</span>
<span class="w">                    </span><span class="p">})</span>
<span class="w">                </span><span class="p">});</span>

<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">                </span><span class="nx">div_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Contraseña actualizada&quot;</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Volver a intentar&quot;</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">input_pass</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">input_pass2</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="nx">carta</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">carta</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;px&quot;</span><span class="p">;</span>

<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">div_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Error inesperado&quot;</span><span class="p">;</span>
<span class="w">                </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Volver a intentar&quot;</span><span class="p">;</span>
<span class="w">                </span><span class="nx">input_pass</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">                </span><span class="nx">input_pass2</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">                </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>

<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">fetch_delete</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">div_delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;.resultado_delete&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">boton_delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&quot;#button_delete&quot;</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">div_delete</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">div_delete</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="w">                </span><span class="nx">boton_delete</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Borrar&quot;</span><span class="p">;</span>
<span class="w">                </span><span class="k">return</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;delete_user.php&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">redirect</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;follow&quot;</span>
<span class="w">                </span><span class="p">});</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">redirected</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Usuario borrado&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
<span class="w">                    </span><span class="k">return</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="c1">// CASO 2: NO HAY REDIRECCIÓN → error JSON</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="w">                </span><span class="nx">div_delete</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
<span class="w">                </span><span class="nx">boton_delete</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Volver a intentar borrado&quot;</span><span class="p">;</span>

<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
<span class="w">                </span><span class="nx">div_delete</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Error inesperado&quot;</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;color:green&quot;</span><span class="p">&gt;</span>Sesión iniciada correctamente. Elige qué quieres hacer con el usuario<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;contenedor&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;carta_delete carta&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Borra tu usuario de la base de datos<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;button_delete&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;fetch_delete()&quot;</span><span class="p">&gt;</span>Enviar<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;resultado_delete&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;carta_put carta&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Cambia la contraseña del usuario<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Contraseña&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password_repeated&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Repite la contraseña&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;button_put&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;fetch_put()&quot;</span><span class="p">&gt;</span>Enviar <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;resultado_put&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>Además vemos también que cada formulario hace dos peticiones:</p>
<p>-El primero, hace la petición con javascript a <strong>fetch_delete()</strong> que a su vez, ejecuta el script <strong>delete_user.php</strong></p>
<p>-El segundo, hace la petición con javascript a <strong>fetch_put()</strong> que a su vez, ejecuta el script <strong>change_password.php</strong></p>
<p>Ambas funciones están en Inicio_IAW.html, que son las que hacen las peticiones a los scripts via JS y no via form HTML. Además, ninguna de estas peticiones envía body, veremos esto después.</p>
<p>Veamos cada uno de estos scripts para ver como manejan las solicitudes del cliente:</p>
<h2 id="4-script-delete_userphp">4-Script delete_user.php</h2>
<p>El objetivo es borrar el usuario de la persona que ha iniciado sesión. Reconocerá quién ha iniciado sesión ya que la contraseña y el usuario estarán en las cookies. El código es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="c1">// No enviar output antes de cookies o header()</span>

<span class="nv">$host</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_HOST&quot;</span><span class="p">);</span>
<span class="nv">$db</span>   <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">);</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_USER&quot;</span><span class="p">);</span>
<span class="nv">$pass</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_PASS&quot;</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$dsn</span> <span class="o">=</span> <span class="s2">&quot;mysql:host=</span><span class="si">$host</span><span class="s2">;dbname=</span><span class="si">$db</span><span class="s2">;charset=utf8mb4&quot;</span><span class="p">;</span>
    <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">,</span> <span class="p">[</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span>            <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">,</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_DEFAULT_FETCH_MODE</span> <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">,</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_EMULATE_PREPARES</span>   <span class="o">=&gt;</span> <span class="k">false</span>
    <span class="p">]);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;No hay cookie de email.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">&quot;clave_plana&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;No hay cookie de contraseña.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$email_cookie</span> <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">];</span>
    <span class="nv">$pass_cookie</span>  <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">&quot;clave_plana&quot;</span><span class="p">];</span>

    <span class="c1">// BUSCAR USUARIO EN BD</span>
    <span class="c1">// --------------------------------------------------------------------------</span>

    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT id, email, password FROM usuarios WHERE email = ?&quot;</span><span class="p">);</span>
    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="nv">$email_cookie</span><span class="p">]);</span>
    <span class="nv">$userData</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$userData</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;El usuario no existe en la BD.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">//VALIDAR CONTRASEÑA CON LA COOKIE</span>
    <span class="c1">// --------------------------------------------------------------------------</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$pass_cookie</span><span class="p">,</span> <span class="nv">$userData</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;Contraseña incorrecta o cookie inválida.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">//BORRAR FOTOS USARIO</span>

    <span class="nv">$rutaCarpetaUsuario</span> <span class="o">=</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s2">&quot;/uploads/&quot;</span> <span class="o">.</span> <span class="nv">$email_cookie</span><span class="p">;</span>

    <span class="c1">// Función para borrar una carpeta completa</span>
    <span class="k">function</span> <span class="nf">borrarCarpetaCompleta</span><span class="p">(</span><span class="nv">$ruta</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$ruta</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

        <span class="nv">$archivos</span> <span class="o">=</span> <span class="nb">array_diff</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$ruta</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">]);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$archivos</span> <span class="k">as</span> <span class="nv">$archivo</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$rutaCompleta</span> <span class="o">=</span> <span class="nv">$ruta</span> <span class="o">.</span> <span class="s2">&quot;/&quot;</span> <span class="o">.</span> <span class="nv">$archivo</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$rutaCompleta</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">borrarCarpetaCompleta</span><span class="p">(</span><span class="nv">$rutaCompleta</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nb">unlink</span><span class="p">(</span><span class="nv">$rutaCompleta</span><span class="p">);</span> <span class="c1">//comando para borrar un archivo</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nb">rmdir</span><span class="p">(</span><span class="nv">$ruta</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">borrarCarpetaCompleta</span><span class="p">(</span><span class="nv">$rutaCarpetaUsuario</span><span class="p">);</span>

    <span class="c1">//BORRAR USUARIO</span>
    <span class="c1">// --------------------------------------------------------------------------</span>

    <span class="nv">$stmt_del</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE FROM usuarios WHERE id = ?&quot;</span><span class="p">);</span>
    <span class="nv">$stmt_del</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="nv">$userData</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]);</span>

    <span class="c1">//BORRAR COOKIES DE EMAIL Y CONTRASEÑA</span>
    <span class="c1">// --------------------------------------------------------------------------</span>

    <span class="nb">setcookie</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s2">&quot;expires&quot;</span>  <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3600</span><span class="p">,</span>
        <span class="s2">&quot;path&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;httponly&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="s2">&quot;samesite&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Strict&quot;</span>
    <span class="p">]);</span>

    <span class="nb">setcookie</span><span class="p">(</span><span class="s2">&quot;clave_plana&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s2">&quot;expires&quot;</span>  <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3600</span><span class="p">,</span>
        <span class="s2">&quot;path&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;httponly&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="s2">&quot;samesite&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Strict&quot;</span>
    <span class="p">]);</span>

    <span class="c1">// REDIRIGIR A FORMULARIO DE LOGIN</span>
    <span class="c1">// --------------------------------------------------------------------------</span>

    <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location: login_register.html&quot;</span><span class="p">);</span>
    <span class="k">exit</span><span class="p">;</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Si hay error → JSON</span>
    <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="p">);</span>

    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
        <span class="s2">&quot;status&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span>
    <span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
<p>Una vez borrado el usuario, redirige a login_register.html y además, quita las cookies. Otra cosa importante es que el cliente debe aceptar esta redirección de forma manuan, ya que en este caso las peticiones no han sido via formulario de html si no vía fetch JavaScript. Esto se hace en este cacho de código de la función <code>fetch_put</code>del html <code>inicio_IAW.html</code>:</p>
<div class="highlight"><pre><span></span><code><span class="x">try {</span>
<span class="x">    const response = await fetch(&quot;delete_user.php&quot;, {</span>
<span class="x">        method: &quot;DELETE&quot;,</span>
<span class="x">    });</span>

<span class="x">    if (response.redirected) {</span>
<span class="x">        alert(&quot;Usuario borrado&quot;);</span>
<span class="x">        window.location.href = response.url;</span>
<span class="x">        return;</span>
<span class="x">    }</span>

<span class="x">    const data = await response.json();</span>
<span class="x">    div_delete.innerHTML = data.message;</span>
<span class="x">    boton_delete.innerHTML = &quot;Volver a intentar borrado&quot;;</span>

<span class="x">}</span>
</code></pre></div>
<h2 id="5-script-change_passwordphp">5-Script change_password.php</h2>
<p>El objetivo es cambiar la contraseña de la persona que ha iniciado sesión. Reconocerá quién ha iniciado sesión ya que la contraseña y el usuario estarán en las cookies. El código es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="p">);</span>

<span class="c1">// Conexión a la BD</span>
<span class="nv">$host</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_HOST&quot;</span><span class="p">);</span>
<span class="nv">$db</span>   <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">);</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_USER&quot;</span><span class="p">);</span>
<span class="nv">$pass</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;DB_PASS&quot;</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$dsn</span> <span class="o">=</span> <span class="s2">&quot;mysql:host=</span><span class="si">$host</span><span class="s2">;dbname=</span><span class="si">$db</span><span class="s2">;charset=utf8mb4&quot;</span><span class="p">;</span>
    <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">,</span> <span class="p">[</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span>            <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">,</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_DEFAULT_FETCH_MODE</span> <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">,</span>
        <span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_EMULATE_PREPARES</span>   <span class="o">=&gt;</span> <span class="k">false</span>
    <span class="p">]);</span>


    <span class="c1">// 1. VALIDAR COOKIES</span>
    <span class="c1">// ------------------------------------------------------------</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;No hay cookie de email.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">&quot;clave_plana&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;No hay cookie de contraseña.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$email_cookie</span> <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">];</span>
    <span class="nv">$pass_cookie</span>  <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">&quot;clave_plana&quot;</span><span class="p">];</span>


    <span class="c1">// 2. LEER JSON DEL CLIENTE</span>
    <span class="c1">// ------------------------------------------------------------</span>
    <span class="nv">$json_raw</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">&quot;php://input&quot;</span><span class="p">);</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$json_raw</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;JSON inválido.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$new_pass</span>  <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="k">null</span><span class="p">;</span>
    <span class="nv">$new_pass2</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="s2">&quot;password_repeated&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$new_pass</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$new_pass2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;Faltan contraseñas.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 3. COMPROBAR QUE LAS CONTRASEÑAS COINCIDEN</span>
    <span class="c1">// ------------------------------------------------------------</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$new_pass</span> <span class="o">!==</span> <span class="nv">$new_pass2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
            <span class="s2">&quot;status&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Las contraseñas no coinciden.&quot;</span>
        <span class="p">]);</span>
        <span class="k">exit</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 4. VALIDAR USUARIO Y CONTRASEÑA ACTUAL</span>
    <span class="c1">// ------------------------------------------------------------</span>
    <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT id, email, password FROM usuarios WHERE email = ?&quot;</span><span class="p">);</span>
    <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="nv">$email_cookie</span><span class="p">]);</span>
    <span class="nv">$userData</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$userData</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;Usuario no existe.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$pass_cookie</span><span class="p">,</span> <span class="nv">$userData</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;La contraseña actual no es válida.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 5. ACTUALIZAR CONTRASEÑA EN LA BD</span>
    <span class="c1">// ------------------------------------------------------------</span>
    <span class="nv">$hashedNewPassword</span> <span class="o">=</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$new_pass</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">);</span>

    <span class="nv">$stmt_update</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE usuarios SET password = ? WHERE id = ?&quot;</span><span class="p">);</span>
    <span class="nv">$stmt_update</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="nv">$hashedNewPassword</span><span class="p">,</span> <span class="nv">$userData</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]);</span>


    <span class="c1">// 6. ACTUALIZAR COOKIE DE CONTRASEÑA</span>
    <span class="c1">// ------------------------------------------------------------</span>
    <span class="nb">setcookie</span><span class="p">(</span><span class="s2">&quot;clave_plana&quot;</span><span class="p">,</span> <span class="nv">$new_pass</span><span class="p">,</span> <span class="p">[</span>
        <span class="s2">&quot;expires&quot;</span>  <span class="o">=&gt;</span> <span class="nb">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span>
        <span class="s2">&quot;path&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;httponly&quot;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="s2">&quot;samesite&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Strict&quot;</span>
    <span class="p">]);</span>


    <span class="c1">// 7. RESPUESTA ÉXITO</span>
    <span class="c1">// ------------------------------------------------------------</span>
    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
        <span class="s2">&quot;status&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Contraseña actualizada correctamente.&quot;</span>
    <span class="p">]);</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span>
        <span class="s2">&quot;status&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span>
    <span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
<p>Hace un control de errores para comprobar que coincidan, si no coincidiesen, mandaría al cliente un JSON diciendo que no coinciden, que se recoge en Inicio_IAW.html así:</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
<span class="nx">div_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;success&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//Vemos si el código de respuesta es OK</span>
<span class="w">    </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Contraseña actualizada&quot;</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Volver a intentar&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">input_pass</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="nx">input_pass2</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="nx">boton_put</span><span class="p">.</span><span class="nx">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="6-practica">6-Práctica</h2>
<p>Copiando y entendiendo los scripts anteriores haz capturas del siguiente proceso:</p>
<p>crea un usuario, logueate con él, cambia la contraseña, vuelve al inicio de sesión y comprueba que la contraseña funciona y por último borra el usuario.</p>
<p>¿Qué pasa con la carpeta la imagen del usuario una vez se elimina su cuenta?</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>